"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[178],{78126:function(e,t,l){l.d(t,{Z:function(){return f}});var a=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_BehaviorMetricCondition"}},[t("div",{ref:"padview"},[e.icon.length>0?t("b-icon",{staticClass:"mr10",attrs:{icon:e.icon,size:"is-small"}}):e._e(),t("QuickDateTimeRangePicker",{staticClass:"mr10",on:{change:e.on_change_time},model:{value:e.selectedTimeRange,callback:function(t){e.selectedTimeRange=t},expression:"selectedTimeRange"}}),t("el-select",{staticClass:"width90 mr10 opClass1",attrs:{size:"mini","default-first-option":""},on:{change:e.on_change_never},model:{value:e.selectedDidever,callback:function(t){e.selectedDidever=t},expression:"selectedDidever"}},e._l(e.neverTypeListOp,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{staticClass:"mr10 opClass2",attrs:{filterable:"",size:"mini","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:e.on_change_event},model:{value:e.selectedEvent,callback:function(t){e.selectedEvent=t},expression:"selectedEvent"}},e._l(e.eventGroupOp,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.selectedDidever==e.pub.def.NeverType.NeverTypeEver?t("div",{staticClass:"extracond"},[e.selectedEventChanging?e._e():t("EventMetric",{staticClass:"mr10",attrs:{eventProps:e.eventProps},on:{change:e.on_change_metric},model:{value:e.selectedMetric,callback:function(t){e.selectedMetric=t},expression:"selectedMetric"}}),t("el-select",{staticClass:"width130 mr10 opClass3",attrs:{size:"mini","default-first-option":!0},on:{change:e.on_change_compare},model:{value:e.selectedCmp,callback:function(t){e.selectedCmp=t},expression:"selectedCmp"}},e._l(e.compareOp,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e.selectedCmp!==e.pub.def.FilterOp.OpBetween?t("span",{staticClass:"mr10"},[t("el-input-number",{staticClass:"width130",attrs:{size:"mini","controls-position":"right"},on:{change:e.on_params_change},model:{value:e.selectedParamNumber1,callback:function(t){e.selectedParamNumber1=t},expression:"selectedParamNumber1"}})],1):e._e(),e.selectedCmp===e.pub.def.FilterOp.OpBetween?t("span",{},[e._v(" "+e._s(e.$t("message.之间前位"))),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:e.on_params_change},model:{value:e.selectedParamNumber1,callback:function(t){e.selectedParamNumber1=t},expression:"selectedParamNumber1"}}),e._v(e._s(e.$t("message.之间中位"))+" "),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:e.on_params_change},model:{value:e.selectedParamNumber2,callback:function(t){e.selectedParamNumber2=t},expression:"selectedParamNumber2"}}),e._v(e._s(e.$t("message.之间后位"))+" ")],1):e._e(),t("span",{on:{click:function(t){return e.on_click_add(e.selectedFilterGroup,0,1)}}},[t("b-tooltip",{attrs:{label:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1)],1):e._e()],1),t("PropConditionGroup",{attrs:{favorites:"",keepLast:!1,filters:e.selectedFilterGroup,eventProps:e.eventProps,userProps:e.userProps}}),t("div")],1)},r=[],i=l(794),s=l(62147),n=l(63822),p=l(9808),o=l(97634),d=l(90309),c={components:{QuickDateTimeRangePicker:p.Z,PropConditionGroup:d.Z,EventMetric:o.Z},model:{prop:"modelvalue",event:"modelvaluechange"},props:{modelvalue:{type:Object,default:function(){return{timeRange:{},event:"",never:i.Z.def.NeverType.NeverTypeEver,filterGroup:{logicop:i.Z.def.LogicOp.LogicOpAnd,children:[]},metric:"",cmp:i.Z.def.FilterOp.OpEqual,paramNumber1:0,paramNumber2:0,icon:""}}},userProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:i.Z.def.PropertyType.getZhLabel(i.Z.def.PropertyType.PropertyTypeCustom),type:i.Z.def.DataType.DataTypeNumber}]},eventGroupOp:{type:Array,default:()=>[]},defaulted:{type:Boolean,default:!0}},data(){return{selectedTimeRange:{},selectedEvent:"",selectedEventChanging:!0,selectedDidever:i.Z.def.NeverType.NeverTypeEver,selectedFilterGroup:{logicop:i.Z.def.LogicOp.LogicOpAnd,children:[]},selectedCmp:i.Z.def.FilterOp.OpEqual,selectedParamNumber1:1,selectedParamNumber2:1,icon:"",selectedMetric:"",eventProps:[],neverTypeListOp:[],compareOp:[{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpTopN),value:i.Z.def.FilterOp.OpTopN},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpEqual),value:i.Z.def.FilterOp.OpEqual},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpNotEqual),value:i.Z.def.FilterOp.OpNotEqual},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpLowerThan),value:i.Z.def.FilterOp.OpLowerThan},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpLowerThanEqual),value:i.Z.def.FilterOp.OpLowerThanEqual},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpGreaterThan),value:i.Z.def.FilterOp.OpGreaterThan},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpGreaterThanEqual),value:i.Z.def.FilterOp.OpGreaterThanEqual},{label:i.Z.def.FilterOp.getZhLabel(i.Z.def.FilterOp.OpBetween),value:i.Z.def.FilterOp.OpBetween}]}},created(){this.neverTypeListOp=i.Z.def.NeverType.getLabelValueList(),this.setModel(this.modelvalue),i.Z.utils.IsEmptyStr(this.selectedEvent)&&this.eventGroupOp&&this.eventGroupOp.length>0&&(this.selectedEvent=this.eventGroupOp[0].value),this.loadEventProp("created").then((e=>{console.log("loadEventProp:",this.selectedEvent,e),this.eventProps=e,this.defaulted&&this.initDefault(),this.adjustAllSelectWidth(),this.selectedEventChanging=!1})).catch((e=>{i.Z.utils.Err(this,e),this.selectedEventChanging=!1}))},mounted(){},beforeDestroy(){},watch:{},methods:{initDefault(){i.Z.utils.IsEmptyStr(this.selectedDidever)&&(this.selectedDidever=i.Z.def.NeverType.NeverTypeEver),i.Z.utils.IsEmptyStr(this.selectedCmp)&&(this.selectedCmp=i.Z.utils.ParseStrSafe(i.Z.def.FilterOp.OpEqual))},setModel(e){e&&(this.selectedTimeRange=i.Z.utils.ParseObjSafe(e.timeRange),this.selectedEvent=i.Z.utils.ParseStrSafe(e.event),this.selectedDidever=i.Z.utils.ParseStrSafe(e.did_event),e.filterGroup&&e.filterGroup.children?this.selectedFilterGroup=e.filterGroup:this.selectedFilterGroup={logicop:i.Z.def.LogicOp.LogicOpAnd,children:[]},this.selectedMetric=i.Z.utils.ParseStrSafe(e.metric),this.selectedCmp=i.Z.utils.ParseStrSafe(e.cmp),this.selectedParamNumber1=i.Z.utils.ParseNumberSafe(e.paramNumber1),this.selectedParamNumber1<1&&(this.selectedParamNumber1=1),this.selectedParamNumber2=i.Z.utils.ParseNumberSafe(e.paramNumber2),this.selectedParamNumber2<1&&(this.selectedParamNumber2=1))},on_click_add(e,t,l){this.confirm(),i.Z.condx.GroupAdd(e,t,l,{record:{pickersubject:{}}})},on_change_never(){this.confirm(),this.adjustAllSelectWidth()},findEventByValue(e){for(var t=0;t<this.eventGroupOp.length;t++)if(this.eventGroupOp[t].value==e)return this.eventGroupOp[t];return{}},adjustAllSelectWidth(){if(this.$refs.padview){var e=this.$refs.padview.getElementsByClassName("opClass1")[0];i.Z.utils.AdjustWidthOfSelect(this.fontSize,i.Z.def.NeverType.getZhLabel(this.selectedDidever),e)}if(this.$refs.padview){var t=this.$refs.padview.getElementsByClassName("opClass2")[0],l=this.findEventByValue(this.selectedEvent);i.Z.utils.AdjustWidthOfSelect(this.fontSize,l.label,t)}if(this.$refs.padview){var a=this.$refs.padview.getElementsByClassName("opClass3")[0];i.Z.utils.AdjustWidthOfSelect(this.fontSize,i.Z.def.FilterOp.getZhLabel(this.selectedCmp),a)}},on_change_time(){this.confirm(),this.adjustAllSelectWidth()},on_change_event(e){i.Z.utils.Ignore(e),this.confirm(),this.selectedEventChanging=!0,i.Z.condx.GroupClear(this.selectedFilterGroup),this.$nextTick((()=>{this.loadEventProp("on_change_event").then((e=>{this.eventProps=e,this.selectedEventChanging=!1})).catch((e=>{i.Z.utils.Err(this,e),this.selectedEventChanging=!1})),this.adjustAllSelectWidth()}))},on_change_metric(){this.confirm()},on_change_compare(){this.confirm(),this.adjustAllSelectWidth()},loadCompareOp(){this.adjustAllSelectWidth()},on_params_change(e){this.selectedCmp==i.Z.def.FilterOp.OpEqual&&e<1&&this.$nextTick((()=>this.selectedParamNumber1=1)),this.selectedCmp==i.Z.def.FilterOp.OpLowerThan&&e<2&&this.$nextTick((()=>this.selectedParamNumber1=2)),this.selectedCmp==i.Z.def.FilterOp.OpLowerThanEqual&&e<1&&this.$nextTick((()=>this.selectedParamNumber1=1)),this.selectedCmp==i.Z.def.FilterOp.OpBetween&&(this.selectedParamNumber1<1&&this.$nextTick((()=>this.selectedParamNumber1=1)),this.selectedParamNumber2<this.selectedParamNumber1&&this.$nextTick((()=>this.selectedParamNumber2=this.selectedParamNumber1))),this.confirm(),this.adjustAllSelectWidth()},loadEventProp(e){i.Z.utils.Ignore(e);var t=this.getCurrAppId();return i.Z.utils.IsEmptyStr(this.selectedEvent)?new Promise((e=>{e([])})):s.Z.api.LoadEventPropParamPromise({app_id:t,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[this.selectedEvent]})},confirm(){var e={timeRange:this.selectedTimeRange,event:this.selectedEvent,did_event:this.selectedDidever,filterGroup:this.selectedFilterGroup,metric:this.selectedMetric,cmp:this.selectedCmp,paramNumber1:this.selectedParamNumber1,paramNumber2:this.selectedParamNumber2};this.$emit("modelvaluechange",e),this.$emit("change",e)}},computed:{...(0,n.Se)({getCurrAppId:"system/getCurrAppId"})}},u=c,m=l(1001),h=(0,m.Z)(u,a,r,!1,null,"62529e74",null),f=h.exports},20178:function(e,t,l){l.d(t,{Z:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meClass"},[t("div",[t("ConditionGroup",{attrs:{group:e.modelValueRef},scopedSlots:e._u([{key:"default",fn:function(l){return[t("div",{staticClass:"condItem flexrowbetween"},[t("div",{staticClass:"flexrowitemstart"},[t("b-icon",{staticClass:"headerIcon",attrs:{icon:"brightness-7",size:"is-small"}}),e.modelValueRef&&e.modelValueRef.children&&e.modelValueRef.children.length>0?t("BehaviorMetricCondition",{staticClass:"pading2",attrs:{eventGroupOp:e.eventGroupOp,userProps:e.userProps},on:{change:e.on_change_behavior_condition},model:{value:l.item.record,callback:function(t){e.$set(l.item,"record",t)},expression:"slotProps.item.record"}}):e._e()],1),t("div",[t("b-button",{attrs:{size:"is-small","icon-left":"plus",type:"is-ghost"},on:{click:function(t){return e.on_click_add(e.modelValueRef,l.item.id)}}},[e._v(e._s(e.$t("message.添加")))]),t("b-button",{attrs:{size:"is-small","icon-left":"trash-can-outline",type:"is-ghost"},on:{click:function(t){return e.on_click_trash(e.modelValueRef,l.item.id)}}},[e._v(e._s(e.$t("message.删除")))])],1)])]}}])})],1)])},r=[],i=l(78126),s=l(17818),n=l(794),p={components:{BehaviorMetricCondition:i.Z,ConditionGroup:s.Z},model:{prop:"modelvalue",event:"modelvaluechange"},props:{keepLast:{type:Boolean,default:!0},eventGroupOp:{type:Array,default:()=>[]},userProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:n.Z.def.PropertyType.getZhLabel(n.Z.def.PropertyType.PropertyTypeCustom),type:n.Z.def.DataType.DataTypeNumber}]},modelvalue:{type:Object,default:function(){return{logicop:n.Z.def.LogicOp.LogicOpAnd,children:[]}}}},data(){return{selectedEvent:"",modelValueRef:{}}},created(){this.modelValueRef=this.modelvalue},mounted(){},methods:{on_click_add(e,t,l){n.Z.condx.GroupAdd(e,t,l,{record:{}})},on_click_trash(e,t){n.Z.condx.GroupRemove(e,t)},onMetricChange(e,t,l,a){console.log("onMetricChange",e,t,l,a)},on_event_change(e){this.selectedEvent=e},on_change_behavior_condition(e){n.Z.utils.Ignore(e)},groupItemCount(e){return n.Z.condx.GroupItemCount(e)}}},o=p,d=l(1001),c=(0,d.Z)(o,a,r,!1,null,"b51f91ec",null),u=c.exports}}]);