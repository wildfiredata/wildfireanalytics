"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[9976],{33762:function(e,t,a){a.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_newreport"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.创建报表")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.报表名称"),prop:"name"}},[t("el-input",{staticClass:"w200",attrs:{placeholder:e.$t("message.请输入报表名称"),size:"medium",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:e.$t("message.选择或新建报表组"),prop:"reportGroup"}},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择报表组"),size:"medium","default-first-option":"","multiple-limit":1,filterable:"","allow-create":""},on:{change:e.on_change_folder},model:{value:e.formData.reportGroup,callback:function(t){e.$set(e.formData,"reportGroup",t)},expression:"formData.reportGroup"}},e._l(e.folderData,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}},[t("div",{staticClass:"rowLeftCenter"},[1==a.level?t("div",{}):e._e(),2==a.level?t("div",{staticClass:"space10"}):e._e(),3==a.level?t("div",{staticClass:"space20"}):e._e(),a.is_folder?t("i",{staticClass:"el-icon-folder mr5"}):t("i",{staticClass:"el-icon-document mr5"}),e._v(" "+e._s(a.label)+" ")])])})),1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},r=[],o=(a(57658),a(47056)),i=a(794),l=a(63822),n={props:{},data(){return{folderData:[],newDialog:{show:!1},formData:{name:"",reportGroup:"",spaceOwnerId:0},rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:10,message:this.$t("message.长度在 2 到 10 个字符"),trigger:"blur"}],reportGroup:[{required:!0,message:this.$t("message.不能为空"),trigger:"blur"}]}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t){console.log("showDialog",e,t),this.formData.name="",this.formData.spaceOwnerId=0==t?0:this.getCurrAccountId(),this.ApiGetReportGroup(i.Z.utils.ParseNumberSafe(e)),this.newDialog.show=!0},on_change_folder(e){this.formData.spaceOwnerId=this.getFolderSpaceOwner(e)},getFolderSpaceOwner(e){return this.folderData.forEach((t=>{if(t.value==e)return t.spaceOwnerId})),0},ApiGetReportGroup(e){o.Z["new"]().reportGroupFullGet({app_id:this.getCurrAppId(),space_owner_id:this.getCurrAccountId()}).then(function(t){var a=[];t.data.forEach((e=>{e.is_share_folder||(a.push({value:e.id,label:e.label,level:1,is_folder:!0,space_owner_id:e.space_owner_id}),e.children&&e.children.forEach((t=>{t.is_folder&&a.push({value:t.id,label:t.label,level:2,is_folder:t.is_folder,space_owner_id:e.space_owner_id})})))})),this.folderData=a,this.folderData.forEach((t=>{t.value===e&&(this.formData.reportGroup=e)}))}.bind(this)).catch(function(e){i.Z.utils.Err(this,e)}.bind(this))},addReportNode(e,t,a){return o.Z["new"]().reportGroupAdd({label:e,app_id:this.getCurrAppId(),is_folder:t,parent_id:i.Z.utils.ParseNumberSafe(a),space_owner_id:this.formData.spaceOwnerId})},getParentFolder(){var e;return this.folderData&&this.folderData.length>0&&this.folderData.forEach((t=>{t.value===this.formData.reportGroup&&(e=new Promise((e=>{e(t.value)})))})),void 0===e?this.addReportNode(this.formData.reportGroup,!0,0).then((e=>new Promise((t=>{t(e.data.id)})))):e},confirm(e){var t=!0;if(this.$refs[e].validate((e=>{if(!e)return t=!1,!1})),t){var a=this.getParentFolder();a.then((e=>(this.ApiGetReportGroup(e),this.addReportNode(this.formData.name,!1,e).then((e=>new Promise((t=>{t(e.data.id)}))))))).then((e=>{this.$emit("confirm",e),this.newDialog.show=!1})).catch((e=>{i.Z.utils.Err(this,e)}))}}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},d=n,c=a(1001),p=(0,c.Z)(d,s,r,!1,null,"5d13b9f0",null),u=p.exports},19976:function(e,t,a){a.d(t,{Z:function(){return f}});var s=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_savereport"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.保存分析")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.名称"),prop:"name"}},[t("el-input",{staticClass:"w200",attrs:{size:"medium",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:e.$t("message.并保存至报表"),prop:"reportIds"}},[t("div",{staticClass:"rowRightCenter"},[t("el-select",{staticClass:"w200",attrs:{placeholder:"请选择报表",size:"medium",multiple:""},model:{value:e.formData.reportIds,callback:function(t){e.$set(e.formData,"reportIds",t)},expression:"formData.reportIds"}},e._l(e.data,(function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value,disabled:a.is_folder}},[t("div",{staticClass:"rowLeftCenter"},[1==a.level?t("div",{}):e._e(),2==a.level?t("div",{staticClass:"space10"}):e._e(),3==a.level?t("div",{staticClass:"space20"}):e._e(),a.is_folder?t("i",{staticClass:"el-icon-folder mr5"}):t("i",{staticClass:"el-icon-document mr5"}),e._v(" "+e._s(a.label)+" ")])])})),1),t("NewReport",{ref:"newReport",on:{confirm:e.on_newreport}},[t("div",{staticClass:"rowRightCenter span_button",on:{click:e.on_click_newreport}},[t("b-icon",{attrs:{size:"is-small",icon:"plus"}}),e._v(e._s(e.$t("message.添加报表")))],1)])],1)])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:e.confirm}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},r=[],o=(a(57658),a(47056)),i=a(33762),l=a(794),n=a(63822),d={components:{NewReport:i.Z},props:{},data(){return{data:[],newDialog:{show:!1},formData:{analysisId:0,name:"",reportIds:[],postBody:{},clientData:{},respPostData:{},analysisType:"",creator:0},rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:20,message:this.$t("message.长度在 2 到 20 个字符"),trigger:"blur"}],reportIds:[{required:!1,message:this.$t("message.请选择报表组"),trigger:"change"}]}}},created(){},mounted(){this.ApiGetReportGroup()},beforeDestroy(){},methods:{showDialog(e,t,a,s,r,o,i,n){this.formData.analysisId=e,this.formData.name=t,this.formData.reportIds=[],this.formData.clientData=a,this.formData.respPostData=r,this.formData.postBody=s,this.formData.analysisType=o,this.formData.creator=l.Z.utils.ParseNumberSafe(i),this.newDialog.show=!0,n&&this.ApiGetReportGroup(n)},ApiGetReportGroup(e){o.Z["new"]().reportGroupFullGet({app_id:this.getCurrAppId(),space_owner_id:this.getCurrAccountId()}).then(function(t){var a=[];t.data.forEach((e=>{a.push({value:e.id,label:e.label,level:1,is_folder:!0}),e.children&&e.children.forEach((e=>{a.push({value:e.id,label:e.label,level:2,is_folder:e.is_folder}),e.is_folder&&e.children&&e.children.forEach((e=>{a.push({value:e.id,label:e.label,level:3,is_folder:e.is_folder})}))}))})),this.data=a,a.forEach((t=>{t.value===e&&void 0!==e&&(this.formData.reportIds=[e])}))}.bind(this)).catch((function(e){console.log(e)}))},SaveToAnalysisList(){return o.Z["new"]().analysisListSave({id:l.Z.utils.ParseNumberSafe(this.formData.analysisId),name:this.formData.name,client_data:JSON.stringify(this.formData.clientData),analysis_post:JSON.stringify(this.formData.postBody),analysis_type:this.formData.analysisType,post_resp_data:JSON.stringify(this.formData.respPostData),creator:this.formData.creator,app_id:this.getCurrAppId()})},SaveToReports(){return o.Z["new"]().reportAppendAnalysis({id:this.formData.reportIds,analysis_id:this.formData.analysisId})},confirm(){var e=this.SaveToAnalysisList();e.then((e=>{console.log("confirm",e);var t=e.data;return this.formData.analysisId=e.data.id,this.$emit("sucess",t),this.SaveToReports()})).then((e=>{l.Z.utils.Ignore(e),l.Z.utils.Success(this,this.$t("message.保存成功")),this.newDialog.show=!1})).catch((function(e){console.log(e)}))},on_click_newreport(){this.$refs.newReport.showDialog()},on_newreport(e){this.ApiGetReportGroup(e)}},computed:{...(0,n.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},c=d,p=a(1001),u=(0,p.Z)(c,s,r,!1,null,"220762cc",null),f=u.exports}}]);