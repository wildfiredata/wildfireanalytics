"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[2826],{74855:function(e,t,i){i.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("span",{ref:"me"},[t("input",{staticClass:"inputDefaultClass",class:{titleSize:e.isTitle,mediumSize:e.isMedium,smallSize:e.isSmall,miniSize:e.isMini,fieldValue:!0,fieldControl:!0,warningBorder:e.isInvalid},attrs:{type:"text",placeholder:e.inputPlaceHolder},domProps:{value:e.valueText},on:{change:e.changeEvent}}),t("el-input",{staticStyle:{position:"fixed",width:"2000px",transform:"translateY(-9999px)"},attrs:{size:e.fontSize,readonly:""}},[t("span",{ref:"autowidthspan",class:{titleSize:e.isTitle},attrs:{slot:"prefix"},slot:"prefix"},[e._v(e._s(e.autowidthspanText))])])],1)},s=[],n=i(794),r={name:"EditLabel",model:{prop:"value",event:"input"},props:{value:{type:String},inputPlaceHolder:{String:String},isInvalid:{type:Boolean,default:!1},fontSize:{type:String,default:"medium"},autoWidth:{type:Boolean,default:!0}},data(){return{valueText:""}},watch:{value(e){this.valueText=e,this.$emit("change",e),this.autoWidthAdjust()}},created(){this.valueText=this.value},mounted(){this.autoWidthAdjust()},methods:{changeEvent(e){this.valueText=e.target.value,this.$emit("input",e.target.value),this.$emit("change",e.target.value),this.autoWidthAdjust()},autoWidthAdjust(e){this.autoWidth&&(n.Z.utils.Ignore(e),setTimeout((()=>{if(this.$refs.autowidthspan){var e=this.$refs.autowidthspan.getClientRects(),t=this.$refs.me,i=t.getElementsByClassName("inputDefaultClass")[0];if(e.length>0){var a=e[0].width+12;n.Z.utils.IsEmptyStr(this.inputPrefixIcon)||(a+=25),n.Z.utils.IsEmptyStr(this.inputSuffixIcon)||(a+=25),i.style.width=a+"px"}}}),10))}},computed:{autowidthspanText:function(){return this.valueText&&this.valueText.length>0?this.valueText:this.inputPlaceHolder},isMedium(){return"medium"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isSmall(){return"small"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isMini(){return"mini"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isTitle(){return"title"==this.fontSize}}},l=r,o=i(1001),u=(0,o.Z)(l,a,s,!1,null,"4dd8e01e",null),c=u.exports},66859:function(e,t,i){i.r(t),i.d(t,{default:function(){return O}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root"},[t("div",{staticClass:"containerClass"},[t("div",{staticClass:"top_toolbar h40"},[t("div",[e.name?t("EditLabel",{staticClass:"h40 ml10",attrs:{fontSize:"title"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}):t("span",{staticClass:"title h40 ml10 nonuserselect"},[e._v(e._s(e.$t("message.LTV分析")))])],1),t("div",{staticClass:"top_toolbar_erea"},[t("div",[t("span",{staticClass:"size12 nonuserselect"},[e._v(e._s(e.$t("message.选择分析主体")+":")+" ")]),t("el-select",{staticClass:"mr10 w120",attrs:{size:"mini",placeholder:e.$t("message.选择分析主体")},model:{value:e.EntityId,callback:function(t){e.EntityId=t},expression:"EntityId"}},e._l(e.EntityList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-select",{staticClass:"mr10 w120",attrs:{size:"mini",placeholder:e.$t("message.请选择默认分析时区")},model:{value:e.zone,callback:function(t){e.zone=t},expression:"zone"}},e._l(e.zones,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(t){return e.on_click_save(e.id)}}},[e._v(e._s(e.$t("message.保存")))]),t("SaveAnalysis",{ref:"saveAnalysis",on:{sucess:e.on_save_success}})],1),e.id>0?t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(t){return e.on_click_save(0)}}},[e._v(e._s(e.$t("message.另存为")))])],1):e._e(),t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:e.on_click_analyze}},[e._v(e._s(e.$t("message.计算")))])],1)],1)]),t("splitpanes",{staticClass:"default-theme"},[t("pane",{attrs:{size:e.paneSize,"max-size":"60"}},[t("div",{staticClass:"left-root"},[t("div",{staticClass:"left-work-area onSliderScroll"},[t("div",{staticClass:"title_area nonuserselect"},[e._v(e._s(e.$t("message.指标")))]),t("div",{staticClass:"metricArea"},[t("div",{staticClass:"matricLabelClass nonuserselect"},[t("div",[e._v(e._s(e.$t("message.起始事件")))])]),t("div",{staticClass:"mb10"},[t("el-select",{staticClass:"mr10",attrs:{size:"mini",filterable:"","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:function(t){return e.on_change_event(e.StartEvent)}},model:{value:e.StartEvent.event,callback:function(t){e.$set(e.StartEvent,"event",t)},expression:"StartEvent.event"}},e._l(e.EventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("span",{on:{click:function(t){return e.addTopEventPropCondition(e.StartEvent.combo)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),e.StartEvent.loadingOk?t("PropConditionGroup",{attrs:{eventProps:e.StartEvent.eventProps,keepLast:!1,userProps:e.UserPropList,userGroups:e.UserGroupList,userTags:e.UserTagList},model:{value:e.StartEvent.combo,callback:function(t){e.$set(e.StartEvent,"combo",t)},expression:"StartEvent.combo"}}):e._e()],1),t("div",{staticClass:"matricLabelClass nonuserselect"},[t("div",[e._v(e._s(e.$t("message.营收事件")))])]),t("div",{staticClass:"mb10"},[t("el-select",{staticClass:"mr10",attrs:{size:"mini",filterable:"","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:function(t){return e.on_change_event(e.IncomeEvent)}},model:{value:e.IncomeEvent.event,callback:function(t){e.$set(e.IncomeEvent,"event",t)},expression:"IncomeEvent.event"}},e._l(e.EventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "+e._s(e.$t("message.的"))+" "),e.IncomeEvent.loadingOk?t("EventMetricCounterNumberSum",{attrs:{extra:e.IncomeEvent,eventProps:e.IncomeEvent.eventProps},model:{value:e.IncomeEvent.metric,callback:function(t){e.$set(e.IncomeEvent,"metric",t)},expression:"IncomeEvent.metric"}}):e._e(),t("span",{on:{click:function(t){return e.addTopEventPropCondition(e.IncomeEvent.combo)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),e.IncomeEvent.loadingOk?t("PropConditionGroup",{attrs:{eventProps:e.IncomeEvent.eventProps,keepLast:!1,userProps:e.UserPropList,userGroups:e.UserGroupList,userTags:e.UserTagList},model:{value:e.IncomeEvent.combo,callback:function(t){e.$set(e.IncomeEvent,"combo",t)},expression:"IncomeEvent.combo"}}):e._e()],1)]),t("div",{staticClass:"title_area nonuserselect",on:{click:e.addGlobalFilter}},[e._v(e._s(e.$t("message.全局筛选"))+" "),t("div",{staticClass:"title_area_button"},[t("div",[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加全局筛选")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),t("div",[t("PropConditionGroup",{attrs:{eventProps:e.MultiEventPropList,keepLast:!1,userProps:e.UserPropList,userGroups:e.UserGroupList,userTags:e.UserTagList},model:{value:e.GlobalFilter,callback:function(t){e.GlobalFilter=t},expression:"GlobalFilter"}})],1),t("div",{staticClass:"title_area nonuserselect",on:{click:e.addGroupby}},[e._v(e._s(e.$t("message.分组"))),t("div",{staticClass:"title_area_button"},[t("div",[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加分组")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),t("div",[t("draggable",e._b({staticClass:"list-group",attrs:{tag:"ul"},on:{end:e.afterGroupbyDrag},model:{value:e.Groupbys.children,callback:function(t){e.$set(e.Groupbys,"children",t)},expression:"Groupbys.children"}},"draggable",e.dragOptions,!1),[t("transition-group",{attrs:{type:"transition"}},e._l(e.Groupbys.children,(function(i){return t("li",{key:i.id,staticClass:"list-group-item"},[t("div",{staticClass:"matricLabelClass"},[t("b-icon",{staticClass:"dragicon",attrs:{icon:"drag"}}),t("div",{staticClass:"groupyicon"},[t("el-avatar",{staticClass:"elavatarclass",attrs:{size:18,shape:"square"}},[e._v(e._s(i.id))])],1),t("GroupbyCondition",{attrs:{tabGroups:e.tabGroups},model:{value:i.groupbyfield,callback:function(t){e.$set(i,"groupbyfield",t)},expression:"element.groupbyfield"}}),t("span",{on:{click:function(t){return e.deleteGroupby(i.id)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.删除")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"close-circle",size:"is-small"}})],1)],1)],1)])})),0)],1)],1)])])]),t("pane",{attrs:{size:100-e.paneSize}},[t("div",{staticClass:"chart_root"},[t("div",{staticClass:"chart_toolbar"},[t("div",{staticClass:"chart_toolbar_left"},[t("b-dropdown",{staticClass:"bdropdownborder",attrs:{"append-to-body":"","trap-focus":"","aria-role":"dialog"},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("span",{staticClass:"navbar-item",attrs:{role:"button"}},[t("span",{staticStyle:{"font-size":"12px",width:"60px","text-align":"right"}},[e._v(e._s(e.LtvValueText))]),t("b-icon",{attrs:{icon:"menu-down"}})],1)]},proxy:!0}])},[t("b-dropdown-item",{attrs:{focusable:!1,custom:"",paddingless:"","close-on-click":!1,"can-close":"outside"}},[t("div",{staticStyle:{width:"300px"}},[t("section",{staticClass:"modal-card-body"},[t("b-field",{attrs:{label:e.$t("message.查看LTV时间节点")}},[t("div",{staticClass:"rowRightCenter"},[t("el-select",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{size:"small",placeholder:e.$t("message.请选择")},model:{value:e.RetentSet.currentRetent,callback:function(t){e.$set(e.RetentSet,"currentRetent",t)},expression:"RetentSet.currentRetent"}},e._l(e.LtvWindowList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),999==e.RetentSet.currentRetent?t("div",{staticClass:"rowRightCenter",on:{click:e.stopPropagation}},[t("el-input-number",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small","controls-position":"right",min:1,max:31},on:{change:e.on_change_customretentnum},model:{value:e.RetentSet.customRetentNum,callback:function(t){e.$set(e.RetentSet,"customRetentNum",t)},expression:"RetentSet.customRetentNum"}}),t("div",[e._v(e._s(e.LtvTimeLabel))])],1):e._e(),9999==e.RetentSet.currentRetent?t("div",[e.RetentSet.keyRetentEdit?t("el-button",{attrs:{size:"small"},on:{click:e.on_click_finish_keyretent_input}},[e._v(e._s(e.$t("message.确定")))]):t("el-button",{attrs:{size:"small",icon:"el-icon-edit"},on:{click:function(t){e.RetentSet.keyRetentEdit=!e.RetentSet.keyRetentEdit}}},[e._v(e._s(e.$t("message.添加")))])],1):e._e()],1)]),9999==e.RetentSet.currentRetent?t("div",[e.RetentSet.keyRetentEdit?t("el-input",{attrs:{type:"textarea",rows:2,placeholder:e.$t("message.请输入内容")},on:{input:e.on_change_LtvTimeString},model:{value:e.RetentSet.keyRetentTimeString,callback:function(t){e.$set(e.RetentSet,"keyRetentTimeString",t)},expression:"RetentSet.keyRetentTimeString"}}):t("div",{staticClass:"keyDayDiv",on:{click:e.stopPropagation}},[t("b-taglist",e._l(e.RetentSet.keyRetentTime,(function(i){return t("b-tag",{key:i,attrs:{closable:""},on:{close:function(t){return e.on_tagclose(i)}}},[e._v(e._s(i)+e._s(e.LtvTimeLabel))])})),1)],1)],1):e._e()],1)])])],1),t("QuickDateTimeRangePicker",{ref:"quicktimepicker1",staticClass:"ml10",attrs:{fontSize:"mini"},on:{change:e.on_timerange_change},model:{value:e.analyzeTimeRange1,callback:function(t){e.analyzeTimeRange1=t},expression:"analyzeTimeRange1"}})],1),t("div",{staticClass:"chart_toolbar_right"},[t("div",{class:{svgicon_button:!0,activeIcon:!e.hideTable},on:{click:function(t){e.hideTable=!e.hideTable}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.$t("message.表格"),placement:"bottom-end"}},[t("div",[t("inline-svg",{attrs:{width:"16",height:"16",src:i(69793)}})],1)])],1)])]),e.tableDataLoading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableDataLoading,expression:"tableDataLoading"}],staticClass:"mh100"}):[e.loadTableDataOnce&&!e.hideTable?t("TablePlusSummaryCellEdit",{attrs:{enableSummary:!0,loading:e.tableDataLoading},model:{value:e.tableData,callback:function(t){e.tableData=t},expression:"tableData"}}):e._e()]],2)])],1)],1)])},s=[],n=(i(57658),i(83581)),r=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_EventMetricCntOrSum"}},[t("el-input",{class:{inputEvtMeticCntClass:!0},attrs:{size:e.fontSize,placeholder:e.inputPlaceHolder,"suffix-icon":e.inputSuffixIcon,readonly:""},on:{blur:e.input_onblur,focus:e.input_onfocus},model:{value:e.valueText,callback:function(t){e.valueText=t},expression:"valueText"}}),t("el-cascader-panel",{directives:[{name:"show",rawName:"v-show",value:e.viewshow,expression:"viewshow"}],staticClass:"pickview1",attrs:{options:e.metrics},on:{change:e.on_cascader_change},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)},l=[],o=i(794),u={model:{prop:"modelvalue",event:"modelvaluechange"},props:{eventProps:{type:Array,default:()=>[{value:"guild_name",label:"公会名字",type:o.Z.def.DataType.DataTypeString},{value:"guild_member",label:"公会人数",type:o.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"会长",type:o.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",type:o.Z.def.DataType.DataTypeNumber}]},modelvalue:String,entities:{type:Array,default:()=>[{value:"1",label:"用户"},{value:"2",label:"账号"}]},extra:{type:Object,default:function(){return{}}},defaulted:{type:Boolean,default:!0},autoDropWidth:{type:Boolean,default:!0},dropWidth:{type:String,default:"180px"},dropHight:{type:String,default:"80px"},fontSize:{type:String,default:"mini"},inputPlaceHolder:{type:String,default:""},inputSuffixIcon:{type:String,default:""},selectValues:{type:Array,default:()=>[]},formatInput:{type:Function,default(e){var t="";return 2===e.length?t=e[0].label+"."+e[1].label:3===e.length?t=e[1].label+"."+e[2].label:1===e.length&&(t=e[0].label),t}}},data(){return{selected:[],metrics:[],modelValueRef:"",valueText:"",viewshow:!1}},created(){document.addEventListener("click",this.dc,!0),this.initialize()},mounted(){this.canChooseLeaf(this.modelValueRef)?this.selectLeaf(this.modelValueRef):this.defaulted&&this.setDefaultItem()},beforeDestroy(){document.removeEventListener("click",this.dc,!0)},watch:{eventProps(e){this.loadMetrics(e),!this.canChooseLeaf(this.modelValueRef)&&this.defaulted&&this.setDefaultItem(),this.displayValueText()}},computed:{},methods:{dc(e){this.viewshow=this.$refs.me.contains(e.target)},initialize(){this.modelValueRef=this.modelvalue,this.loadMetrics(this.eventProps),this.displayValueText()},input_onfocus(){this.viewshow=!0},input_onblur(){},setDefaultItem(){this.selected=[],this.metrics.length>0&&this.selected.push(this.metrics[0].value),this.confirm()},canChooseLeaf(e){if(o.Z.utils.IsEmptyStr(e))return!1;var t=o.Z.utils.DeepClone(this.metrics);while(t&&t.length>0){for(var i=[],a=0;a<t.length;a++){if(t[a].value===e)return!0;t[a].children&&t[a].children.length>0&&(i=i.concat(t[a].children))}t=i}return!1},selectLeaf(e){var t=this.getPathNodes(e);this.selected=t},displayValueText(){var e=this.getPathNodes(this.modelValueRef);this.valueText=this.formatInput(e)},on_cascader_change(){this.confirm()},confirm(){if(this.selected&&this.selected.length>0){var e=this.selected[this.selected.length-1];this.modelValueRef=e,this.displayValueText(),this.$emit("modelvaluechange",e),this.$emit("change",e,{extra:this.extra,text:this.valueText})}this.viewshow=!1},getPathNodes(e){var t=[];if(o.Z.utils.IsEmptyStr(e))return t;var i=o.Z.utils.DeepClone(this.metrics),a=!0;while(a){a=!1;for(var s={},n=0;n<i.length;n++){if(e==i[n].value)return t.push({value:i[n].value,label:i[n].label}),t;0==e.indexOf(i[n].value)&&(o.Z.utils.IsEmptyObj(s)||s.value.length<i[n].value.length)&&(s=i[n])}if(o.Z.utils.IsEmptyObj(s)||(t.push({value:s.value,label:s.label}),i=s.children,a=!0),!i||i.length<=0||!a)return console.log("fail to match metric",e,a,i),t}return t},loadMetrics(e){this.selected="",this.metrics=[{value:o.Z.def.MetricCategory.MetricCategoryEvent+"."+o.Z.def.MetricType.MetricTypeCount,label:this.$t("message.总次数")}];for(var t=0;t<e.length;t++)if(e[t].type===o.Z.def.DataType.DataTypeNumber){var i={value:o.Z.def.MetricCategory.MetricCategoryProp+"."+e[t].value+"."+o.Z.def.MetricType.MetricTypeNumberSum,label:e[t].label};this.metrics.push(i)}}}},c=u,p=i(1001),d=(0,p.Z)(c,r,l,!1,null,"1bd0ad76",null),h=d.exports,m=i(74855),v=i(90309),f=i(43782),g=i(9808),b=i(36144),y=i(76983),_=i.n(y),T=i(63822),S=i(47056),k=i(62147),L=i(19976),C=i(99877),Z={components:{Splitpanes:n.F,Pane:n.X,SaveAnalysis:L.Z,draggable:_(),EditLabel:m.Z,InlineSvg:C.ZP,EventMetricCounterNumberSum:h,PropConditionGroup:v.Z,GroupbyCondition:f.Z,QuickDateTimeRangePicker:g.Z,TablePlusSummaryCellEdit:b.Z},created(){},mounted(){this.initializeRetentSet(),this.initialize()},data:()=>({EntityList:[],EventList:[],UserPropList:[],UserGroupList:[],UserTagList:[],ModiferList:[],zones:[],availableChartList:[],report_id:0,id:0,name:"",paneSize:45,zone:o.Z.def.TimeZone.Utcp8,RetentSet:{currentRetent:7,customRetentNum:7,radioRetentGrain:"day",retentWindow:{},keyRetentEdit:!1,keyRetentTimeString:"1,4,7,10",keyRetentTime:[1,4,7,10]},EntityId:0,MultiEventPropList:[],tabGroups:[],GlobalFilter:{logicop:o.Z.def.LogicOp.LogicOpAnd,children:[]},Groupbys:{children:[]},StartEvent:{combo:{logicop:o.Z.def.LogicOp.LogicOpAnd,children:[]}},IncomeEvent:{combo:{logicop:o.Z.def.LogicOp.LogicOpAnd,children:[]}},analyzeTimeRange1:{time_pick:!1,quick_range:"this_7day",start_unit:"day",end_unit:"day",start_offset:1,end_offset:0,start_dynamic:!0,end_dynamic:!0,start_time:"2023-06-28 00:00:00",end_time:"2023-06-29 23:59:59"},tableData:{},tableDataLoading:!1,loadTableDataOnce:!1,hideTable:!1,hideChart:!1,chartOption:{},tempLastPost:"",respData:{},currentChart:"",chartDataSet:{}}),methods:{initialize(){this.availableChartList=k.Z.analysisLtv.GetChartTypeList(),this.loadZones(),this.loadAnalyzeTimeGrain(),this.ModiferList=o.Z.def.ModifierType.getLabelValueList();var e=this.getCurrAppId(),t=k.Z.api.LoadPlainEventList(e,!1),i=k.Z.api.LoadUserProp(e),a=k.Z.api.LoadUserClusterList(e),s=k.Z.api.LoadUserTagList(e,!0),n=k.Z.api.LoadAnalysisEnityList(e),r=Promise.all([i,t,a,s,n]);r.then((e=>{this.UserPropList=e[0],this.EventList=e[1],this.UserGroupList=e[2],this.UserTagList=e[3],this.EntityList=e[4],this.chooseSystemDefaultEntity(),this.UserGroupList.forEach((e=>{e.client_data=null,e.table_type=o.Z.def.TableType.TableTypeEvent})),this.UserTagList.forEach((e=>{e.client_data=null,e.table_type=o.Z.def.TableType.TableTypeEvent})),this.StartEvent=this.chooseDefaultEvent(),this.IncomeEvent=this.chooseDefaultEvent(),this.tabGroups=k.Z.filtersub.MakeTabGroup(null,this.UserPropList,this.UserGroupList,this.UserTagList);var t=this.$route.params;t&&(this.report_id=t.report_id),t&&!o.Z.utils.IsEmptyObj(t.client_data)&&this.restoreClientData(t.client_data)})).catch((e=>{o.Z.utils.Err(this,e)}))},initializeRetentSet(){this.RetentSet.retentWindow={day:[{value:1,label:"1 "+this.$t("message.天")},{value:4,label:"4 "+this.$t("message.天")},{value:7,label:"7 "+this.$t("message.天")},{value:14,label:"14 "+this.$t("message.天")},{value:30,label:"30 "+this.$t("message.天")},{value:999,label:this.$t("message.自定义")},{value:9999,label:this.$t("message.关键日期")}]}},on_tagclose(e){this.RetentSet.keyRetentTime=this.RetentSet.keyRetentTime.filter((t=>t!=Number(e))),0==this.RetentSet.keyRetentTime.length&&(this.RetentSet.keyRetentTime=[1,4,7]),this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTime.join(",")},on_change_LtvTimeString(){this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTimeString.replaceAll(/[^0-9,]/g,"")},on_click_finish_keyretent_input(){this.RetentSet.keyRetentEdit=!1;var e=this.RetentSet.keyRetentTimeString.split(",");this.RetentSet.keyRetentTime=[];for(var t=0;t<e.length;t++)e[t].length>0&&(Number(e[t])>1e3?this.RetentSet.keyRetentTime.push(1e3):this.RetentSet.keyRetentTime.push(Number(e[t])));this.RetentSet.keyRetentTime=o.Z.utils.DeduplicatedList(this.RetentSet.keyRetentTime),this.RetentSet.keyRetentTime.sort((function(e,t){return e-t})),0==this.RetentSet.keyRetentTime.length?this.RetentSet.keyRetentTime=[1,4,7]:this.RetentSet.keyRetentTime.length>=o.Z.def.Limit.MAX_RETENTION_RECORDS&&(this.RetentSet.keyRetentTime=this.RetentSet.keyRetentTime.slice(0,o.Z.def.Limit.MAX_RETENTION_RECORDS)),this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTime.join(",")},stopPropagation(e){e.stopPropagation()},on_change_customretentnum(){},chooseDefaultEvent(){var e={label:"",id:"A",event:"",metric:"",modifier:o.Z.def.ModifierType.ModifierTypeNone,loadingOk:!1,eventProps:[],combo:{logicop:o.Z.def.LogicOp.LogicOpAnd,children:[]}};if(this.EventList.length>0){e.event=this.EventList[0].value;var t=this.getCurrAppId();k.Z.api.LoadEventPropParamPromise({app_id:t,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[e.event]}).then((t=>{e.eventProps=t,this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition(),e.loadingOk=!0}))}return e},chooseSystemDefaultEntity(){for(var e=0;e<this.EntityList.length;e++)if(this.EntityList[e].is_system)return this.EntityId=this.EntityList[e].id,void(this.EntityList[e].label=this.EntityList[e].label+this.$t("message.(默认)"))},restoreClientData(e){this.id=e.id,this.name=e.name,this.paneSize=e.paneSize,this.zone=e.zone,this.RetentSet=e.RetentSet,this.EntityId=e.EntityId,this.MultiEventPropList=e.MultiEventPropList,this.tabGroups=e.tabGroups,this.GlobalFilte=e.GlobalFilte,this.Groupbys=e.Groupbys,this.StartEvent=e.StartEvent,this.IncomeEvent=e.IncomeEvent,this.analyzeTimeRange1=e.analyzeTimeRange1,this.$refs.quicktimepicker1.setValue(e.analyzeTimeRange1),this.on_change_event(this.StartEvent),this.on_change_event(this.IncomeEvent),this.tableDataLoading=!0,this.respData=e.respData,this.hideTable=!1,this.hideChart=!1,this.$nextTick((()=>{this.tableData=k.Z.analysisLtv.ToTabledata(this.respData),this.tableDataLoading=!1,this.loadTableDataOnce=!0}))},getEventLabel(e){for(var t=0;t<this.EventList.length;t++)if(this.EventList[t].value==e)return this.EventList[t].label;return""},loadZones(){this.zones.push({label:o.Z.def.TimeZone.getZhLabel(o.Z.def.TimeZone.Utcp8),value:o.Z.def.TimeZone.Utcp8});var e=-12;while(e<13)8!==e&&this.zones.push({label:o.Z.def.TimeZone.getZhLabel(e),value:e}),e+=1},loadAnalyzeTimeGrain(){this.ananlyzeTimeGrainOp=o.Z.def.TimeGrain.getAnalyzeGrainOpList()},addTopEventPropCondition(e){o.Z.condx.GroupAdd(e,0,1,{selectedOp:"=",record:{}})},on_change_event(e){var t=this.getCurrAppId();k.Z.api.LoadEventPropParamPromise({app_id:t,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[e.event]}).then((t=>{e.eventProps=t,this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition(),e.loadingOk=!0})),e.labelchanged||(e.label=this.getEventLabel(e.event)+"."+e.metricText)},addGlobalFilter(){o.Z.condx.GroupAdd(this.GlobalFilter,0,1,{selectedOp:"=",record:{}})},deleteDangleGlobalFilterCondition(){for(var e=o.Z.condx.Clone2List(this.GlobalFilter),t=0;t<e.length;t++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==o.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==e[t].record.pickersubject.type_prop_name){i=!0;break}i||o.Z.condx.GroupRemove(this.GlobalFilter,e[t].id)}},deleteDangleGroupbyCondition(){for(var e=o.Z.utils.DeepClone(this.Groupbys.children),t=0;t<e.length;t++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==o.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==e[t].groupbyfield.editing_field.type_prop_name){i=!0;break}i||o.Z.condx.GroupRemove(this.Groupbys,e[t].id)}},refreshCommEventProp(){var e=[],t=new Map;return this.StartEvent.eventProps.forEach((i=>{if(!t.has(i.type_prop_name)){t.set(i.type_prop_name);var a=o.Z.utils.DeepClone(i);a.id=e.length,e.push(a)}})),this.IncomeEvent.eventProps.forEach((i=>{if(!t.has(i.type_prop_name)){t.set(i.type_prop_name);var a=o.Z.utils.DeepClone(i);a.id=e.length,e.push(a)}})),this.MultiEventPropList=e,this.tabGroups=[],setTimeout((()=>{this.tabGroups=k.Z.filtersub.MakeTabGroup(this.MultiEventPropList,this.UserPropList,this.UserGroupList,this.UserTagList)}),10),e},on_input_formular(e){if(e&&e.formular){e.formular=e.formular.toUpperCase();for(var t="",i=0;i<e.formular.length;i++)o.Z.def.MathExpressChars.getList().indexOf(e.formular[i])>=0&&(t+=e.formular[i]);e.formular=t}},addGroupby(){o.Z.condx.GroupAdd(this.Groupbys,0,1,{})},deleteGroupby(e){o.Z.condx.GroupRemove(this.Groupbys,e)},afterGroupbyDrag(){for(var e=o.Z.utils.DeepClone(this.Groupbys),t=0;t<e.children.length;t++)e.children[t].id=t+1;this.Groupbys.children=[],setTimeout((()=>{this.Groupbys=e}),10)},CalcRealKeyTimes(){var e=k.Z.quicktimerange.Duration(this.analyzeTimeRange1,o.Z.def.TimeGrain.getMomentDurationUnit(this.RetentSet.radioRetentGrain));if(e>o.Z.def.Limit.MAX_RETENTION_RECORDS)return this.$t("message.时间范围过大")},on_timerange_change(e){var t=this.CalcRealKeyTimes();t&&o.Z.utils.Err(this,t),o.Z.utils.Ignore(e)},on_click_save(e){var t={},i=this.prepare_postdata(t);if(i)o.Z.utils.Err(this,i);else{var a={paneSize:this.paneSize,zone:this.zone,RetentSet:this.RetentSet,EntityId:this.EntityId,MultiEventPropList:this.MultiEventPropList,tabGroups:this.tabGroups,GlobalFilte:this.GlobalFilte,Groupbys:this.Groupbys,StartEvent:this.StartEvent,IncomeEvent:this.IncomeEvent,analyzeTimeRange1:this.analyzeTimeRange1,currentChart:this.currentChart};this.tempLastPost!=JSON.stringify(t)?this.QueryApi().then((()=>{this.$refs.saveAnalysis.showDialog(e,this.name,a,t,this.respData,o.Z.def.AnalysisType.AnalysisTypeLtv,0,this.report_id),this.tableDataLoading=!1})).catch(function(e){o.Z.utils.Err(this,e),this.tableDataLoading=!1}.bind(this)):(this.$refs.saveAnalysis.showDialog(e,this.name,a,t,this.respData,o.Z.def.AnalysisType.AnalysisTypeLtv,0,this.report_id),this.tableDataLoading=!1)}},on_save_success(e){this.name=e.name,this.id=e.id},prepare_postdata(e){var t=this.CalcRealKeyTimes();if(t)return t;e.app=this.getCurrAppId(),e.enity_id=this.EntityId,e.time_zone=this.zone,e.start_event=k.Z.metric.VueEventFilterGroup2ApiEventFilter(this.StartEvent.event,this.StartEvent.combo),e.income_prop_metric=k.Z.metric.VueEventMetricRecord2ApiEventRecord(this.IncomeEvent),e.comm_filter=k.Z.metric.VuePropFilterGroup2ApiGlobalFilter(this.GlobalFilter),e.breaks=k.Z.breaks.VueGroupbys2ApiBreakList(this.StartEvent.event,this.Groupbys),e.analysis_time_range={time_zone:this.zone,range1:this.analyzeTimeRange1},e.ltv_times={window:999===this.RetentSet.currentRetent?this.RetentSet.customRetentNum:this.RetentSet.currentRetent,key_enable:9999===this.RetentSet.currentRetent,key_times:this.RetentSet.keyRetentTime}},QueryApi(){var e={},t=this.prepare_postdata(e);return t?Promise.reject(t):(this.tableDataLoading=!0,this.tableData={},this.tempLastPost=JSON.stringify(e),S.Z["new"]().analyzeLtv(e).then(function(e){return o.Z.utils.Ignore(e),this.respData=e.data,this.tableData=k.Z.analysisLtv.ToTabledata(this.respData),this.tableDataLoading=!1,this.loadTableDataOnce=!0,!0}.bind(this)))},on_click_analyze(){this.QueryApi().catch(function(e){o.Z.utils.Err(this,e),this.tableDataLoading=!1}.bind(this))}},computed:{...(0,T.Se)({getCurrAppId:"system/getCurrAppId"}),dragOptions(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}},LtvValueText:function(){var e="";return 9999==this.RetentSet.currentRetent?e+=this.$t("message.关键日期"):e=999==this.RetentSet.currentRetent?e+this.RetentSet.customRetentNum+o.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain):e+this.RetentSet.currentRetent+o.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain),e},LtvWindowList:function(){return this.RetentSet.retentWindow[this.RetentSet.radioRetentGrain]},LtvTimeLabel:function(){return o.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain)}}},E=Z,R=(0,p.Z)(E,a,s,!1,null,"4bf08f46",null),O=R.exports},17818:function(e,t,i){i.d(t,{Z:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meClass"},[e.topgroup.children&&e.topgroup.children.length>0?t("div",{staticClass:"grouproot"},[t("div",{staticClass:"group-header"},[e.topgroup.children.length>1?t("div",{staticClass:"logic-buttons"},[t("div",{class:{spanAnd:!0,logicOn:e.topgroup.logicop===e.pub.def.LogicOp.LogicOpAnd},on:{click:function(t){e.topgroup.logicop=e.pub.def.LogicOp.LogicOpAnd}}},[e._v(e._s(e.$t("message.且"))),t("span")]),t("div",{class:{spanOr:!0,logicOn:e.topgroup.logicop===e.pub.def.LogicOp.LogicOpOr},on:{click:function(t){e.topgroup.logicop=e.pub.def.LogicOp.LogicOpOr}}},[e._v(e._s(e.$t("message.或"))),t("span")])]):e._e()]),t("div",{staticClass:"condContainer"},e._l(e.topgroup.children,(function(i,a){return t("div",{key:i.id},[i.children&&i.children.length>0?t("div",{staticClass:"grouproot"},[t("div",{staticClass:"group-header"},[i.children.length>1?t("div",{staticClass:"logic-buttons"},[t("div",{class:{spanAnd:!0,logicOn:i.logicop===e.pub.def.LogicOp.LogicOpAnd},on:{click:function(t){i.logicop=e.pub.def.LogicOp.LogicOpAnd}}},[e._v(e._s(e.$t("message.且"))),t("span")]),t("div",{class:{spanOr:!0,logicOn:i.logicop===e.pub.def.LogicOp.LogicOpOr},on:{click:function(t){i.logicop=e.pub.def.LogicOp.LogicOpOr}}},[e._v(e._s(e.$t("message.或"))),t("span")])]):e._e()]),t("div",{staticClass:"condContainer"},e._l(e.topgroup.children[a].children,(function(s,n){return t("div",{key:s.id},[e._t("default",(function(){return[e._v(e._s(i)+" "+e._s(n))]}),{item:s,parent:e.topgroup.children[a]})],2)})),0)]):t("div",[e._t("default",(function(){return[e._v(e._s(i))]}),{item:i,parent:e.topgroup})],2)])})),0)]):e._e()])},s=[],n=i(794),r={components:{},props:{keepLast:{type:Boolean,default:!0},group:{type:Object,default:function(){return{logicop:n.Z.def.LogicOp.LogicOpAnd,children:[{id:1,label:"label1",name:"namelabel1"},{id:2,label:"label2",name:"namelabel2"},{id:3,label:"label3",name:"namelabel3",logicop:n.Z.def.LogicOp.LogicOpAnd,children:[{id:3,label:"label1",name:"namelabel1"},{id:2,label:"label2",name:"namelabel2"}]}]}}},subjects:{type:Array,default:()=>[]}},data(){return{topgroup:{}}},created(){this.topgroup=this.group},mounted(){},methods:{},computed:{}},l=r,o=i(1001),u=(0,o.Z)(l,a,s,!1,null,"c6cbd6c8",null),c=u.exports},43782:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_groupbycondition"}},[t("div",{staticClass:"flexrowAcenter"},[t("SelectPicker",{attrs:{defaulted:e.defaulted,tabGroups:e.tabGroups},on:{pickviewshow:e.on_picker_show,change:e.on_select_change},model:{value:e.editing_field,callback:function(t){e.editing_field=t},expression:"editing_field"}}),e.showSettingIcon(e.editing_field)?t("div",{on:{click:function(t){e.viewshow=!0}}},[t("b-icon",{staticClass:"setIcon ml5",attrs:{icon:"cog-outline",size:"is-small"}})],1):e._e()],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.viewshow,expression:"viewshow"}],staticClass:"groupbypickview"},[t("div",{staticClass:"groupbypicktitle"},[e._v(e._s(e.$t("message.分组方式-列表")))]),e.isBasicListType(e.editing_field)?t("div",[t("el-radio-group",{on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListWhole}},[e._v(e._s(e.$t("message.按值")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListElement}},[e._v(e._s(e.$t("message.按元素")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListSet}},[e._v(e._s(e.$t("message.按元素集合")))])],1)],1):e._e(),e.isDateTimeType(e.editing_field)?t("div",{staticClass:"h40 flexrowAcenter"},[t("el-radio-group",{on:{input:e.on_radio_change_time},model:{value:e.timeSummary,callback:function(t){e.timeSummary=t},expression:"timeSummary"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.PERIOD_SUMMARY_NO}},[e._v(e._s(e.$t("message.不汇总")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.PERIOD_SUMMARY_YES}},[e._v(e._s(e.$t("message.按时段汇总")))])],1),e.timeSummary==e.PERIOD_SUMMARY_YES?t("div",{staticClass:"flexrowAcenter ml5"},[t("b-select",{staticClass:"w100",attrs:{size:"is-small"},on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},e._l(e.timePeriodOp,(function(i){return t("option",{key:i.value,domProps:{value:i.value}},[e._v(" "+e._s(i.label)+" ")])})),0)],1):e._e()],1):e._e(),e.isNumberType(e.editing_field)?t("div",[t("el-radio-group",{on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberDefault}},[e._v(e._s(e.$t("message.默认区间")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberValue}},[e._v(e._s(e.$t("message.离散值(无区间)")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberCustom}},[e._v(e._s(e.$t("message.自定义区间")))])],1),e.breakOption==e.pub.def.BreakOption.BreakOptionNumberCustom?t("div",{staticClass:"pickViewContent onSliderScroll"},e._l(e.numberList,(function(i,a){return t("div",{key:i.id,staticClass:"flexcolumnAleft"},[1===i.id?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+1))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("span",{staticClass:"w100"},[e._v(e._s(e.pub.def.Infinite.InfiniteMin))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:function(t){return e.on_change_num(i)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e(),1!=i.id?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+1))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("el-input",{staticClass:"w100",attrs:{value:e.get_previous_max(i),size:"mini",disabled:!0}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:function(t){return e.on_change_num(i)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e(),i.id===e.numberList.length?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+2))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("el-input",{staticClass:"w100",attrs:{value:i.value,size:"mini",disabled:!0}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),e._v(" "+e._s(e.pub.def.Infinite.InfiniteMax)+" "),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e()])})),0):e._e(),e.breakOption==e.pub.def.BreakOption.BreakOptionNumberCustom?t("div",{staticClass:"span_button",on:{click:e.addToList}},[t("b-icon",{attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}}),e._v(e._s(e.$t("message.添加区间")))],1):e._e()],1):e._e()])])},s=[],n=(i(57658),i(794)),r=i(43436);const l="no",o="yes";var u={name:"DateTimePicker",components:{SelectPicker:r.Z},model:{prop:"modelvalue",event:"modelvaluechange"},props:{inputPlaceHolder:{type:String,default:"请选择日期"},modelvalue:{type:Object,default:function(){return{editing_field:{},breakOption:n.Z.def.BreakOption.BreakOptionListWhole,numberList:[{id:1,value:1}]}}},defaulted:{type:Boolean,default:!0},fontSize:{type:String,default:"mini"},setting:{type:Boolean,default:!0},tabGroups:{type:Array,default:()=>[]}},data(){return{PERIOD_SUMMARY_NO:"no",PERIOD_SUMMARY_YES:"yes",timeSummary:"no",eventListLoadOk:!1,timePeriodOp:[],editing_field:{},viewshow:!1,breakOption:n.Z.def.BreakOption.BreakOptionListWhole,numberList:[{id:1,value:1}]}},created(){this.initialize()},mounted(){(this.modelvalue&&this.modelvalue.length>12||this.modelvalue&&10===this.modelvalue.length)&&this.confirm(),document.addEventListener("click",this.dc,!0)},beforeDestroy(){document.removeEventListener("click",this.dc,!0)},methods:{initialize(){this.timePeriodOp=this.getTimePeriodList(),this.modelvalue&&(this.breakOption=this.modelvalue.breakOption,this.numberList=this.modelvalue.numberList,this.editing_field=this.modelvalue.editing_field)},confirm(){var e={};e.breakOption=this.breakOption,e.numberList=this.numberList,e.editing_field=this.editing_field,this.$emit("modelvaluechange",e)},dc(e){var t=this.$el.contains(e.target);t||(this.viewshow=!1)},on_breakOption_change(){console.log("====on_breakOption_change=========",this.breakOption),this.confirm()},getTimePeriodList(){var e=[];return e.push({value:n.Z.def.BreakOption.BreakOptionTimeMinute,label:this.$t("message.分钟")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeHour,label:this.$t("message.小时")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeDay,label:this.$t("message.天")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeWeek,label:this.$t("message.周")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeMonth,label:this.$t("message.月")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeYear,label:this.$t("message.年")}),e},addToList(){var e=this.numberList[this.numberList.length-1].value+1;this.numberList[this.numberList.length-1].max=e,this.numberList.push({id:this.numberList.length+1,value:e,min:e-1})},on_picker_show(e){e&&(this.viewshow=!1)},get_previous_max(e){if(e.id>1)return this.numberList[e.id-2].value},on_radio_change_time(e){console.log("====on_radio_change_time 1==========",e,this.breakOption),e==l?this.breakOption=n.Z.def.BreakOption.BreakOptionTimeSecond:e==o&&(this.breakOption=n.Z.def.BreakOption.BreakOptionTimeMinute),console.log("====on_radio_change_time 2==========",e,this.breakOption),this.confirm()},on_change_num(e){1==this.numberList.length||(e.id==this.numberList.length?e.value<=this.numberList[e.id-2].value&&setTimeout((()=>{e.value=this.numberList[e.id-2].value+1}),10):1==e.id?e.value>=this.numberList[e.id].value&&setTimeout((()=>{e.value=this.numberList[e.id].value-1}),10):(e.value>=this.numberList[e.id].value&&setTimeout((()=>{e.value=this.numberList[e.id].value-1}),10),e.value<=this.numberList[e.id-2].value&&setTimeout((()=>{e.value=this.numberList[e.id-2].value+1}),10))),this.confirm()},isDateTimeType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||e.type!=n.Z.def.DataType.DataTypeDatetime)},isNumberType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||e.type!=n.Z.def.DataType.DataTypeNumber)},isBasicListType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||!n.Z.def.DataType.isBasicListType(e.type))},showSettingIcon(e){if(e)if(e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeEventProp||e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeUserProp||e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeUserTag){if(e.type==n.Z.def.DataType.DataTypeNumber||e.type==n.Z.def.DataType.DataTypeDatetime)return!0;if(n.Z.def.DataType.isBasicListType(e.type))return!0}else e.data_source_type,n.Z.def.DataSourceType.DataSourceTypeUserCluster},on_select_change(e){this.breakOption=n.Z.def.BreakOption.BreakOptionNormal,this.isNumberType(e)?this.breakOption=n.Z.def.BreakOption.BreakOptionNumberDefault:this.isDateTimeType(e)?(this.timeSummary=this.PERIOD_SUMMARY_NO,this.breakOption=n.Z.def.BreakOption.BreakOptionTimeSecond):this.isBasicListType(e)&&(this.breakOption=n.Z.def.BreakOption.BreakOptionListWhole),this.editing_field=e,this.confirm()}},watch:{},computed:{}},c=u,p=i(1001),d=(0,p.Z)(c,a,s,!1,null,"202cb59e",null),h=d.exports},90309:function(e,t,i){i.d(t,{Z:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meClass"},[t("div",[t("ConditionGroup",{attrs:{group:e.filterable},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"condItem"},[t("PropCondition",{staticClass:"pading2",attrs:{favorites:e.favorites,eventProps:e.eventProps,userProps:e.userProps,userGroups:e.userGroups,userTags:e.userTags},on:{change:e.on_change_condition},model:{value:i.item.record,callback:function(t){e.$set(i.item,"record",t)},expression:"slotProps.item.record"}}),t("span",{on:{click:function(t){return e.on_click_add(e.filterable,i.item.id,i.item.level)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加条件")}},[t("b-icon",{staticClass:"condIcon",attrs:{icon:"filter-variant-plus",size:"is-small"}})],1)],1),!e.keepLast||e.groupItemCount(e.filterable)>1?t("span",{on:{click:function(t){return e.on_click_trash(e.filterable,i.item.id)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.删除条件")}},[t("b-icon",{staticClass:"condIcon",attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1):e._e()],1)]}}])})],1)])},s=[],n=i(97461),r=i(17818),l=i(794),o={components:{PropCondition:n.Z,ConditionGroup:r.Z},model:{prop:"filters",event:"filterschange"},props:{keepLast:{type:Boolean,default:!0},favorites:{type:String,default:"aa"},filters:{type:Object,default:function(){return{logicop:l.Z.def.LogicOp.LogicOpAnd,children:[{id:1,label:"label1",record:{pickersubject:{}}}]}}},eventProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber}]},userProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:l.Z.def.PropertyType.getZhLabel(l.Z.def.PropertyType.PropertyTypeCustom),type:l.Z.def.DataType.DataTypeNumber}]},userGroups:{type:Array,default:()=>[]},userTags:{type:Array,default:()=>[]}},data(){return{selectedEvent:"",filterable:{}}},created(){this.filterable=this.filters},mounted(){},watch:{filters(e,t){l.Z.utils.Ignore(t),this.filterable.children=e.children,this.filterable.logicop=e.logicop},eventProps(e,t){l.Z.utils.Ignore(e,t)}},methods:{on_click_add(e,t,i){l.Z.condx.GroupAdd(e,t,i,{record:{pickersubject:{}}})},on_click_trash(e,t){l.Z.condx.GroupRemove(e,t)},onMetricChange(e,t,i,a){l.Z.utils.Ignore(e,t,i,a)},on_event_change(e){this.selectedEvent=e},on_change_condition(e){l.Z.utils.Ignore(e)},groupItemCount(e){return l.Z.condx.GroupItemCount(e)}}},u=o,c=i(1001),p=(0,c.Z)(u,a,s,!1,null,"b60fea14",null),d=p.exports},69793:function(e,t,i){e.exports=i.p+"img/table-large.07f1ecc3.svg"},99877:function(e,t,i){i.d(t,{ZP:function(){return n}});const a={};function s(e){return Object.keys(e).reduce(((t,i)=>(!1!==e[i]&&null!==e[i]&&void 0!==e[i]&&(t[i]=e[i]),t)),{})}const n={name:"InlineSvg",inheritAttrs:!1,render(e){return this.svgElSource?e("svg",{on:this.$listeners,attrs:Object.assign(this.getSvgAttrs(this.svgElSource),s(this.$attrs)),domProps:{innerHTML:this.getSvgContent(this.svgElSource)}}):null},props:{src:{type:String,required:!0},title:{type:String},transformSource:{type:Function,default:e=>e},keepDuringLoading:{type:Boolean,default:!0}},data(){return{svgElSource:null}},watch:{src(e){this.getSource(e)}},mounted(){this.getSource(this.src)},methods:{getSvgAttrs(e){let t={};const i=e.attributes;if(!i)return t;for(let a=i.length-1;a>=0;a--)t[i[a].name]=i[a].value;return t},getSvgContent(e){return e=e.cloneNode(!0),e=this.transformSource(e),this.title&&r(e,this.title),e.innerHTML},getSource(e){a[e]||(a[e]=this.download(e)),this.svgElSource&&a[e].getIsPending()&&!this.keepDuringLoading&&(this.svgElSource=null,this.$emit("unloaded")),a[e].then((e=>{this.svgElSource=e,this.$nextTick((()=>{this.$emit("loaded",this.$el)}))})).catch((t=>{this.svgElSource&&(this.svgElSource=null,this.$emit("unloaded")),delete a[e],this.$emit("error",t)}))},download(e){return l(new Promise(((t,i)=>{const a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=()=>{if(a.status>=200&&a.status<400)try{const e=new DOMParser,s=e.parseFromString(a.responseText,"text/xml");let n=s.getElementsByTagName("svg")[0];n?t(n):i(new Error('Loaded file is not valid SVG"'))}catch(e){i(e)}else i(new Error("Error loading SVG"))},a.onerror=i,a.send()})))}}};function r(e,t){const i=e.getElementsByTagName("title");if(i.length)i[0].textContent=t;else{const i=document.createElementNS("http://www.w3.org/2000/svg","title");i.textContent=t,e.insertBefore(i,e.firstChild)}}function l(e){if(e.getIsPending)return e;let t=!0,i=e.then((e=>(t=!1,e)),(e=>{throw t=!1,e}));return i.getIsPending=function(){return t},i}}}]);