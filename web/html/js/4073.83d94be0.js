(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[4073],{16393:function(e,t,s){"use strict";s.d(t,{Z:function(){return u}});var r=function(){var e=this,t=e._self._c;return t("span",{ref:"me",staticClass:"crf_dropview"},[t("div",{class:{dropviewSlot:!0},attrs:{id:e.cuid,readonly:""}},[e._t("default")],2),t("div",{directives:[{name:"show",rawName:"v-show",value:e.viewshow,expression:"viewshow"}],class:{dropviewPad:!0,Fixedposition:!e.IsSelfTrigger,Absposition:e.IsSelfTrigger}},[e._t("body"),t("div",{on:{click:e.on_item_click}},[e._t("clickbody")],2)],2)])},i=[],a=s(794),o=s(23029),l={props:{position:String,viewoffsetx:{type:Number,defualt:-100},viewoffsety:{type:Number,defualt:0},triggerkey:String},data(){return{cuid:"",triggerUid:"",viewshow:!1}},created(){this.cuid=(0,o.Z)(),this.triggerUid=this.cuid,a.Z.utils.IsEmptyStr(this.triggerkey)||(this.triggerUid=a.Z.utils.ParseStrSafe(this.triggerkey))},mounted(){document.addEventListener("click",this.dc,!0)},beforeDestroy(){document.removeEventListener("click",this.dc,!0)},methods:{dc(e){var t=this.$refs.me,s=document.getElementById(this.triggerUid);s.contains(e.target)||t.contains(e.target)?(this.viewshow=!0,this.adjustPopPosition()):this.viewshow=!1},showDropView(e){this.triggerUid=e,this.viewshow=!0,this.adjustPopPosition()},adjustPopPosition(){var e=document.getElementById(this.triggerUid),t=this.$refs.me,s=e,r=t.getElementsByClassName("dropviewPad")[0];this.viewshow?(r.style.display="block","bottomleft"==this.position?this.bottom_left(r,s):this.bottom_right(r,s)):r.style.display="none"},bottom_right(e,t){var s={},r=t.getBoundingClientRect();this.IsSelfTrigger?(s.left=r.width+this.viewoffsetx,s.top=r.height+this.viewoffsety):(s.left=r.left,s.top=r.top+r.height),e.style.left=s.left+"px",e.style.top=s.top+"px"},bottom_left(e,t){var s={},r=t.getBoundingClientRect();this.IsSelfTrigger?(s.left=r.width+this.viewoffsetx,s.top=r.height+this.viewoffsety):(s.left=r.left,s.top=r.top+r.height),e.style.left=s.left+"px",e.style.top=s.top+"px"},on_item_click(){this.viewshow=!1}},computed:{IsSelfTrigger:function(){return this.cuid==this.triggerUid}}},n=l,d=s(1001),c=(0,d.Z)(n,r,i,!1,null,"6a629e34",null),u=c.exports},33762:function(e,t,s){"use strict";s.d(t,{Z:function(){return p}});var r=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_newreport"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.创建报表")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.报表名称"),prop:"name"}},[t("el-input",{staticClass:"w200",attrs:{placeholder:e.$t("message.请输入报表名称"),size:"medium",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:e.$t("message.选择或新建报表组"),prop:"reportGroup"}},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择报表组"),size:"medium","default-first-option":"","multiple-limit":1,filterable:"","allow-create":""},on:{change:e.on_change_folder},model:{value:e.formData.reportGroup,callback:function(t){e.$set(e.formData,"reportGroup",t)},expression:"formData.reportGroup"}},e._l(e.folderData,(function(s){return t("el-option",{key:s.value,attrs:{label:s.label,value:s.value}},[t("div",{staticClass:"rowLeftCenter"},[1==s.level?t("div",{}):e._e(),2==s.level?t("div",{staticClass:"space10"}):e._e(),3==s.level?t("div",{staticClass:"space20"}):e._e(),s.is_folder?t("i",{staticClass:"el-icon-folder mr5"}):t("i",{staticClass:"el-icon-document mr5"}),e._v(" "+e._s(s.label)+" ")])])})),1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},i=[],a=(s(57658),s(47056)),o=s(794),l=s(63822),n={props:{},data(){return{folderData:[],newDialog:{show:!1},formData:{name:"",reportGroup:"",spaceOwnerId:0},rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:10,message:this.$t("message.长度在 2 到 10 个字符"),trigger:"blur"}],reportGroup:[{required:!0,message:this.$t("message.不能为空"),trigger:"blur"}]}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t){console.log("showDialog",e,t),this.formData.name="",this.formData.spaceOwnerId=0==t?0:this.getCurrAccountId(),this.ApiGetReportGroup(o.Z.utils.ParseNumberSafe(e)),this.newDialog.show=!0},on_change_folder(e){this.formData.spaceOwnerId=this.getFolderSpaceOwner(e)},getFolderSpaceOwner(e){return this.folderData.forEach((t=>{if(t.value==e)return t.spaceOwnerId})),0},ApiGetReportGroup(e){a.Z["new"]().reportGroupFullGet({app_id:this.getCurrAppId(),space_owner_id:this.getCurrAccountId()}).then(function(t){var s=[];t.data.forEach((e=>{e.is_share_folder||(s.push({value:e.id,label:e.label,level:1,is_folder:!0,space_owner_id:e.space_owner_id}),e.children&&e.children.forEach((t=>{t.is_folder&&s.push({value:t.id,label:t.label,level:2,is_folder:t.is_folder,space_owner_id:e.space_owner_id})})))})),this.folderData=s,this.folderData.forEach((t=>{t.value===e&&(this.formData.reportGroup=e)}))}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))},addReportNode(e,t,s){return a.Z["new"]().reportGroupAdd({label:e,app_id:this.getCurrAppId(),is_folder:t,parent_id:o.Z.utils.ParseNumberSafe(s),space_owner_id:this.formData.spaceOwnerId})},getParentFolder(){var e;return this.folderData&&this.folderData.length>0&&this.folderData.forEach((t=>{t.value===this.formData.reportGroup&&(e=new Promise((e=>{e(t.value)})))})),void 0===e?this.addReportNode(this.formData.reportGroup,!0,0).then((e=>new Promise((t=>{t(e.data.id)})))):e},confirm(e){var t=!0;if(this.$refs[e].validate((e=>{if(!e)return t=!1,!1})),t){var s=this.getParentFolder();s.then((e=>(this.ApiGetReportGroup(e),this.addReportNode(this.formData.name,!1,e).then((e=>new Promise((t=>{t(e.data.id)}))))))).then((e=>{this.$emit("confirm",e),this.newDialog.show=!1})).catch((e=>{o.Z.utils.Err(this,e)}))}}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},d=n,c=s(1001),u=(0,c.Z)(d,r,i,!1,null,"5d13b9f0",null),p=u.exports},99966:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Q}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root"},[t("div",{staticClass:"twoColumn"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.hideLeftTree,expression:"!hideLeftTree"}],staticClass:"leftside"},[t("div",{staticClass:"leftside_toolbar"},[t("el-input",{staticClass:"StatisticPageinputDeep",attrs:{placeholder:e.$t("message.搜索名字")},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),t("div",[e.FunPointEnableEdit()?t("b-dropdown",{attrs:{triggers:["hover"],"aria-role":"list"},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("b-icon",{staticClass:"addreport",attrs:{size:"default",icon:"plus"}})]},proxy:!0}],null,!1,1826314494)},[t("b-dropdown-item",{attrs:{"aria-role":"listitem"},on:{click:e.showNewReport}},[e._v(e._s(e.$t("message.新建报表")))]),t("b-dropdown-item",{attrs:{"aria-role":"listitem"},on:{click:e.showNewReportGroup}},[e._v(e._s(e.$t("message.新建报表组")))])],1):e._e()],1)],1),t("div",{staticClass:"leftside_view onSliderScroll"},[t("div",[t("div",{staticClass:"spaceTitle"},[e._v(e._s(e.$t("message.我的空间")))]),t("el-tree",{ref:"treeSelf",attrs:{data:e.reportTreeSelf,"node-key":"id","expand-on-click-node":!0,"default-expanded-keys":e.currTreeSelfReportIdList,draggable:"","filter-node-method":e.filterNode,"highlight-current":!0,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-click":e.selectTreeSelfReportItem,"node-drag-end":function(t){return e.saveTree(!0)}},scopedSlots:e._u([{key:"default",fn:function({node:s}){return t("span",{staticClass:"custom-tree-node"},[t("div",{class:{rowbetween:!0,rowbetween1:1==s.level,rowbetween2:2==s.level,rowbetween3:3==s.level}},[t("div",{staticClass:"leftnode_label"},[s.expanded&&s.data.is_folder?t("i",{staticClass:"el-icon-folder-opened treeIcon"}):s.data.is_folder?t("i",{staticClass:"el-icon-folder treeIcon"}):t("i",{staticClass:"el-icon-document treeIcon"}),s.data.is_share_folder?t("span",[e._v(e._s(e.$t("message.共享给我的")))]):t("span",[e._v(e._s(s.label))])]),e.FunPointEnableEdit()&&!s.data.is_share_folder?t("div",{staticClass:"minicon"},[t("b-icon",{staticClass:"leftnode_icon",attrs:{id:"nodeid"+s.data.id,size:"default",icon:"dots-vertical"}}),t("DropView",{attrs:{triggerkey:"nodeid"+s.data.id},scopedSlots:e._u([{key:"clickbody",fn:function(){return[s.data.is_folder?t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.showNewReport(s.data)}}},[e._v(e._s(e.$t("message.新建报表")))]):e._e(),1==s.level?t("div",{staticClass:"dropviewitem",on:{click:function(t){e.showNewReportGroup(s,e.getCurrAccountId())}}},[e._v(e._s(e.$t("message.新建报表组")))]):e._e(),t("div",{staticClass:"dropviewitem",on:{click:function(e){"showDialogRename"(s.data.id,s.label)}}},[e._v(e._s(e.$t("message.重命名")))]),s.data.is_folder||s.data.share_from_id>0?e._e():t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.moveNode(s)}}},[e._v(e._s(e.$t("message.移动至")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.shareNode(s)}}},[e._v(e._s(e.$t("message.共享")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.removeNode(s)}}},[e._v(e._s(e.$t("message.删除")))])]},proxy:!0}],null,!0)})],1):e._e()])])}}])})],1),t("div",[e.ManageEnableAnalystAtLeast()?t("div",{staticClass:"spaceTitle"},[e._v(e._s(e.$t("message.公共空间")))]):e._e(),t("el-tree",{directives:[{name:"show",rawName:"v-show",value:e.ManageEnableAnalystAtLeast(),expression:"ManageEnableAnalystAtLeast()"}],ref:"treeApp",attrs:{data:e.reportTreeApp,"node-key":"id","expand-on-click-node":!0,"default-expanded-keys":e.currTreeAppReportIdList,draggable:"","filter-node-method":e.filterNode,"highlight-current":!0,"allow-drop":e.allowDrop,"allow-drag":e.allowDrag},on:{"node-click":e.selectTreeAppReportItem,"node-drag-end":function(t){return e.saveTree(!1)}},scopedSlots:e._u([{key:"default",fn:function({node:s}){return t("span",{staticClass:"custom-tree-node"},[t("div",{class:{rowbetween:!0,rowbetween1:1==s.level,rowbetween2:2==s.level,rowbetween3:3==s.level}},[t("div",{staticClass:"leftnode_label"},[s.expanded&&s.data.is_folder?t("i",{staticClass:"el-icon-folder-opened treeIcon"}):s.data.is_folder?t("i",{staticClass:"el-icon-folder treeIcon"}):t("i",{staticClass:"el-icon-document treeIcon"}),e._v(" "+e._s(s.label)+" ")]),e.FunPointEnableEdit()?t("div",{staticClass:"minicon"},[t("b-icon",{staticClass:"leftnode_icon",attrs:{id:"nodeid"+s.data.id,size:"default",icon:"dots-vertical"}}),t("DropView",{attrs:{triggerkey:"nodeid"+s.data.id},scopedSlots:e._u([{key:"clickbody",fn:function(){return[s.data.is_folder?t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.showNewReport(s.data)}}},[e._v(e._s(e.$t("message.新建报表")))]):e._e(),1==s.level?t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.showNewReportGroup(s,0)}}},[e._v(e._s(e.$t("message.新建报表组")))]):e._e(),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.showDialogRename(s.data.id,s.label)}}},[e._v(e._s(e.$t("message.重命名")))]),s.data.is_folder?e._e():t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.moveNode(s)}}},[e._v(e._s(e.$t("message.移动至")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.shareNode(s)}}},[e._v(e._s(e.$t("message.共享")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.removeNode(s)}}},[e._v(e._s(e.$t("message.删除")))])]},proxy:!0}],null,!0)})],1):e._e()])])}}])})],1)])]),e.refreshRight?e._e():t("div",{staticClass:"rightside"},[t("div",{staticClass:"rightsidetoolbar"},[t("div",{staticClass:"rowLeftCenter"},[t("span",{staticClass:"reportTitle"},[e._v(e._s(e.currentReportData.label))])]),e.FunPointEnableEdit()?t("div",{staticClass:"rowRightCenter"},[t("div",{staticClass:"whiteIcon32 ml5",on:{click:e.refreshAnalysisListAll}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.刷新全部图表")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-24px",size:"default",icon:"refresh"}})],1)],1),t("div",{staticClass:"whiteIcon32 ml5",on:{click:function(t){e.hideLeftTree=!e.hideLeftTree}}},[e.hideLeftTree?e._e():t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.折叠左侧")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-24px",size:"default",icon:"unfold-more-vertical"}})],1),e.hideLeftTree?t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.展开左侧")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-24px",size:"default",icon:"unfold-less-vertical"}})],1):e._e()],1),t("DropView",{staticClass:"dropview ml5",attrs:{viewoffsetx:-75,viewoffsety:5},scopedSlots:e._u([{key:"body",fn:function(){return[t("div",{staticClass:"dropviewitem",on:{click:e.showSetDialog}},[e._v(e._s(e.$t("message.报表设置")))])]},proxy:!0}],null,!1,2944623902)},[t("div",{staticClass:"whiteIcon32"},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.更多")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-24px",size:"default",icon:"dots-horizontal"}})],1)],1)]),e.currentReportData&&e.currentReportData.share_from_id>0?e._e():t("DropView",{staticClass:"dropview ml5",attrs:{viewoffsetx:-75,viewoffsety:5},scopedSlots:e._u([{key:"body",fn:function(){return[t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeEvent)}}},[e._v(e._s(e.$t("message.事件分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeFunnel)}}},[e._v(e._s(e.$t("message.漏斗分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeRetention)}}},[e._v(e._s(e.$t("message.留存分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeDistribution)}}},[e._v(e._s(e.$t("message.分布分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeInterval)}}},[e._v(e._s(e.$t("message.间隔分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypePath)}}},[e._v(e._s(e.$t("message.路径分析")))]),t("div",{staticClass:"dropviewitem",on:{click:function(t){return e.jumpToAnalysis(e.pub.def.AnalysisType.AnalysisTypeProperty)}}},[e._v(e._s(e.$t("message.属性分析")))])]},proxy:!0}],null,!1,343450753)},[t("div",{staticClass:"whiteIcon32"},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加分析组件")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-24px",size:"default",icon:"plus"}})],1)],1)])],1):e._e()]),t("div",{staticClass:"graphList"},[e.layoutReport.length>0?t("div",{staticClass:"gridGraph"},[t("grid-layout",{attrs:{layout:e.layoutReport,"col-num":4,"row-height":160,"is-draggable":!0,"is-resizable":!0,"vertical-compact":!0,"use-css-transforms":!0},on:{"update:layout":function(t){e.layoutReport=t}}},e._l(e.layoutReport,(function(r,i){return t("grid-item",{key:i,attrs:{static:!1,x:r.x,y:r.y,w:r.w,h:r.h,i:r.i,minW:r.minw,"drag-allow-from":".vuedraggablehandle","drag-ignore-from":".nodragpad"},on:{move:e.saveLayout,resized:e.saveLayout}},[t("div",{staticClass:"graphpad"},[t("div",{staticClass:"graphToolbar"},[t("div",{staticClass:"graphName",on:{click:function(t){return e.editRecord(r.analysis_id)}}},[e._v(e._s(r._analysis?r._analysis.name:""))]),t("div",{staticClass:"vuedraggablehandle"}),t("div",{staticClass:"graphButtons"},[e.FunPointEnableEdit()?t("div",{on:{click:function(t){return e.refreshAnalysisList(r.analysis_id)}}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-12px",icon:"refresh"}})],1):e._e(),t("DropView",{staticClass:"dropview",attrs:{viewoffsetx:-100,viewoffsety:0},scopedSlots:e._u([{key:"clickbody",fn:function(){return e._l(r._charttypevaluelist,(function(i,a){return t("div",{key:a,staticClass:"dropviewitem w100",on:{click:function(t){return e.on_chart_change(r,i.value)}}},[t("inline-svg",{attrs:{width:"16",height:"16",src:s(97773)("./"+i.icon+".svg")}}),e._v(" "+e._s(i.label)+" ")],1)}))},proxy:!0}],null,!0)},[e.getChartTypeIcon(r.chart_type)?t("div",{staticClass:"size24 centerd span_button"},[t("inline-svg",{attrs:{width:"16",height:"16",src:s(97773)("./"+e.getChartTypeIcon(r.chart_type)+".svg")}})],1):e._e()]),!e.FunPointEnableEdit()||e.currentReportData&&e.currentReportData.share_from_id>0?e._e():t("DropView",{staticClass:"dropview",attrs:{viewoffsetx:-100,viewoffsety:0},scopedSlots:e._u([{key:"clickbody",fn:function(){return[t("div",{staticClass:"dropviewitem w100",on:{click:function(t){return e.removeAnalysis(r.analysis_id)}}},[e._v(e._s(e.$t("message.移除")))])]},proxy:!0}],null,!0)},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-12px",icon:"dots-horizontal"}})],1)],1)]),r.loadingok?t("div",{staticClass:"nodragpad onSliderScroll",style:{height:160*r.h-45+"px"}},[r.refresh_err?t("el-alert",{attrs:{title:e.$t("message.数据刷新错误")+":"+r.refresh_err,type:"warning",closable:!1}}):"table"!=r.chart_type?t("div",{staticClass:"chartDiv",attrs:{id:"chartViewContainer"+r.analysis_id}},[t("ChartView",{attrs:{option:r._graph,containerId:"chartViewContainer"+r.analysis_id}})],1):t("TablePlusSummaryCellEdit",{attrs:{tableData:r._tabledata,narrow:""}})],1):t("div",{staticClass:"centerd"},[t("i",{staticClass:"el-icon-loading mr5"})])])])})),1)],1):e._e()])])]),t("NewReport",{ref:"newReport",on:{confirm:e.on_newreport}}),t("DialogNewReportGroup",{ref:"newReportGroup",on:{confirm:e.on_newreportgroup}}),t("DialogRename",{ref:"dialogRename",on:{confirm:e.on_dialogrename}}),t("DialogReportSet",{ref:"dialogreportset",on:{confirm:e.on_dialogreportset}}),t("DialogMoveReport",{ref:"dialogmovereport",on:{confirm:e.on_dialogmovereport}}),t("DialogShareReport",{ref:"dialogsharereport",on:{confirm:e.on_dialogsharereport}}),t("div",{staticClass:"footer"})],1)},i=[],a=(s(57658),s(47056)),o=s(794),l=s(63822),n=s(16393),d=s(33762),c=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_newreportgroup"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$t("message.新建报表组"))+" ")]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.名称"),prop:"name"}},[t("el-input",{staticClass:"w200",attrs:{placeholder:e.$t("message.请输入名称"),size:"medium",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:e.$t("message.位置")}},[t("el-radio-group",{attrs:{size:"small"},on:{input:function(t){e.formData.reportGroup=""}},model:{value:e.formData.position,callback:function(t){e.$set(e.formData,"position",t)},expression:"formData.position"}},[t("el-radio-button",{attrs:{label:e.getCurrAccountId()}},[e._v(e._s(e.$t("message.我的空间")))]),t("el-radio-button",{attrs:{label:0}},[e._v(e._s(e.$t("message.公共空间")))])],1)],1),t("div",[t("el-form-item",{attrs:{label:e.$t("message.报表组")}},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择报表组"),size:"medium","default-first-option":"",clearable:"","multiple-limit":1,filterable:""},model:{value:e.formData.reportGroup,callback:function(t){e.$set(e.formData,"reportGroup",t)},expression:"formData.reportGroup"}},e._l(e.ParentNodList,(function(s){return t("el-option",{key:s.value,attrs:{label:s.label,value:s.value}},[t("div",{staticClass:"rowLeftCenter"},[1==s.level?t("div",{}):e._e(),2==s.level?t("div",{staticClass:"space10"}):e._e(),3==s.level?t("div",{staticClass:"space20"}):e._e(),s.is_folder?t("i",{staticClass:"el-icon-folder mr5"}):t("i",{staticClass:"el-icon-document mr5"}),e._v(" "+e._s(s.label)+" ")])])})),1)],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},u=[],p={props:{},data(){return{treeAppNodeList:[],treeSelfNodeList:[],newDialog:{show:!1},formData:{name:"",reportGroup:"",position:0},rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:10,message:this.$t("message.长度在 2 到 10 个字符"),trigger:"blur"}]}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t){this.formData.name="",this.newDialog.show=!0,this.formData.reportGroup="",t&&(this.formData.position=t),console.log(e),e&&e.data&&e.data.id?(console.log(e),this.ApiGetReportGroupApp(o.Z.utils.ParseNumberSafe(e.data.id)),this.ApiGetReportGroupSelf(o.Z.utils.ParseNumberSafe(e.data.id))):(this.ApiGetReportGroupApp(),this.ApiGetReportGroupSelf())},ApiGetReportGroupApp(e){a.Z["new"]().reportGroupTreeList({app_id:this.getCurrAppId(),space_owner_id:0}).then(function(t){var s=[];t.data.forEach((e=>{s.push({value:e.id,label:e.label,level:1,is_folder:!0})})),this.treeAppNodeList=s,this.treeAppNodeList.forEach((t=>{t.value===e&&(this.formData.position=0,this.formData.reportGroup=e)}))}.bind(this)).catch((function(e){console.log(e)}))},ApiGetReportGroupSelf(e){var t=o.Z.utils.ParseNumberSafe(this.getCurrAccountId());t>0?a.Z["new"]().reportGroupTreeList({app_id:this.getCurrAppId(),space_owner_id:o.Z.utils.ParseNumberSafe(this.getCurrAccountId())}).then(function(t){var s=[];t.data.forEach((e=>{e.is_share_folder||s.push({value:e.id,label:e.label,level:1,is_folder:!0})})),this.treeSelfNodeList=s,this.treeSelfNodeList.forEach((t=>{t.value===e&&(this.formData.position=this.getCurrAccountId(),this.formData.reportGroup=e),console.log(t,e,t.id===e)}))}.bind(this)).catch((function(e){console.log(e)})):o.Z.utils.Err(this,{msg:"fail to get account information"})},confirm(e){var t=!0;this.$refs[e].validate((e=>{if(!e)return t=!1,!1})),t&&a.Z["new"]().reportGroupAdd({label:this.formData.name,app_id:this.getCurrAppId(),is_folder:!0,space_owner_id:o.Z.utils.ParseNumberSafe(this.formData.position),parent_id:o.Z.utils.ParseNumberSafe(this.formData.reportGroup)}).then(function(e){o.Z.utils.Ignore(e),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"}),ParentNodList:function(){return 0==this.formData.position?this.treeAppNodeList:this.treeSelfNodeList}}},h=p,f=s(1001),m=(0,f.Z)(h,c,u,!1,null,"4edb17bc",null),g=m.exports,v=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_sharereport"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$t("message.共享"))+" "),t("span",[e._v(e._s(e.formData.name))])]),t("div",{staticClass:"dialogBody"},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择"),size:"small"},model:{value:e.selectShareItem,callback:function(t){e.selectShareItem=t},expression:"selectShareItem"}},e._l(e.SelectableShare,(function(s){return t("el-option-group",{key:s.label,attrs:{label:s.label,size:"small"}},e._l(s.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e}})})),1)})),1),t("el-button",{staticClass:"w80 ml15",attrs:{size:"small"},on:{click:e.on_click_add}},[e._v(e._s(e.$t("message.添加")))]),t("div",{staticClass:"sharetable"},[t("div",{staticClass:"sharerow"},[t("div",{staticClass:"sharecell1 shareheader"},[e._v(" "+e._s(e.$t("message.名称"))+" ")]),t("div",{staticClass:"sharecell2 shareheader"},[e._v(" "+e._s(e.$t("message.操作"))+" ")])]),e.ShareToAccoutList.length>0?t("div",{staticClass:"sharerowcontent"},e._l(e.ShareToAccoutList,(function(s){return t("div",{key:s.id,staticStyle:{width:"100%"}},[t("div",{staticClass:"sharerow"},[t("div",{staticClass:"sharecell1"},[e._v(" "+e._s(s.label)+" ")]),t("div",{staticClass:"sharecell2"},[t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteRow(s.id,e.ShareToAccoutList)}}},[e._v("移除")])],1)])])})),0):t("el-empty",{attrs:{description:e.$t("message.暂无数据")}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:e.confirm}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},_=[],w=s(32900),y={props:{},data(){return{SelectableShare:[],AccountAllMap:new Map,GroupAllMap:new Map,ShareToAccoutList:[],selectShareItem:"",newDialog:{show:!1},formData:{id:0,name:"",reportGroup:"",position:0}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t){this.formData.name=t,this.formData.id=e,this.initialize(),this.newDialog.show=!0},initialize(){this.SelectableShare=[];var e=this.loadMemberList(),t=this.loadMemberGroupList(),s=this.postGetShareReportAccountList(),r=Promise.all([e,t,s]);r.then((e=>{var t={label:this.$t("message.成员组"),children:[]},s={label:this.$t("message.成员"),children:[]};t.children=e[1].data,t.children.forEach((e=>{e.label=e.name,e.value="s"+e.id,e.member_list=[],this.GroupAllMap.set(e.value,e)})),s.children=e[0].data,s.children=s.children.filter((e=>e.id!=this.getCurrAccountId())),s.children.forEach((e=>{e.value="a"+e.id,this.AccountAllMap.set(e.value,e),e.group_list&&e.group_list.length>0&&e.group_list.forEach((t=>{var s=this.GroupAllMap.get("s"+t);void 0!==s&&s.member_list.push(e.id)}))})),this.SelectableShare=[t,s],this.ShareToAccoutList=e[2].data})).catch((e=>{o.Z.utils.Err(this,e)}))},loadMemberList(){return w.Z["new"]().MemberList({})},loadMemberGroupList(){return w.Z["new"]().MemberGroupList({})},deleteRow(e){this.ShareToAccoutList=this.ShareToAccoutList.filter((t=>t.id!=e))},on_click_add(){if(this.selectShareItem&&this.selectShareItem.value&&0==this.selectShareItem.value.indexOf("s")){var e=this.GroupAllMap.get(this.selectShareItem.value);e.member_list.forEach((e=>{var t=this.AccountAllMap.get("a"+e);void 0!==t&&this.append_account(t)}))}else if(this.selectShareItem&&this.selectShareItem.value&&0==this.selectShareItem.value.indexOf("a")){var t=this.AccountAllMap.get(this.selectShareItem.value);void 0!==t&&this.append_account(t)}},append_account(e){for(var t=0;t<this.ShareToAccoutList.length;t++)if(this.ShareToAccoutList[t].id==e.id)return;this.ShareToAccoutList.push(e)},postShareReport(){var e=[];this.ShareToAccoutList.forEach((t=>{e.push(t.id)})),a.Z["new"]().reportGroupNodeShareTo({id:this.formData.id,account_id:e}).then(function(e){o.Z.utils.Ignore(e),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))},postGetShareReportAccountList(){return a.Z["new"]().reportGroupNodeShareList({id:this.formData.id})},confirm(){this.postShareReport()}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},b=y,D=(0,f.Z)(b,v,_,!1,null,"236c8365",null),C=D.exports,A=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_dialogrename"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.重命名")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"100px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:"",prop:"newname"}},[t("el-input",{staticClass:"w250",attrs:{autocomplete:"off",maxlength:"18",size:"medium"},model:{value:e.formData.newname,callback:function(t){e.$set(e.formData,"newname",t)},expression:"formData.newname"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},R=[],I={props:{},data(){var e=(e,t,s)=>{""===t?s(new Error(this.$t("message.名称"))):((this.formData.newname.length<3||this.formData.newname.length>18)&&s(new Error(this.$t("message.长度在 3 到 18 个字符"))),s())};return{uid:0,newDialog:{show:!1,type:""},formData:{newname:""},rules:{newname:[{required:!0,trigger:"blur"},{validator:e,trigger:"blur"}]}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t,s){this.uid=e,this.newDialog.type=s,this.formData.newname=t,this.newDialog.show=!0},changepwd(){},confirm(e){var t=!0;this.$refs[e].validate((e=>{if(!e)return t=!1,!1})),t&&this.RenameApiReportNode()},RenameApiReportNode(){a.Z["new"]().reportGroupNodeNamechange({name:this.formData.newname,id:this.uid}).then(function(e){o.Z.utils.Ignore(e),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){o.Z.utils.Success(this,e)}.bind(this))}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId"})}},S=I,T=(0,f.Z)(S,A,R,!1,null,"6c8f1076",null),$=T.exports,k=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_movereport"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.移动至")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.报表名称"),prop:"name"}},[t("el-input",{staticClass:"w200",attrs:{size:"medium",disabled:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("el-form-item",{attrs:{label:e.$t("message.选择或新建报表组"),prop:"folderId"}},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择报表组"),size:"medium","default-first-option":"","multiple-limit":1,filterable:"","allow-create":""},on:{change:e.on_change_folder},model:{value:e.formData.folderId,callback:function(t){e.$set(e.formData,"folderId",t)},expression:"formData.folderId"}},e._l(e.folderData,(function(s){return t("el-option",{key:s.value,attrs:{label:s.label,value:s.value}},[t("div",{staticClass:"rowLeftCenter"},[1==s.level?t("div",{}):e._e(),2==s.level?t("div",{staticClass:"space10"}):e._e(),3==s.level?t("div",{staticClass:"space20"}):e._e(),s.is_folder?t("i",{staticClass:"el-icon-folder mr5"}):t("i",{staticClass:"el-icon-document mr5"}),e._v(" "+e._s(s.label)+" ")])])})),1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},Z=[],x={props:{},data(){return{folderData:[],newDialog:{show:!1},formData:{name:"",folderId:"",spaceOwnerId:0,srcId:0},rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:10,message:this.$t("message.长度在 2 到 10 个字符"),trigger:"blur"}],folderId:[{required:!0,message:this.$t("message.不能为空"),trigger:"blur"}]}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t){this.formData.name=t,this.formData.srcId=e,this.formData.spaceOwnerId=0,this.ApiGetReportGroup(),this.newDialog.show=!0},on_change_folder(e){this.folderData.forEach((t=>{t.value==e&&(this.formData.spaceOwnerId=t.space_owner_id)}))},ApiGetReportGroup(){a.Z["new"]().reportGroupFullGet({app_id:this.getCurrAppId(),space_owner_id:this.getCurrAccountId()}).then(function(e){var t=[];e.data.forEach((e=>{e.is_share_folder||(t.push({value:e.id,label:e.label,level:1,is_folder:!0,space_owner_id:e.space_owner_id}),e.children&&e.children.forEach((s=>{s.is_folder&&t.push({value:s.id,label:s.label,level:2,is_folder:s.is_folder,space_owner_id:e.space_owner_id})})))})),this.folderData=t}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))},confirm(e){var t=!0;this.$refs[e].validate((e=>{if(!e)return t=!1,console.log("error submit!!"),!1})),t?a.Z["new"]().reportGroupNodeMove({id:this.formData.srcId,folder_id:this.formData.folderId,space_owner_id:this.formData.spaceOwnerId}).then(function(e){o.Z.utils.Ignore(e),this.$emit("confirm",this.formData.srcId),this.newDialog.show=!1}.bind(this)).catch((e=>{o.Z.utils.Err(this,e)})):console.log("error submit!!222")}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},L=x,G=(0,f.Z)(L,k,Z,!1,null,"870f3cb4",null),E=G.exports,N=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_dialogrename"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.报表设置"))+" "+e._s(e.formData.name))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"100px",model:e.formData}},[t("el-form-item",{attrs:{label:e.$t("message.更新方式")}},[t("el-switch",{attrs:{"active-value":"daily","inactive-value":"manual","active-text":e.$t("message.自动"),"inactive-text":e.$t("message.手动")},model:{value:e.formData.RefreshMode,callback:function(t){e.$set(e.formData,"RefreshMode",t)},expression:"formData.RefreshMode"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},P=[],M={props:{},data(){return{uid:0,newDialog:{show:!1},formData:{RefreshMode:o.Z.def.RefreshMode.RefreshModeDaily}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t,s){this.uid=e,this.newDialog.name=t,this.formData.RefreshMode=s,this.newDialog.show=!0},confirm(){a.Z["new"]().reportGroupNodeRefreshModechange({refresh_mode:this.formData.RefreshMode,id:this.uid}).then(function(e){o.Z.utils.Ignore(e),o.Z.utils.Success(this,this.$t("message.操作成功")),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId"})}},z=M,O=(0,f.Z)(z,N,P,!1,null,"7185c15e",null),B=O.exports,j=s(36144),U=s(95705),V=s(23533),F=s(62147),q=s(99877),J={components:{DropView:n.Z,NewReport:d.Z,GridLayout:V.GridLayout,GridItem:V.GridItem,TablePlusSummaryCellEdit:j.Z,ChartView:U.Z,InlineSvg:q.ZP,DialogRename:$,DialogNewReportGroup:g,DialogMoveReport:E,DialogShareReport:C,DialogReportSet:B},data(){return{hideLeftTree:!1,activeSpace:"first",reportTreeApp:[],reportTreeSelf:[],layoutReport:[],analysisList:[],activeReportId:0,currTreeAppReportId:0,currTreeSelfReportId:0,currentReportData:{},filterText:"",refreshRight:!1,rules:{name:[{required:!0,message:this.$t("message.请输入名称"),trigger:"blur"},{min:2,max:10,message:this.$t("message.长度在 2 到 10 个字符"),trigger:"blur"}],parentId:[{required:!0,message:this.$t("message.请选择报表组"),trigger:"change"}]}}},mounted(){this.initialize()},methods:{...(0,l.nv)({setLastReportId:"system/setLastReportId"}),FunPointEnableEdit(){return this.$store.getters["system/getGrantCheck"]("dashboard/report/edit")},ManageEnableAnalystAtLeast(){return o.Z.def.ManageRole.GreaterThanMember(this.getManageRole())},initialize(){this.activeReportId=o.Z.utils.ParseNumberSafe(this.getLastReportId()),this.loadAllTree(this.activeReportId)},loadAllTree(e){if(this.getCurrAccountId()>0){var t=this.getReportTreeApp(),s=this.getReportTreeSelf(),r=Promise.all([t,s]);r.then((t=>{o.Z.utils.Ignore(t),this.chooseDefaultReport([this.reportTreeApp,this.reportTreeSelf],e)})).catch((e=>{o.Z.utils.Err(this,e)}))}else this.$router.push({path:"/login"})},getReportTreeApp(){return a.Z["new"]().reportGroupTreeList({app_id:this.getCurrAppId(),space_owner_id:0}).then(function(e){this.ManageEnableAnalystAtLeast()&&(this.reportTreeApp=e.data)}.bind(this))},getReportTreeSelf(){return a.Z["new"]().reportGroupTreeList({app_id:this.getCurrAppId(),space_owner_id:o.Z.utils.ParseNumberSafe(this.getCurrAccountId())}).then(function(e){this.reportTreeSelf=e.data}.bind(this))},chooseDefaultReport(e,t){for(var s=0;s<e.length;s++){var r=e[s],i=r===this.reportTreeSelf;r.forEach((e=>{if(0==o.Z.utils.ParseNumberSafe(t)){if(!e.is_folder)return void this.selectReportItem(e,i);for(var s=0;s<e.children.length;s++){if(!e.children[s].is_folder)return void this.selectReportItem(e.children[s],i);for(var r=0;r<e.children[s].children.length;r++)if(!e.children[s].children[r].is_folder)return void this.selectReportItem(e.children[s].children[r],i)}}else{if(!e.is_folder&&e.id==t)return void this.selectReportItem(e,i);for(s=0;s<e.children.length;s++){if(!e.children[s].is_folder&&e.children[s].id==t)return void this.selectReportItem(e.children[s],i);for(r=0;r<e.children[s].children.length;r++)if(!e.children[s].children[r].is_folder&&e.children[s].children[r].id==t)return void this.selectReportItem(e.children[s].children[r],i)}}}))}},selectTreeAppReportItem(e){this.selectReportItem(e,!1)},selectTreeSelfReportItem(e){this.selectReportItem(e,!0)},selectReportItem(e,t){if(e&&!e.is_folder){var s=o.Z.utils.ParseJsonListSafe(e.layout_json_list);t?this.currTreeSelfReportId=e.id:this.currTreeAppReportId=e.id,this.activeReportId=e.id,this.setLastReportId(this.activeReportId),this.currentReportData=e,s.forEach((e=>{e.loading=!0,e.loadingok=!1})),this.layoutReport=s,this.loadAnalysisList()}t?this.$refs.treeSelf.setCurrentKey(this.currTreeSelfReportId):this.$refs.treeApp.setCurrentKey(this.currTreeAppReportId)},loadAnalysisList(){var e=this.currentReportData.analysis_id;console.log(e),a.Z["new"]().analysisListListByid({id:e}).then(function(e){var t=e.data;this.queryGraphData(t),this.analysisList=t}.bind(this)).catch((function(e){console.log(e)}))},queryGraphData(e){console.log("queryGraphData:",e),e.forEach((e=>{for(var t=0;t<this.layoutReport.length;t++)if(this.layoutReport[t].analysis_id==e.id){if(this.layoutReport[t].refresh_err=e.refresh_err,!e.refresh_err){var s,r=o.Z.utils.ParseJsonObjectSafe(e.post_resp_data);if(r.length>0&&(s=F.Z.QueryTableData(e.analysis_type,r)),this.layoutReport[t]._tabledata=s,this.layoutReport[t]._analysis=e,r.length>0){this.layoutReport[t]._charttypevaluelist=F.Z.GetChartTypeListByTypeRes(e.analysis_type,r);var i=this.layoutReport[t].chart_type,a=!1;this.layoutReport[t]._charttypevaluelist.forEach((e=>{i==e.value&&(a=!0)})),a||(i=this.layoutReport[t]._charttypevaluelist[0].value),this.layoutReport[t].chart_type=i,this.layoutReport[t]._graph=this.buildGraph(e.analysis_type,this.layoutReport[t].chart_type,this.layoutReport[t].show_option,this.layoutReport[t].report_config,r)}}this.layoutReport[t].loading=!1,this.layoutReport[t].loadingok=!0;break}}))},showNewReport(e){e?this.$refs.newReport.showDialog(e.id,e.space_owner_id):this.$refs.newReport.showDialog()},showDialogRename(e,t){this.$refs.dialogRename.showDialog(e,t)},showSetDialog(){this.currentReportData&&this.$refs.dialogreportset.showDialog(this.currentReportData.id,this.currentReportData.label,this.currentReportData.refresh_mode)},on_dialogreportset(){this.loadAllTree(this.activeReportId)},on_dialogrename(){this.getReportTreeSelf(),this.getReportTreeApp().then((()=>{this.currentReportData={},this.layoutReport={},this.$refs.treeApp.setCurrentKey(0),this.chooseDefaultReport()}))},on_dialogsharereport(){},on_dialogmovereport(){this.loadAllTree(this.activeReportId)},on_newreport(){this.getReportTreeSelf(),this.getReportTreeApp()},on_newreportgroup(){this.getReportTreeApp(),this.getReportTreeSelf()},showNewReportGroup(e,t){console.log(e,t),this.$refs.newReportGroup.showDialog(e,t)},updateLayout(e,t){o.Z.utils.Ignore(e,t);var s=JSON.stringify(t);this.reportTreeApp.forEach((t=>{for(var r=0;r<t.children.length;r++){if(t.children[r].id==e)return void(t.children[r].layout_json_list=s);for(var i=0;i<t.children[r].children.length;i++)if(t.children[r].children[i].id==e)return void(t.children[r].children[i].layout_json_list=s)}}))},saveTree(e){var t={};t.list=e?this.reportTreeSelf:this.reportTreeApp,a.Z["new"]().reportGroupUpdate(t).then(function(e){o.Z.utils.Ignore(e)}.bind(this)).catch((function(e){console.log(e)}))},removeNode(e){this.$confirm(this.$t("message.此操作将永久删除该项目x是否继续?",{name:e.data.label}),this.$t("message.信息"),{confirmButtonText:this.$t("message.确定"),cancelButtonText:this.$t("message.取消"),type:"warning"}).then((()=>{a.Z["new"]().reportGroupDelete({id:e.data.id,app_id:this.getCurrAppId()}).then(function(e){o.Z.utils.Ignore(e),o.Z.utils.Success(this,this.$t("message.删除成功")),this.loadAllTree()}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))})).catch((()=>{}))},moveNode(e){this.$refs.dialogmovereport.showDialog(e.data.id,e.data.label)},shareNode(e){this.$refs.dialogsharereport.showDialog(e.data.id,e.data.label)},removeAnalysis(e){for(var t,s=0;s<this.layoutReport.length;s++)if(this.layoutReport[s].analysis_id==e){this.layoutReport.splice(s,1),t=e;break}void 0!==t&&a.Z["new"]().reportRemoveAnalysis({id:this.activeReportId,analysis_id:o.Z.utils.ParseNumberSafe(t)}).then(function(e){o.Z.utils.Ignore(e),this.loadAllTree(this.activeReportId)}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))},allowDrop(e,t,s){return 1==e.level&&(t.level>=1&&"inner"==s||t.level>1)?(console.log("false",1),!1):e.level>1&&1==t.level&&"inner"!=s?(console.log("false",2),!1):!(t.data&&!t.data.is_folder&&"inner"==s)||(console.log("false",3),!1)},allowDrag(){return!0},refreshAnalysisListAll(){for(var e=0;e<this.layoutReport.length;e++){var t=this.layoutReport[e]._analysis;this.refreshAnalysisList(t.id)}},refreshAnalysisListLoop(e){if(console.log(e),e.length>0){var t=e.pop();this.refreshAnalysisList(t).then((()=>{this.refreshAnalysisListLoop(e)})).catch(function(t){o.Z.utils.Err(this,t),this.refreshAnalysisListLoop(e)}.bind(this))}},refreshAnalysisList(e){for(var t,s=0;s<this.layoutReport.length;s++)if(this.layoutReport[s].analysis_id==e){t=this.layoutReport[s],this.layoutReport[s].loadingok=!1,this.layoutReport[s].loading=!0;break}return void 0!==t?a.Z["new"]().analysisRefreshData({id:e}).then(function(e){t.loading=!1,t._analysis.post_resp_data=e.data.post_resp_data,t._analysis.refresh_err=e.data.refresh_err,t._analysis.refresh_time=e.data.refresh_time,t.refresh_time=e.data.refresh_time,this.refreshGraphViewAndTableView(t),t.loadingok=!0}.bind(this)).catch((e=>{t.loading=!1,t.loadingok=!0,o.Z.utils.Err(this,e)})):new Promise((e=>{e("invalid id")}))},refreshGraphViewAndTableView(e){if(e){var t=o.Z.utils.ParseJsonObjectSafe(e._analysis.post_resp_data);t.length>0&&(e._tabledata=F.Z.QueryTableData(e._analysis.analysis_type,t)),e._graph=this.buildGraph(e._analysis.analysis_type,e.chart_type,e.show_option,e.report_config,t)}},getChartTypeIcon(e){if(e){var t=o.Z.def.ChartType.getLabelValue(e);return t.icon}},buildGraph(e,t,s,r,i){if(t!=o.Z.def.ChartType.Table){o.Z.utils.Ignore(e,t,i);var a=o.Z.utils.ParseJsonObjectSafe(s),l=o.Z.utils.ParseJsonObjectSafe(r);return F.Z.QueryChartOption(e,t,i,a,l)}},on_chart_change(e,t){if(e.chart_type=t,e.chart_type!=o.Z.def.ChartType.Table&&void 0!==e._analysis){var s=o.Z.utils.ParseJsonObjectSafe(e._analysis.post_resp_data);e._graph=this.buildGraph(e._analysis.analysis_type,e.chart_type,e.show_option,e.report_config,s)}this.saveLayout()},refreshLayout(){var e=this.analysisList;this.analysisList=[],setTimeout((()=>{this.analysisList=e}),10)},saveLayout(){a.Z["new"]().reportSaveLayout({id:this.activeReportId,layout:this.layoutReport}).then(function(e){o.Z.utils.Ignore(e),this.updateLayout(this.activeReportId,this.layoutReport)}.bind(this)).catch(function(e){o.Z.utils.Err(this,e)}.bind(this))},editRecord(e){for(var t,s=0;s<this.analysisList.length;s++)if(this.analysisList[s].id==e){t=this.analysisList[s];break}if(t){var r=t,i=JSON.parse(r.client_data);o.Z.utils.IsEmptyObj(i)&&(i={}),i.id=r.id,i.name=r.name,i.respData=o.Z.utils.ParseJsonObjectSafe(r.post_resp_data),this.jumpToAnalysis(r.analysis_type,{client_data:i})}},jumpToAnalysis(e,t){var s={name:"analysisevent"};switch(e){case o.Z.def.AnalysisType.AnalysisTypeEvent:s.name="analysisevent";break;case o.Z.def.AnalysisType.AnalysisTypeFunnel:s.name="analysisfunnel";break;case o.Z.def.AnalysisType.AnalysisTypeRetention:s.name="analysisretention";break;case o.Z.def.AnalysisType.AnalysisTypeLtv:s.name="analysisltv";break;case o.Z.def.AnalysisType.AnalysisTypeDistribution:s.name="analysisdistribute";break;case o.Z.def.AnalysisType.AnalysisTypeInterval:s.name="analysisinterval";break;case o.Z.def.AnalysisType.AnalysisTypePath:s.name="analysispath";break;case o.Z.def.AnalysisType.AnalysisTypeProperty:s.name="analysisprop";break}o.Z.utils.IsEmptyObj(t)&&(t={}),t.report_id=this.activeReportId,s.params=t,this.$router.push(s)},filterNode(e,t){return!e||-1!==t.label.indexOf(e)}},watch:{filterText(e){this.$refs.treeApp.filter(e),this.$refs.treeSelf.filter(e)}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId",getManageRole:"system/getManageRole",getCurrAccountId:"system/getCurrAccountId",getLastReportId:"system/getLastReportId"}),currTreeAppReportIdList:function(){return[this.currTreeAppReportId]},currTreeSelfReportIdList:function(){return[this.currTreeSelfReportId]}}},H=J,K=(0,f.Z)(H,r,i,!1,null,"f7ac4dae",null),Q=K.exports},23029:function(e,t,s){"use strict";s.d(t,{Z:function(){return u}});const r="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var i={randomUUID:r};s(23767),s(8585),s(68696);let a;const o=new Uint8Array(16);function l(){if(!a&&(a="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(o)}s(57658);const n=[];for(let p=0;p<256;++p)n.push((p+256).toString(16).slice(1));function d(e,t=0){return n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]}function c(e,t,s){if(i.randomUUID&&!t&&!e)return i.randomUUID();e=e||{};const r=e.random||(e.rng||l)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=r[e];return t}return d(r)}var u=c},32900:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(91803);class i{static new(){return new i}login(e){return(0,r.Z)({url:"/api/portal/login",method:"post",data:e})}chpwd(e){return(0,r.Z)({url:"/api/portal/user/chpwd",method:"post",data:e})}Setpwd(e){return(0,r.Z)({url:"/api/portal/user/setpwd",method:"post",data:e})}MemberList(e){return(0,r.Z)({url:"/api/portal/user/list",method:"post",data:e})}MemberAdd(e){return(0,r.Z)({url:"/api/portal/user/add",method:"post",data:e})}MemberDelete(e){return(0,r.Z)({url:"/api/portal/user/delete",method:"post",data:e})}MemberUpdate(e){return(0,r.Z)({url:"/api/portal/user/update",method:"post",data:e})}MemberGet(e){return(0,r.Z)({url:"/api/portal/user/get",method:"post",data:e})}MemberGroupList(e){return(0,r.Z)({url:"/api/portal/usergroup/list",method:"post",data:e})}MemberGroupAdd(e){return(0,r.Z)({url:"/api/portal/usergroup/add",method:"post",data:e})}MemberGroupUpdate(e){return(0,r.Z)({url:"/api/portal/usergroup/update",method:"post",data:e})}MemberGroupDelete(e){return(0,r.Z)({url:"/api/portal/usergroup/delete",method:"post",data:e})}RoleList(e){return(0,r.Z)({url:"/api/portal/role/list",method:"post",data:e})}RoleAdd(e){return(0,r.Z)({url:"/api/portal/role/add",method:"post",data:e})}RoleUpdate(e){return(0,r.Z)({url:"/api/portal/role/update",method:"post",data:e})}RoleDelete(e){return(0,r.Z)({url:"/api/portal/role/delete",method:"post",data:e})}}},97773:function(e,t,s){var r={"./boxplot.svg":78676,"./boxplot2.svg":39006,"./chart-bar.svg":46980,"./chart-cumulative.svg":45413,"./chart-donut-variant.svg":64822,"./chart-line.svg":53481,"./chart-pie.svg":66097,"./chart-sankey.svg":7085,"./chart-scatter-plot.svg":46090,"./distribute-horizontal-center.svg":3543,"./flask-empty-outline.svg":34426,"./hexagon-slice-4.svg":19742,"./map.svg":76038,"./speedometer.svg":37751,"./table-large.svg":69793,"./vs.svg":21068,"./waves.svg":84530};function i(e){var t=a(e);return s(t)}function a(e){if(!s.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=97773},78676:function(e,t,s){"use strict";e.exports=s.p+"img/boxplot.830d642c.svg"},39006:function(e,t,s){"use strict";e.exports=s.p+"img/boxplot2.d70af34e.svg"},46980:function(e,t,s){"use strict";e.exports=s.p+"img/chart-bar.a27b4433.svg"},45413:function(e,t,s){"use strict";e.exports=s.p+"img/chart-cumulative.73aa0874.svg"},64822:function(e,t,s){"use strict";e.exports=s.p+"img/chart-donut-variant.7fc12b7c.svg"},53481:function(e,t,s){"use strict";e.exports=s.p+"img/chart-line.c84b9ae5.svg"},66097:function(e,t,s){"use strict";e.exports=s.p+"img/chart-pie.20b9dd18.svg"},7085:function(e,t,s){"use strict";e.exports=s.p+"img/chart-sankey.6afe618b.svg"},46090:function(e,t,s){"use strict";e.exports=s.p+"img/chart-scatter-plot.92c693bc.svg"},3543:function(e,t,s){"use strict";e.exports=s.p+"img/distribute-horizontal-center.f7df265f.svg"},34426:function(e,t,s){"use strict";e.exports=s.p+"img/flask-empty-outline.77e3be99.svg"},19742:function(e,t,s){"use strict";e.exports=s.p+"img/hexagon-slice-4.eec52121.svg"},76038:function(e,t,s){"use strict";e.exports=s.p+"img/map.07088126.svg"},37751:function(e,t,s){"use strict";e.exports=s.p+"img/speedometer.9e43f341.svg"},69793:function(e,t,s){"use strict";e.exports=s.p+"img/table-large.07f1ecc3.svg"},21068:function(e,t,s){"use strict";e.exports=s.p+"img/vs.cae95fd8.svg"},84530:function(e,t,s){"use strict";e.exports=s.p+"img/waves.25ac4130.svg"},99877:function(e,t,s){"use strict";s.d(t,{ZP:function(){return a}});const r={};function i(e){return Object.keys(e).reduce(((t,s)=>(!1!==e[s]&&null!==e[s]&&void 0!==e[s]&&(t[s]=e[s]),t)),{})}const a={name:"InlineSvg",inheritAttrs:!1,render(e){return this.svgElSource?e("svg",{on:this.$listeners,attrs:Object.assign(this.getSvgAttrs(this.svgElSource),i(this.$attrs)),domProps:{innerHTML:this.getSvgContent(this.svgElSource)}}):null},props:{src:{type:String,required:!0},title:{type:String},transformSource:{type:Function,default:e=>e},keepDuringLoading:{type:Boolean,default:!0}},data(){return{svgElSource:null}},watch:{src(e){this.getSource(e)}},mounted(){this.getSource(this.src)},methods:{getSvgAttrs(e){let t={};const s=e.attributes;if(!s)return t;for(let r=s.length-1;r>=0;r--)t[s[r].name]=s[r].value;return t},getSvgContent(e){return e=e.cloneNode(!0),e=this.transformSource(e),this.title&&o(e,this.title),e.innerHTML},getSource(e){r[e]||(r[e]=this.download(e)),this.svgElSource&&r[e].getIsPending()&&!this.keepDuringLoading&&(this.svgElSource=null,this.$emit("unloaded")),r[e].then((e=>{this.svgElSource=e,this.$nextTick((()=>{this.$emit("loaded",this.$el)}))})).catch((t=>{this.svgElSource&&(this.svgElSource=null,this.$emit("unloaded")),delete r[e],this.$emit("error",t)}))},download(e){return l(new Promise(((t,s)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=()=>{if(r.status>=200&&r.status<400)try{const e=new DOMParser,i=e.parseFromString(r.responseText,"text/xml");let a=i.getElementsByTagName("svg")[0];a?t(a):s(new Error('Loaded file is not valid SVG"'))}catch(e){s(e)}else s(new Error("Error loading SVG"))},r.onerror=s,r.send()})))}}};function o(e,t){const s=e.getElementsByTagName("title");if(s.length)s[0].textContent=t;else{const s=document.createElementNS("http://www.w3.org/2000/svg","title");s.textContent=t,e.insertBefore(s,e.firstChild)}}function l(e){if(e.getIsPending)return e;let t=!0,s=e.then((e=>(t=!1,e)),(e=>{throw t=!1,e}));return s.getIsPending=function(){return t},s}}}]);