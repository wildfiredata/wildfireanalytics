"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[5628],{55628:function(e,s,t){t.r(s),t.d(s,{default:function(){return d}});var i=function(){var e=this,s=e._self._c;return s("div",{staticClass:"root"},[s("div",{staticClass:"maintitle"},[e._v(e._s(e.$t("message.Debug实时数据查询")))]),s("div",{staticClass:"workerea"},[s("div",[s("div",{staticClass:"filter_work_erea"},[s("div",[s("span",{staticClass:"nonuserselect"},[e._v(e._s(e.$t("message.IP过滤")))]),e._v(" "),s("el-input",{staticClass:"ipinput",attrs:{size:"small",placeholder:e.$t("message.请输入IP地址或IP段")},model:{value:e.ips,callback:function(s){e.ips=s},expression:"ips"}}),s("span",{staticClass:"hint"},[e._v(e._s(e.$t("message.添加多个IP地址或IP段时请用英文逗号例如,,,,,")))])],1),s("div",[s("span",{staticClass:"nonuserselect"},[e._v(e._s(e.$t("message.数据过滤")))]),e._v(" "),e.filters.length<3?s("el-button",{attrs:{type:"plain",size:"mini",icon:"el-icon-plus"},on:{click:e.on_click_addfilter}},[e._v(e._s(e.$t("message.添加筛选")))]):e._e()],1),e._l(e.filters,(function(t,i){return s("div",{key:i,staticClass:"mt10"},[s("span",[e._v(e._s(e.$t("message.字段"))+":")]),s("el-input",{staticClass:"ml10 w300 mr20",attrs:{size:"small",placeholder:e.$t("message.请输入内容")},model:{value:t.key,callback:function(s){e.$set(t,"key",s)},expression:"filter.key"}}),s("span",[e._v(e._s(e.$t("message.字段值"))+":")]),s("el-input",{staticClass:"ml10 w300 mr20",attrs:{size:"small",placeholder:e.$t("message.请输入内容")},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"filter.value"}}),s("el-checkbox",{model:{value:t.reg,callback:function(s){e.$set(t,"reg",s)},expression:"filter.reg"}},[e._v(e._s(e.$t("message.使用正则匹配")))]),s("span",{on:{click:function(s){return e.deletefilter(i)}}},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除该条筛选",placement:"top"}},[s("i",{staticClass:"el-icon-delete ml50"})])],1)],1)})),s("div",{staticClass:"mt10"},[e.debuging?e._e():s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-video-play"},on:{click:e.StartWatch}},[e._v(e._s(e.$t("message.开启实时查询")))]),e.debuging?s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-video-pause"},on:{click:e.StopWatch}},[e._v(e._s(e.$t("message.暂停实时查询")))]):e._e()],1),s("div",{staticClass:"alginright"},[s("div",{staticClass:"warning mr10"},[e._v(e._s(e.errMessage))]),s("b-input",{attrs:{placeholder:e.$t("message.查询内容,,,"),type:"search",icon:"magnify",size:"is-small"},model:{value:e.searchText,callback:function(s){e.searchText=s},expression:"searchText"}}),s("b-select",{staticClass:"ml10",attrs:{size:"is-small"},model:{value:e.perPage,callback:function(s){e.perPage=s},expression:"perPage"}},e._l(e.pageTypeOptions,(function(t){return s("option",{key:t.value,domProps:{value:t.value}},[e._v(e._s(t.label)+" ")])})),0)],1),s("div",{staticClass:"tableerea"},[s("b-table",{staticClass:"my-table",attrs:{data:e.filteredRows,columns:e.columns,paginated:!0,"per-page":e.perPage,"pagination-size":"is-small",narrowed:""}})],1)],2)])])])},a=[],l=(t(30541),t(57658),t(63822)),r=t(90948),n=t(794),o={components:{},data(){return{MAX_ROW:600,receiveCount:0,perPage:10,pageTypeOptions:[],socket:"",hidePredefine:!0,debuging:!1,filters:[{key:"",value:"",reg:!1}],ips:"",uploadRows:[],columns:[{field:"id",label:"ID",width:"40",numeric:!0},{field:"ip",label:"IP",width:"40",numeric:!0},{field:"msg",width:"calc(100vw - 60px)",label:this.$t("message.内容")}],searchText:"",errMessage:""}},mounted(){this.initialize()},methods:{...(0,l.nv)({setApp:"system/setApp"}),initialize(){this.pageTypeOptions=n.Z.def.PageSizeType.getLabelValueList200(),"undefined"===typeof WebSocket&&n.Z.utils.Err(this,this.$t("message.您的浏览器不支持websocket"))},startWebSocket(){this.socket=new WebSocket((0,r.yI)()),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage},open(){console.log("socket连接成功"),this.send()},error(){console.log("连接错误")},getMessage(e){var s=String(e.data);const t="track",i="track:".length,a="overflow",l="error";if(0==s.indexOf(l))this.errMessage=s,n.Z.utils.Err(this,s),this.StopWatch();else if(0==s.indexOf(a))this.errMessage=this.$t("message.收到的数据太多了，缓冲拥塞，建议添加数据过滤后，重新开启实时查询"),n.Z.utils.Err(this,this.errMessage),this.StopWatch();else if(0==s.indexOf(t)&&s.length>i){this.receiveCount++;const e=s.indexOf("[")+1,t=s.indexOf("]");var r="";e>0&&t>e&&(r=s.substring(e,t)),this.uploadRows.unshift({id:this.receiveCount,ip:r,msg:s.substring(i)}),this.uploadRows.length>this.MAX_ROW&&this.uploadRows.splice(this.uploadRows.length-1,1)}},send(){var e=JSON.stringify({app:this.getCurrAppId(),list:this.filters,ip:this.ips});this.socket.send(e)},close(){console.log("socket已经关闭")},on_click_addfilter(){this.filters.push({key:"",value:"",reg:!1})},deletefilter(e){this.filters.splice(e,1)},StartWatch(){this.debuging=!0,this.uploadRows=[],this.receiveCount=0,this.startWebSocket(),this.errMessage=""},StopWatch(){this.debuging=!1,this.errMessage="",this.socket&&(this.socket.close(),this.socket="")}},computed:{...(0,l.Se)({getCurrAppId:"system/getCurrAppId"}),filteredRows(){if(n.Z.utils.IsEmptyStr(this.searchText))return this.uploadRows;for(var e=[],s=0;s<this.uploadRows.length;s++){var t=this.uploadRows[s];t&&t.msg&&t.msg.indexOf(this.searchText)>=0&&e.push(t)}return e}}},c=o,p=t(1001),u=(0,p.Z)(c,i,a,!1,null,"0d174e34",null),d=u.exports}}]);