"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[7749],{37749:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("message.分析列表")))]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id","min-height":"250",border:"","default-expand-all":"","tree-props":{children:"children"}}},[t("el-table-column",{attrs:{prop:"id",label:"ID"}}),t("el-table-column",{attrs:{prop:"name",label:e.$t("message.名称")}}),t("el-table-column",{attrs:{prop:"analysis_type_label",label:e.$t("message.分析类型")}}),t("el-table-column",{attrs:{prop:"creator_label",label:e.$t("message.创建者")}}),t("el-table-column",{attrs:{label:e.$t("message.共享列表")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.share_to?t("div",{staticClass:"csssharelist"},e._l(a.share_to,(function(a){return t("div",{key:a.id},[t("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:a.value,placement:"top"}},[a.value&&a.value.length>0?t("div",{staticClass:"circleword"},[e._v(e._s(a.value[0]))]):t("div",{staticClass:"circleword"},[e._v(e._s(a.value))])])],1)})),0):e._e()]}}])}),t("el-table-column",{attrs:{label:e.$t("message.引用报表")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[a.used_report&&a.used_report.length>0?t("el-tooltip",{attrs:{effect:"light",placement:"top"}},[t("div",{attrs:{slot:"content"},slot:"content"},e._l(a.used_report,(function(a){return t("div",{key:a.type+a.id,attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s("report"==a.type?e.$t("message.分析报表"):e.$t("message.组合报表"))+":"+e._s(a.name)),t("br")])})),0),a.used_report&&a.used_report.length>0?t("div",[e._v(" "+e._s(e.$t("message.有"))+" ")]):e._e()]):t("div",[e._v(" "+e._s(e.$t("message.无"))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"refresh_time_str",label:e.$t("message.更新时间")}}),e.FunPointEnableEdit()?t("el-table-column",{attrs:{label:e.$t("message.操作")},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("div",[t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.editRecord(a)}}},[e._v(e._s(e.$t("message.编辑")))]),t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.shareRecord(a)}}},[e._v(e._s(e.$t("message.共享")))]),t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteFromList(a)}}},[e._v(e._s(e.$t("message.删除")))])],1)]}}],null,!1,181830858)}):e._e()],1),t("el-pagination",{staticClass:"paginator",attrs:{small:"","hide-on-single-page":!0,"page-size":e.PageInfo.page_size,"pager-count":7,"current-page":e.PageInfo.page,layout:"prev, pager, next",total:e.PageInfo.total},on:{"current-change":e.on_choose_page}}),t("DialogShareAnalysis",{ref:"dialogshareanalysis",on:{confirm:e.on_share_confirm}})],1)},r=[],l=(a(57658),a(47056)),i=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_sharemerged"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.$t("message.共享"))+" "),t("span",[e._v(e._s(e.formData.name))])]),t("div",{staticClass:"dialogBody"},[t("el-select",{staticClass:"w200",attrs:{placeholder:e.$t("message.请选择"),size:"small"},model:{value:e.selectShareItem,callback:function(t){e.selectShareItem=t},expression:"selectShareItem"}},e._l(e.SelectableShare,(function(a){return t("el-option-group",{key:a.label,attrs:{label:a.label,size:"small"}},e._l(a.children,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e}})})),1)})),1),t("el-button",{staticClass:"w80 ml15",attrs:{size:"small"},on:{click:e.on_click_add}},[e._v(e._s(e.$t("message.添加")))]),t("div",{staticClass:"sharetable"},[t("div",{staticClass:"sharerow"},[t("div",{staticClass:"sharecell1 shareheader"},[e._v(" "+e._s(e.$t("message.名称"))+" ")]),t("div",{staticClass:"sharecell2 shareheader"},[e._v(" "+e._s(e.$t("message.操作"))+" ")])]),e.ShareToAccoutList.length>0?t("div",{staticClass:"sharerowcontent"},e._l(e.ShareToAccoutList,(function(a){return t("div",{key:a.id,staticStyle:{width:"100%"}},[t("div",{staticClass:"sharerow"},[t("div",{staticClass:"sharecell1"},[e._v(" "+e._s(a.label)+" ")]),t("div",{staticClass:"sharecell2"},[t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteRow(a.id,e.ShareToAccoutList)}}},[e._v("移除")])],1)])])})),0):t("el-empty",{attrs:{description:e.$t("message.暂无数据")}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:e.confirm}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},o=[],n=a(32900),c=a(794),u=a(63822),d={props:{},data(){return{SelectableShare:[],AccountAllMap:new Map,GroupAllMap:new Map,ShareToAccoutList:[],selectShareItem:"",newDialog:{show:!1},formData:{id:0,name:"",reportGroup:"",position:0}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e,t,a){this.formData.name=t,this.formData.id=e,this.initialize(),this.ShareToAccoutList=c.Z.utils.DeepClone(a),this.newDialog.show=!0},initialize(){this.SelectableShare=[];var e=this.loadMemberList(),t=this.loadMemberGroupList(),a=Promise.all([e,t]);a.then((e=>{var t={label:this.$t("message.成员组"),children:[]},a={label:this.$t("message.成员"),children:[]};t.children=e[1].data,t.children.forEach((e=>{e.label=e.name,e.value="s"+e.id,e.member_list=[],this.GroupAllMap.set(e.value,e)})),a.children=e[0].data,a.children=a.children.filter((e=>e.id!=this.getCurrAccountId())),a.children.forEach((e=>{e.value="a"+e.id,this.AccountAllMap.set(e.value,e),e.group_list&&e.group_list.length>0&&e.group_list.forEach((t=>{var a=this.GroupAllMap.get("s"+t);void 0!==a&&a.member_list.push(e.id)}))})),this.SelectableShare=[t,a]})).catch((e=>{c.Z.utils.Err(this,e)}))},loadMemberList(){return n.Z["new"]().MemberList({})},loadMemberGroupList(){return n.Z["new"]().MemberGroupList({})},deleteRow(e){this.ShareToAccoutList=this.ShareToAccoutList.filter((t=>t.id!=e))},on_click_add(){if(this.selectShareItem&&this.selectShareItem.value&&0==this.selectShareItem.value.indexOf("s")){var e=this.GroupAllMap.get(this.selectShareItem.value);e.member_list.forEach((e=>{var t=this.AccountAllMap.get("a"+e);void 0!==t&&this.append_account(t)}))}else if(this.selectShareItem&&this.selectShareItem.value&&0==this.selectShareItem.value.indexOf("a")){var t=this.AccountAllMap.get(this.selectShareItem.value);void 0!==t&&this.append_account(t)}},append_account(e){for(var t=0;t<this.ShareToAccoutList.length;t++)if(this.ShareToAccoutList[t].id==e.id)return;this.ShareToAccoutList.push(e)},postShareReport(){var e=[];this.ShareToAccoutList.forEach((t=>{e.push(t.id)})),l.Z["new"]().analysisListShareTo({id:this.formData.id,account_id:e}).then(function(e){c.Z.utils.Ignore(e),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){c.Z.utils.Err(this,e)}.bind(this))},confirm(){this.postShareReport()}},computed:{...(0,u.Se)({getCurrAppId:"system/getCurrAppId",getCurrAccountId:"system/getCurrAccountId"})}},p=d,h=a(1001),m=(0,h.Z)(p,i,o,!1,null,"2cd4b6ef",null),_=m.exports;const g=a(36797);var f={components:{DialogShareAnalysis:_},data(){return{PageInfo:{page:1,page_size:10,total:0,page_count:0},tableData:[]}},mounted(){this.loadAnalysisList()},methods:{FunPointEnableEdit(){return this.$store.getters["system/getGrantCheck"]("dashboard/analysislist/edit")},on_choose_page(e){this.PageInfo.page=e,this.loadAnalysisList()},loadAnalysisList(){this.tableData=[],l.Z["new"]().analysisListList({app_id:this.getCurrAppId(),page:this.PageInfo.page,page_size:this.PageInfo.page_size}).then(function(e){var t=e.data.list;if(this.PageInfo=e.data.page_info,t)for(var a=0;a<t.length;a++){var s={id:t[a].id,name:t[a].name,refresh_time:t[a].refresh_time,client_data:t[a].client_data,analysis_type:t[a].analysis_type,post_resp_data:t[a].post_resp_data,used_report:t[a].used_report};t[a].creator_acount&&(s.creator_label=t[a].creator_acount.value),t[a].share_account&&(s.share_to=[],t[a].share_account.forEach((e=>{e.label=e.value,s.share_to.push(e)}))),s.analysis_type_label=c.Z.def.AnalysisType.getZhLabel(s.analysis_type),s.refresh_time_str=g(1e3*s.refresh_time).format("YYYY-MM-DD HH:mm:ss"),this.tableData.push(s)}}.bind(this)).catch((function(e){console.log(e)}))},deleteFromList(e){this.$confirm(this.$t("message.此操作将永久删除该项目x是否继续?",{name:e.name}),this.$t("message.信息"),{confirmButtonText:this.$t("message.确定"),cancelButtonText:this.$t("message.取消"),type:"warning"}).then((()=>{l.Z["new"]().analysisListDelete({id:e.id}).then(function(e){c.Z.utils.Ignore(e),this.loadAnalysisList()}.bind(this)).catch(function(e){c.Z.utils.Warn(this,e)}.bind(this))})).catch((()=>{}))},editRecord(e){var t=c.Z.utils.ParseJsonObjectSafe(e.client_data);t.id=e.id,t.name=e.name,t.respData=c.Z.utils.ParseJsonObjectSafe(e.post_resp_data);var a={name:"analysisevent",params:{client_data:t}};switch(e.analysis_type){case c.Z.def.AnalysisType.AnalysisTypeEvent:a.name="analysisevent";break;case c.Z.def.AnalysisType.AnalysisTypeFunnel:a.name="analysisfunnel";break;case c.Z.def.AnalysisType.AnalysisTypeRetention:a.name="analysisretention";break;case c.Z.def.AnalysisType.AnalysisTypeDistribution:a.name="analysisdistribute";break;case c.Z.def.AnalysisType.AnalysisTypeInterval:a.name="analysisinterval";break;case c.Z.def.AnalysisType.AnalysisTypePath:a.name="analysispath";break;case c.Z.def.AnalysisType.AnalysisTypeProperty:a.name="analysisprop";break}this.$router.push(a)},shareRecord(e){c.Z.utils.Ignore(e),this.$refs.dialogshareanalysis.showDialog(e.id,e.name,e.share_to)},on_share_confirm(){this.loadAnalysisList()}},computed:{...(0,u.Se)({getCurrAppId:"system/getCurrAppId"})}},v=f,b=(0,h.Z)(v,s,r,!1,null,"2e6b657b",null),y=b.exports},32900:function(e,t,a){a.d(t,{Z:function(){return r}});var s=a(91803);class r{static new(){return new r}login(e){return(0,s.Z)({url:"/api/portal/login",method:"post",data:e})}chpwd(e){return(0,s.Z)({url:"/api/portal/user/chpwd",method:"post",data:e})}Setpwd(e){return(0,s.Z)({url:"/api/portal/user/setpwd",method:"post",data:e})}MemberList(e){return(0,s.Z)({url:"/api/portal/user/list",method:"post",data:e})}MemberAdd(e){return(0,s.Z)({url:"/api/portal/user/add",method:"post",data:e})}MemberDelete(e){return(0,s.Z)({url:"/api/portal/user/delete",method:"post",data:e})}MemberUpdate(e){return(0,s.Z)({url:"/api/portal/user/update",method:"post",data:e})}MemberGet(e){return(0,s.Z)({url:"/api/portal/user/get",method:"post",data:e})}MemberGroupList(e){return(0,s.Z)({url:"/api/portal/usergroup/list",method:"post",data:e})}MemberGroupAdd(e){return(0,s.Z)({url:"/api/portal/usergroup/add",method:"post",data:e})}MemberGroupUpdate(e){return(0,s.Z)({url:"/api/portal/usergroup/update",method:"post",data:e})}MemberGroupDelete(e){return(0,s.Z)({url:"/api/portal/usergroup/delete",method:"post",data:e})}RoleList(e){return(0,s.Z)({url:"/api/portal/role/list",method:"post",data:e})}RoleAdd(e){return(0,s.Z)({url:"/api/portal/role/add",method:"post",data:e})}RoleUpdate(e){return(0,s.Z)({url:"/api/portal/role/update",method:"post",data:e})}RoleDelete(e){return(0,s.Z)({url:"/api/portal/role/delete",method:"post",data:e})}}}}]);