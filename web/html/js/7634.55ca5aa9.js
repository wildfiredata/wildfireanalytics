"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[7634],{97634:function(e,t,i){i.d(t,{Z:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_EventMetric"}},[t("el-input",{class:{inputDefaultClass:!0},attrs:{size:e.fontSize,placeholder:e.inputPlaceHolder,"suffix-icon":e.inputSuffixIcon,readonly:""},on:{blur:e.input_onblur,focus:e.input_onfocus},model:{value:e.valueText,callback:function(t){e.valueText=t},expression:"valueText"}}),t("el-input",{staticStyle:{position:"fixed",width:"2000px",transform:"translateY(-9999px)"},attrs:{size:e.fontSize,readonly:""}},[t("span",{ref:"autowidthspan",attrs:{slot:"prefix"},slot:"prefix"},[e._v(e._s(e.autowidthspanText))])]),t("el-cascader-panel",{directives:[{name:"show",rawName:"v-show",value:e.viewshow,expression:"viewshow"}],staticClass:"pickview1",attrs:{options:e.metrics},on:{change:e.on_cascader_change},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1)},r=[],l=(i(57658),i(794)),p={model:{prop:"modelvalue",event:"modelvaluechange"},props:{eventProps:{type:Array,default:()=>[{value:"guild_name",label:"公会名字",type:l.Z.def.DataType.DataTypeString},{value:"guild_member",label:"公会人数",type:l.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"会长",type:l.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",type:l.Z.def.DataType.DataTypeNumber}]},modelvalue:String,entities:{type:Array,default:()=>[{value:"1",label:"用户"},{value:"2",label:"账号"}]},extra:{type:Object,default:function(){return{}}},defaulted:{type:Boolean,default:!0},autoDropWidth:{type:Boolean,default:!0},dropWidth:{type:String,default:"180px"},dropHight:{type:String,default:"80px"},fontSize:{type:String,default:"mini"},inputPlaceHolder:{type:String,default:""},inputSuffixIcon:{type:String,default:""},premetrics:{type:Array,default:()=>[]},selectValues:{type:Array,default:()=>[]},formatInput:{type:Function,default(e){var t="";return 2===e.length?t=e[0].label+"."+e[1].label:3===e.length?t=e[1].label+"."+e[2].label:1===e.length&&(t=e[0].label),t}}},data(){return{selected:[],metrics:[],modelValueRef:"",valueText:"",viewshow:!1}},created(){document.addEventListener("click",this.dc,!0),this.initialize()},mounted(){this.canChooseLeaf(this.modelValueRef)?this.selectLeaf(this.modelValueRef):this.defaulted&&this.setDefaultItem()},beforeDestroy(){document.removeEventListener("click",this.dc,!0)},watch:{eventProps(e){this.loadMetrics(e),!this.canChooseLeaf(this.modelValueRef)&&this.defaulted&&this.setDefaultItem(),this.displayValueText()}},computed:{autowidthspanText:function(){return this.valueText&&this.valueText.length>0?this.valueText:this.inputPlaceHolder}},methods:{dc(e){this.viewshow=this.$refs.me.contains(e.target)},initialize(){this.modelValueRef=this.modelvalue,this.loadMetrics(this.eventProps),this.displayValueText()},input_onfocus(){this.viewshow=!0},input_onblur(){},autoWidthAdjust(){if(this.$refs.autowidthspan){var e=this.$refs.autowidthspan.getClientRects();if(e){var t=this.$refs.me.getElementsByClassName("inputDefaultClass")[0],i=0;this.$refs.autowidthspan.innerHTML&&this.$refs.autowidthspan.innerHTML.length>1&&(i=2*this.$refs.autowidthspan.innerHTML.split(" ").length),e[0]&&(l.Z.utils.IsEmptyStr(this.inputSuffixIcon)?t.style.width=e[0].width+i+10+"px":t.style.width=e[0].width+i+10+25+"px")}}},setDefaultItem(){this.selected=[],this.metrics.length>0&&this.selected.push(this.metrics[0].value),this.confirm()},canChooseLeaf(e){if(l.Z.utils.IsEmptyStr(e))return!1;var t=l.Z.utils.DeepClone(this.metrics);while(t&&t.length>0){for(var i=[],a=0;a<t.length;a++){if(t[a].value===e)return!0;t[a].children&&t[a].children.length>0&&(i=i.concat(t[a].children))}t=i}return!1},selectLeaf(e){var t=this.getPathNodes(e);this.selected=t},displayValueText(){var e=this.getPathNodes(this.modelValueRef);this.valueText=this.formatInput(e),setTimeout((()=>this.autoWidthAdjust()),100)},on_cascader_change(){this.confirm()},confirm(){if(this.selected&&this.selected.length>0){var e=this.selected[this.selected.length-1];this.modelValueRef=e,this.displayValueText(),this.$emit("modelvaluechange",e),this.$emit("change",e,{extra:this.extra,text:this.valueText})}this.viewshow=!1},getPathNodes(e){var t=[];if(l.Z.utils.IsEmptyStr(e))return t;var i=l.Z.utils.DeepClone(this.metrics),a=!0;while(a){a=!1;for(var r={},p=0;p<i.length;p++){if(e==i[p].value)return t.push({value:i[p].value,label:i[p].label}),t;0==e.indexOf(i[p].value)&&(l.Z.utils.IsEmptyObj(r)||r.value.length<i[p].value.length)&&(r=i[p])}if(l.Z.utils.IsEmptyObj(r)||(t.push({value:r.value,label:r.label}),i=r.children,a=!0),!i||i.length<=0||!a)return console.log("fail to match metric",e,a,i),t}return t},appendParentPath(e,t){var i=l.Z.utils.DeepClone(t);return i.value=e.value+"."+i.value,i},loadMetrics(e){if(this.selected="",this.metrics=[{value:l.Z.def.MetricCategory.MetricCategoryEvent+"."+l.Z.def.MetricType.MetricTypeCount,label:this.$t("message.总次数")}],this.premetrics&&this.premetrics.length>0&&(this.metrics=this.metrics.concat(this.premetrics)),this.entities.length>0){for(var t={value:l.Z.def.MetricCategory.MetricCategoryEntity,label:this.$t("message.主体"),children:[]},i=0;i<this.entities.length;i++)t.children.push({value:l.Z.def.MetricCategory.MetricCategoryEntity+"."+this.entities[i].value,label:this.entities[i].label,children:[{value:l.Z.def.MetricCategory.MetricCategoryEntity+"."+this.entities[i].value+"."+l.Z.def.MetricType.MetricTypeCountDistinctEntity,label:this.$t("message.去重数")},{value:l.Z.def.MetricCategory.MetricCategoryEntity+"."+this.entities[i].value+"."+l.Z.def.MetricType.MetricTypeCountPerEntity,label:this.$t("message.平均次数")}]});this.metrics.push(t)}var a={value:l.Z.def.MetricType.MetricTypeNumberSum,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberSum)},r={value:l.Z.def.MetricType.MetricTypeNumberMax,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberMax)},p={value:l.Z.def.MetricType.MetricTypeNumberMin,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberMin)},s={value:l.Z.def.MetricType.MetricTypeNumberAvg,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberAvg)},n={value:l.Z.def.MetricType.MetricTypeCountDistinctProp,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeCountDistinctProp)},c={value:l.Z.def.MetricType.MetricTypeNumberVarsamp,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberVarsamp)},u={value:l.Z.def.MetricType.MetricTypeNumberStdsamp,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberStdsamp)},d={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"99",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"99")},h={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"95",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"95")},y={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"90",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"90")},f={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"80",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"80")},T={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"75",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"75")},o={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"70",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"70")},M={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"60",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"60")},Z={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"50",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"50")},b={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"40",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"40")},m={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"30",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"30")},v={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"25",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"25")},g={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"20",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"20")},P={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"10",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"10")},N={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"5",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"5")},L={value:l.Z.def.MetricType.MetricTypeNumberQuantile+"1",label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeNumberQuantile+"1")},x={value:l.Z.def.MetricType.MetricTypeListSetdistinct,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeListSetdistinct)},w={value:l.Z.def.MetricType.MetricTypeListEledistinct,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeListEledistinct)},C={value:l.Z.def.MetricType.MetricTypeBoolTrue,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeBoolTrue)},Q={value:l.Z.def.MetricType.MetricTypeBoolFalse,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeBoolFalse)},D={value:l.Z.def.MetricType.MetricTypeBoolNil,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeBoolNil)},S={value:l.Z.def.MetricType.MetricTypeBoolNotnil,label:l.Z.def.MetricType.getZhLabel(l.Z.def.MetricType.MetricTypeBoolNotnil)};for(i=0;i<e.length;i++){var E={value:l.Z.def.MetricCategory.MetricCategoryProp+"."+e[i].value,label:e[i].label,children:[]};E.children.push(this.appendParentPath(E,n)),e[i].type===l.Z.def.DataType.DataTypeBool?E.children.push(this.appendParentPath(E,C),this.appendParentPath(E,Q),this.appendParentPath(E,D),this.appendParentPath(E,S)):e[i].type===l.Z.def.DataType.DataTypeNumber?E.children.push(this.appendParentPath(E,a),this.appendParentPath(E,s),this.appendParentPath(E,r),this.appendParentPath(E,p),this.appendParentPath(E,c),this.appendParentPath(E,u),this.appendParentPath(E,d),this.appendParentPath(E,h),this.appendParentPath(E,y),this.appendParentPath(E,f),this.appendParentPath(E,T),this.appendParentPath(E,o),this.appendParentPath(E,M),this.appendParentPath(E,Z),this.appendParentPath(E,b),this.appendParentPath(E,m),this.appendParentPath(E,v),this.appendParentPath(E,g),this.appendParentPath(E,P),this.appendParentPath(E,N),this.appendParentPath(E,L)):e[i].type.startsWith("list")&&E.children.push(this.appendParentPath(E,x),this.appendParentPath(E,w)),this.metrics.push(E)}}}},s=p,n=i(1001),c=(0,n.Z)(s,a,r,!1,null,"8cf40686",null),u=c.exports}}]);