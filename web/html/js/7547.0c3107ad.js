(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[7547],{74855:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("span",{ref:"me"},[t("input",{staticClass:"inputDefaultClass",class:{titleSize:e.isTitle,mediumSize:e.isMedium,smallSize:e.isSmall,miniSize:e.isMini,fieldValue:!0,fieldControl:!0,warningBorder:e.isInvalid},attrs:{type:"text",placeholder:e.inputPlaceHolder},domProps:{value:e.valueText},on:{change:e.changeEvent}}),t("el-input",{staticStyle:{position:"fixed",width:"2000px",transform:"translateY(-9999px)"},attrs:{size:e.fontSize,readonly:""}},[t("span",{ref:"autowidthspan",class:{titleSize:e.isTitle},attrs:{slot:"prefix"},slot:"prefix"},[e._v(e._s(e.autowidthspanText))])])],1)},s=[],n=i(794),r={name:"EditLabel",model:{prop:"value",event:"input"},props:{value:{type:String},inputPlaceHolder:{String:String},isInvalid:{type:Boolean,default:!1},fontSize:{type:String,default:"medium"},autoWidth:{type:Boolean,default:!0}},data(){return{valueText:""}},watch:{value(e){this.valueText=e,this.$emit("change",e),this.autoWidthAdjust()}},created(){this.valueText=this.value},mounted(){this.autoWidthAdjust()},methods:{changeEvent(e){this.valueText=e.target.value,this.$emit("input",e.target.value),this.$emit("change",e.target.value),this.autoWidthAdjust()},autoWidthAdjust(e){this.autoWidth&&(n.Z.utils.Ignore(e),setTimeout((()=>{if(this.$refs.autowidthspan){var e=this.$refs.autowidthspan.getClientRects(),t=this.$refs.me,i=t.getElementsByClassName("inputDefaultClass")[0];if(e.length>0){var a=e[0].width+12;n.Z.utils.IsEmptyStr(this.inputPrefixIcon)||(a+=25),n.Z.utils.IsEmptyStr(this.inputSuffixIcon)||(a+=25),i.style.width=a+"px"}}}),10))}},computed:{autowidthspanText:function(){return this.valueText&&this.valueText.length>0?this.valueText:this.inputPlaceHolder},isMedium(){return"medium"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isSmall(){return"small"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isMini(){return"mini"==n.Z.utils.UnifiedElementFontSize(this.fontSize)},isTitle(){return"title"==this.fontSize}}},o=r,l=i(1001),c=(0,l.Z)(o,a,s,!1,null,"4dd8e01e",null),p=c.exports},52629:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return R}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root"},[t("div",{staticClass:"containerClass"},[t("div",{staticClass:"top_toolbar h40"},[t("div",[e.name?t("EditLabel",{staticClass:"h40 ml10",attrs:{fontSize:"title"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}):t("span",{staticClass:"title h40 ml10 nonuserselect"},[e._v(e._s(e.$t("message.留存分析")))])],1),t("div",{staticClass:"top_toolbar_erea"},[t("div",[t("span",{staticClass:"size12 nonuserselect"},[e._v(e._s(e.$t("message.选择分析主体")+":")+" ")]),t("el-select",{staticClass:"mr10 w120",attrs:{size:"mini",placeholder:e.$t("message.选择分析主体")},model:{value:e.EntityId,callback:function(t){e.EntityId=t},expression:"EntityId"}},e._l(e.EntityList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-select",{staticClass:"mr10 w120",attrs:{size:"mini",placeholder:e.$t("message.请选择默认分析时区")},model:{value:e.zone,callback:function(t){e.zone=t},expression:"zone"}},e._l(e.zones,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(t){return e.on_click_save(e.id)}}},[e._v(e._s(e.$t("message.保存")))]),t("SaveAnalysis",{ref:"saveAnalysis",on:{sucess:e.on_save_success}})],1),e.id>0?t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(t){return e.on_click_save(0)}}},[e._v(e._s(e.$t("message.另存为")))])],1):e._e(),t("div",{staticClass:"ml10 w100 h30"},[t("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:e.on_click_analyze}},[e._v(e._s(e.$t("message.计算")))])],1)],1)]),t("splitpanes",{staticClass:"default-theme"},[t("pane",{attrs:{size:e.paneSize,"max-size":"60"}},[t("div",{staticClass:"left-root"},[t("div",{staticClass:"left-work-area onSliderScroll"},[t("div",{staticClass:"title_area nonuserselect"},[e._v(e._s(e.$t("message.指标"))+" "),t("b-switch",{attrs:{size:"is-small",rounded:!1,"left-label":!0},model:{value:e.switchLinkProp,callback:function(t){e.switchLinkProp=t},expression:"switchLinkProp"}},[e._v(e._s(e.$t("message.关联属性")+"："))])],1),t("div",{staticClass:"metricArea"},[t("div",{staticClass:"matricLabelClass nonuserselect"},[t("div",[e._v(e._s(e.$t("message.起始事件")))])]),t("div",{staticClass:"mb10"},[t("el-select",{staticClass:"mr10",attrs:{size:"mini",filterable:"","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:function(t){return e.on_change_event(e.StartEvent)}},model:{value:e.StartEvent.event,callback:function(t){e.$set(e.StartEvent,"event",t)},expression:"StartEvent.event"}},e._l(e.EventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("span",{on:{click:function(t){return e.addTopEventPropCondition(e.StartEvent.combo)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),e.StartEvent.loadingOk?t("PropConditionGroup",{attrs:{eventProps:e.StartEvent.eventProps,keepLast:!1,userProps:[],userGroups:[],userTags:[]},model:{value:e.StartEvent.combo,callback:function(t){e.$set(e.StartEvent,"combo",t)},expression:"StartEvent.combo"}}):e._e(),e.switchLinkProp?t("div",{staticClass:"rowRightCenter mt10"},[t("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.$t("message.关联属性")+"："))]),t("SelectPicker",{attrs:{defaulted:!0,tabGroups:e.pickableStartEventProps,fontSize:e.fontSize},model:{value:e.StartEvent.link_prop_obj,callback:function(t){e.$set(e.StartEvent,"link_prop_obj",t)},expression:"StartEvent.link_prop_obj"}})],1):e._e()],1),t("div",{staticClass:"matricLabelClass nonuserselect"},[t("div",[e._v(e._s(e.$t("message.回访事件")))])]),t("div",{staticClass:"mb10"},[t("el-select",{staticClass:"mr10",attrs:{size:"mini",filterable:"","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:function(t){return e.on_change_event(e.ContinueEvent)}},model:{value:e.ContinueEvent.event,callback:function(t){e.$set(e.ContinueEvent,"event",t)},expression:"ContinueEvent.event"}},e._l(e.EventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("span",{on:{click:function(t){return e.addTopEventPropCondition(e.ContinueEvent.combo)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),e.ContinueEvent.loadingOk?t("PropConditionGroup",{attrs:{eventProps:e.ContinueEvent.eventProps,keepLast:!1,userProps:[],userGroups:[],userTags:[]},model:{value:e.ContinueEvent.combo,callback:function(t){e.$set(e.ContinueEvent,"combo",t)},expression:"ContinueEvent.combo"}}):e._e(),e.switchLinkProp?t("div",{staticClass:"rowRightCenter mt10"},[t("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.$t("message.关联属性")+"："))]),t("SelectPicker",{attrs:{defaulted:!0,tabGroups:e.pickableContinueEventProps,fontSize:e.fontSize},model:{value:e.ContinueEvent.link_prop_obj,callback:function(t){e.$set(e.ContinueEvent,"link_prop_obj",t)},expression:"ContinueEvent.link_prop_obj"}})],1):e._e()],1),t("div",{staticClass:"extraMeetricDiv"},[e._e(),e.extraMetricCheck?t("div",[t("el-select",{staticClass:"mr10",attrs:{size:"mini","default-first-option":!0,placeholder:e.$t("message.请选择")},on:{change:function(t){return e.on_change_event(e.extraMetric)}},model:{value:e.extraMetric.event,callback:function(t){e.$set(e.extraMetric,"event",t)},expression:"extraMetric.event"}},e._l(e.EventList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(e._s(e.$t("message.的"))+" "),e.extraMetric.loadingOk?t("EventMetric",{attrs:{eventProps:e.extraMetric.eventProps,entities:e.EntityList},model:{value:e.extraMetric.metric,callback:function(t){e.$set(e.extraMetric,"metric",t)},expression:"extraMetric.metric"}}):e._e(),t("span",{on:{click:function(t){return e.addTopEventPropCondition(e.extraMetric.combo)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加筛选")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),e.extraMetric.loadingOk?t("PropConditionGroup",{attrs:{eventProps:e.extraMetric.eventProps,keepLast:!1,userProps:e.UserPropList,userGroups:e.UserGroupList,userTags:e.UserTagList},model:{value:e.extraMetric.combo,callback:function(t){e.$set(e.extraMetric,"combo",t)},expression:"extraMetric.combo"}}):e._e()],1):e._e()],1)]),t("div",{staticClass:"title_area nonuserselect",on:{click:e.addGlobalFilter}},[e._v(e._s(e.$t("message.全局筛选"))+" "),t("div",{staticClass:"title_area_button"},[t("div",[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加全局筛选")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),t("div",[t("PropConditionGroup",{attrs:{eventProps:e.MultiEventPropList,keepLast:!1,userProps:e.UserPropList,userGroups:e.UserGroupList,userTags:e.UserTagList},model:{value:e.GlobalFilter,callback:function(t){e.GlobalFilter=t},expression:"GlobalFilter"}})],1),t("div",{staticClass:"title_area nonuserselect",on:{click:e.addGroupby}},[e._v(e._s(e.$t("message.分组"))),t("div",{staticClass:"title_area_button"},[t("div",[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加分组")}},[t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),t("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),t("div",[t("draggable",e._b({staticClass:"list-group",attrs:{tag:"ul"},on:{end:e.afterGroupbyDrag},model:{value:e.Groupbys.children,callback:function(t){e.$set(e.Groupbys,"children",t)},expression:"Groupbys.children"}},"draggable",e.dragOptions,!1),[t("transition-group",{attrs:{type:"transition"}},e._l(e.Groupbys.children,(function(i){return t("li",{key:i.id,staticClass:"list-group-item"},[t("div",{staticClass:"matricLabelClass"},[t("b-icon",{staticClass:"dragicon",attrs:{icon:"drag"}}),t("div",{staticClass:"groupyicon"},[t("el-avatar",{staticClass:"elavatarclass",attrs:{size:18,shape:"square"}},[e._v(e._s(i.id))])],1),t("GroupbyCondition",{attrs:{tabGroups:e.tabGroups},model:{value:i.groupbyfield,callback:function(t){e.$set(i,"groupbyfield",t)},expression:"element.groupbyfield"}}),t("span",{on:{click:function(t){return e.deleteGroupby(i.id)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.删除")}},[t("b-icon",{staticClass:"iconClass",attrs:{icon:"close-circle",size:"is-small"}})],1)],1)],1)])})),0)],1)],1)])])]),t("pane",{attrs:{size:100-e.paneSize}},[t("div",{staticClass:"chart_root"},[t("div",{staticClass:"chart_toolbar"},[t("div",{staticClass:"chart_toolbar_left"},[t("b-dropdown",{staticClass:"bdropdownborder",attrs:{"append-to-body":"","trap-focus":"","aria-role":"dialog"},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("span",{staticClass:"navbar-item",attrs:{role:"button"}},[t("span",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.RetentValueText))]),t("b-icon",{attrs:{icon:"menu-down"}})],1)]},proxy:!0}])},[t("b-dropdown-item",{attrs:{focusable:!1,custom:"",paddingless:"","close-on-click":!1,"can-close":"outside"}},[t("div",{staticStyle:{width:"300px"}},[t("section",{staticClass:"modal-card-body"},[t("el-radio-group",{attrs:{size:"small"},on:{input:e.on_change_retentgrain},model:{value:e.RetentSet.radioRetentGrain,callback:function(t){e.$set(e.RetentSet,"radioRetentGrain",t)},expression:"RetentSet.radioRetentGrain"}},[t("el-radio-button",{attrs:{label:"day"}},[e._v(e._s(e.$t("message.按天")))]),t("el-radio-button",{attrs:{label:"week"}},[e._v(e._s(e.$t("message.按周")))]),t("el-radio-button",{attrs:{label:"month"}},[e._v(e._s(e.$t("message.按月")))])],1),t("b-field",{attrs:{label:e.$t("message.查看")}},[t("div",{staticClass:"rowRightCenter"},[t("el-select",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{size:"small",placeholder:e.$t("message.请选择")},model:{value:e.RetentSet.currentRetent,callback:function(t){e.$set(e.RetentSet,"currentRetent",t)},expression:"RetentSet.currentRetent"}},e._l(e.RetentWindowList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),999==e.RetentSet.currentRetent?t("div",{staticClass:"rowRightCenter",on:{click:e.stopPropagation}},[t("el-input-number",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small","controls-position":"right",min:1,max:31},on:{change:e.on_change_customretentnum},model:{value:e.RetentSet.customRetentNum,callback:function(t){e.$set(e.RetentSet,"customRetentNum",t)},expression:"RetentSet.customRetentNum"}}),t("div",[e._v(e._s(e.RetentTimeLabel))])],1):e._e(),9999==e.RetentSet.currentRetent?t("div",[e.RetentSet.keyRetentEdit?t("el-button",{attrs:{size:"small"},on:{click:e.on_click_finish_keyretent_input}},[e._v(e._s(e.$t("message.确定")))]):t("el-button",{attrs:{size:"small",icon:"el-icon-edit"},on:{click:function(t){e.RetentSet.keyRetentEdit=!e.RetentSet.keyRetentEdit}}},[e._v(e._s(e.$t("message.添加")))])],1):e._e()],1)]),9999==e.RetentSet.currentRetent?t("div",[e.RetentSet.keyRetentEdit?t("el-input",{attrs:{type:"textarea",rows:2,placeholder:e.$t("message.请输入内容")},on:{input:e.on_change_RetentTimeString},model:{value:e.RetentSet.keyRetentTimeString,callback:function(t){e.$set(e.RetentSet,"keyRetentTimeString",t)},expression:"RetentSet.keyRetentTimeString"}}):t("div",{staticClass:"keyDayDiv",on:{click:e.stopPropagation}},[t("b-taglist",e._l(e.RetentSet.keyRetentTime,(function(i){return t("b-tag",{key:i,attrs:{closable:""},on:{close:function(t){return e.on_tagclose(i)}}},[e._v(e._s(i)+e._s(e.RetentTimeLabel))])})),1)],1)],1):e._e(),t("el-radio-group",{model:{value:e.RetentSet.retentLost,callback:function(t){e.$set(e.RetentSet,"retentLost",t)},expression:"RetentSet.retentLost"}},[t("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("message.留存")))]),t("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("message.流失")))])],1)],1)])])],1),t("QuickDateTimeRangePicker",{ref:"quicktimepicker1",staticClass:"ml10",attrs:{fontSize:"mini"},on:{change:e.on_timerange_change},model:{value:e.analyzeTimeRange1,callback:function(t){e.analyzeTimeRange1=t},expression:"analyzeTimeRange1"}})],1),t("div",{staticClass:"chart_toolbar_right"},[t("div",{class:{svgicon_button:!0,activeIcon:!e.hideTable},on:{click:function(t){e.hideTable=!e.hideTable}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.$t("message.表格"),placement:"bottom-end"}},[t("div",[t("inline-svg",{attrs:{width:"16",height:"16",src:i(69793)}})],1)])],1),e._l(e.availableChartList,(function(a){return t("div",{key:a.value,class:{svgicon_button:!0,activeIcon:!e.hideChart&&e.currentChart==a.value},on:{click:function(t){return e.switchChartType(a.value)}}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:a.label,placement:"bottom-end"}},[t("div",[t("inline-svg",{attrs:{width:"16",height:"16",src:i(97773)("./"+a.icon+".svg")}})],1)])],1)}))],2)]),e.tableDataLoading?t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableDataLoading,expression:"tableDataLoading"}],staticClass:"mh100"}):[e.hideChart?e._e():t("div",{staticClass:"chartDiv",attrs:{id:"chartViewContainer"}},[e.loadTableDataOnce?t("ChartView",{attrs:{option:e.chartOption,containerId:"chartViewContainer"}}):e._e()],1),e.loadTableDataOnce&&!e.hideTable?t("TablePlusSummaryCellEdit",{attrs:{enableSummary:!0,loading:e.tableDataLoading},model:{value:e.tableData,callback:function(t){e.tableData=t},expression:"tableData"}}):e._e()]],2)])],1)],1)])},s=[],n=(i(57658),i(83581)),r=i(74855),o=i(90309),l=i(43782),c=i(9808),p=i(36144),u=i(97634),d=i(43436),h=i(76983),m=i.n(h),v=i(63822),g=i(47056),b=i(794),f=i(62147),y=i(95705),_=i(19976),T=i(9989),k=i(99877),S={components:{Splitpanes:n.F,Pane:n.X,ChartView:y.Z,SaveAnalysis:_.Z,draggable:m(),EditLabel:r.Z,InlineSvg:k.ZP,SelectPicker:d.Z,EventMetric:u.Z,PropConditionGroup:o.Z,GroupbyCondition:l.Z,QuickDateTimeRangePicker:c.Z,TablePlusSummaryCellEdit:p.Z},created(){},mounted(){this.initializeRetentSet(),this.initialize()},data:()=>({EntityList:[],EventList:[],UserPropList:[],UserGroupList:[],UserTagList:[],ModiferList:[],zones:[],availableChartList:[],report_id:0,id:0,name:"",paneSize:45,zone:b.Z.def.TimeZone.Utcp8,extraMetricCheck:!1,RetentSet:{currentRetent:7,customRetentNum:7,radioRetentGrain:"day",retentWindow:{},retentLost:!0,keyRetentEdit:!1,keyRetentTimeString:"1,4,7,10",keyRetentTime:[1,4,7,10]},EntityId:0,MultiEventPropList:[],tabGroups:[],GlobalFilter:{logicop:b.Z.def.LogicOp.LogicOpAnd,children:[]},Groupbys:{children:[]},StartEvent:{combo:{logicop:b.Z.def.LogicOp.LogicOpAnd,children:[]}},ContinueEvent:{combo:{logicop:b.Z.def.LogicOp.LogicOpAnd,children:[]}},extraMetric:{eventProps:[],combo:{logicop:b.Z.def.LogicOp.LogicOpAnd,children:[]}},switchLinkProp:!1,analyzeTimeRange1:{time_pick:!1,quick_range:"this_7day",start_unit:"day",end_unit:"day",start_offset:1,end_offset:0,start_dynamic:!0,end_dynamic:!0,start_time:"2023-06-28 00:00:00",end_time:"2023-06-29 23:59:59"},tableData:{},tableDataLoading:!1,loadTableDataOnce:!1,hideTable:!1,hideChart:!1,chartOption:{},tempLastPost:"",respData:{},currentChart:b.Z.def.ChartType.Line,chartDataSet:{},chartViewContainer:""}),methods:{initialize(){this.availableChartList=f.Z.analysisRetent.GetChartTypeList(),this.currentChart=b.Z.def.ChartType.Bar,this.loadZones(),this.loadAnalyzeTimeGrain(),this.ModiferList=b.Z.def.ModifierType.getLabelValueList();var e=this.getCurrAppId(),t=f.Z.api.LoadPlainEventList(e,!1),i=f.Z.api.LoadUserProp(e),a=f.Z.api.LoadUserClusterList(e),s=f.Z.api.LoadUserTagList(e,!0),n=f.Z.api.LoadAnalysisEnityList(e),r=Promise.all([i,t,a,s,n]);r.then((e=>{this.UserPropList=e[0],this.EventList=e[1],this.UserGroupList=e[2],this.UserTagList=e[3],this.EntityList=e[4],this.chooseSystemDefaultEntity(),this.UserGroupList.forEach((e=>{e.client_data=null,e.table_type=b.Z.def.TableType.TableTypeEvent})),this.UserTagList.forEach((e=>{e.client_data=null,e.table_type=b.Z.def.TableType.TableTypeEvent})),this.StartEvent=this.chooseDefaultEvent(),this.ContinueEvent=this.chooseDefaultEvent(),this.extraMetric=b.Z.utils.DeepClone(this.StartEvent),this.extraMetric.loadingOk=!0,this.tabGroups=f.Z.filtersub.MakeTabGroup(null,this.UserPropList,this.UserGroupList,this.UserTagList);var t=this.$route.params;t&&(this.report_id=t.report_id),t&&!b.Z.utils.IsEmptyObj(t.client_data)&&this.restoreClientData(t.client_data)})).catch((e=>{b.Z.utils.Err(this,e)}))},initializeRetentSet(){this.RetentSet.retentWindow={day:[{value:1,label:"1 "+this.$t("message.天")},{value:4,label:"4 "+this.$t("message.天")},{value:7,label:"7 "+this.$t("message.天")},{value:14,label:"14 "+this.$t("message.天")},{value:30,label:"30 "+this.$t("message.天")},{value:999,label:this.$t("message.自定义")},{value:9999,label:this.$t("message.关键日期")}],week:[{value:1,label:"1 "+this.$t("message.周")},{value:4,label:"4 "+this.$t("message.周")},{value:7,label:"7 "+this.$t("message.周")},{value:10,label:"10 "+this.$t("message.周")},{value:20,label:"20 "+this.$t("message.周")},{value:999,label:this.$t("message.自定义")},{value:9999,label:this.$t("message.关键日期")}],month:[{value:1,label:"1 "+this.$t("message.月")},{value:4,label:"4 "+this.$t("message.月")},{value:7,label:"7 "+this.$t("message.月")},{value:10,label:"10 "+this.$t("message.月")},{value:12,label:"12 "+this.$t("message.月")},{value:999,label:this.$t("message.自定义")},{value:9999,label:this.$t("message.关键日期")}]}},on_change_retentgrain(){for(var e=0;e<this.RetentWindowList.length;e++)if(this.RetentWindowList[e].value==this.RetentSet.currentRetent)return;this.RetentSet.currentRetent=7},on_tagclose(e){this.RetentSet.keyRetentTime=this.RetentSet.keyRetentTime.filter((t=>t!=Number(e))),0==this.RetentSet.keyRetentTime.length&&(this.RetentSet.keyRetentTime=[1,4,7]),this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTime.join(",")},on_change_RetentTimeString(){this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTimeString.replaceAll(/[^0-9,]/g,"")},on_click_finish_keyretent_input(){this.RetentSet.keyRetentEdit=!1;var e=this.RetentSet.keyRetentTimeString.split(",");this.RetentSet.keyRetentTime=[];for(var t=0;t<e.length;t++)e[t].length>0&&(Number(e[t])>1e3?this.RetentSet.keyRetentTime.push(1e3):this.RetentSet.keyRetentTime.push(Number(e[t])));this.RetentSet.keyRetentTime=b.Z.utils.DeduplicatedList(this.RetentSet.keyRetentTime),this.RetentSet.keyRetentTime.sort((function(e,t){return e-t})),0==this.RetentSet.keyRetentTime.length?this.RetentSet.keyRetentTime=[1,4,7]:this.RetentSet.keyRetentTime.length>=b.Z.def.Limit.MAX_RETENTION_RECORDS&&(this.RetentSet.keyRetentTime=this.RetentSet.keyRetentTime.slice(0,b.Z.def.Limit.MAX_RETENTION_RECORDS)),this.RetentSet.keyRetentTimeString=this.RetentSet.keyRetentTime.join(",")},stopPropagation(e){e.stopPropagation()},on_change_customretentnum(){},chooseDefaultEvent(){var e={label:"",id:"A",event:"",metric:"",modifier:b.Z.def.ModifierType.ModifierTypeNone,loadingOk:!1,eventProps:[],combo:{logicop:b.Z.def.LogicOp.LogicOpAnd,children:[]}};if(this.EventList.length>0){e.event=this.EventList[0].value;var t=this.getCurrAppId();f.Z.api.LoadEventPropParamPromise({app_id:t,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[e.event]}).then((t=>{e.eventProps=t,this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition(),e.loadingOk=!0}))}return e},chooseSystemDefaultEntity(){for(var e=0;e<this.EntityList.length;e++)if(this.EntityList[e].is_system)return this.EntityId=this.EntityList[e].id,void(this.EntityList[e].label=this.EntityList[e].label+this.$t("message.(默认)"))},restoreClientData(e){this.id=e.id,this.name=e.name,this.paneSize=e.paneSize,this.zone=e.zone,this.extraMetricCheck=e.extraMetricCheck,this.RetentSet=e.RetentSet,this.EntityId=e.EntityId,this.MultiEventPropList=e.MultiEventPropList,this.tabGroups=e.tabGroups,this.GlobalFilte=e.GlobalFilte,this.Groupbys=e.Groupbys,this.StartEvent=e.StartEvent,this.ContinueEvent=e.ContinueEvent,this.extraMetric=e.extraMetric,this.switchLinkProp=e.switchLinkProp,this.analyzeTimeRange1=e.analyzeTimeRange1,this.$refs.quicktimepicker1.setValue(e.analyzeTimeRange1),this.on_change_event(this.StartEvent),this.on_change_event(this.ContinueEvent),this.tableDataLoading=!0,this.respData=e.respData,this.hideTable=!1,this.hideChart=!1,setTimeout((()=>{this.switchChartType(this.currentChart,!0)}),100)},getEventLabel(e){for(var t=0;t<this.EventList.length;t++)if(this.EventList[t].value==e)return this.EventList[t].label;return""},loadZones(){this.zones.push({label:b.Z.def.TimeZone.getZhLabel(b.Z.def.TimeZone.Utcp8),value:b.Z.def.TimeZone.Utcp8});var e=-12;while(e<13)8!==e&&this.zones.push({label:b.Z.def.TimeZone.getZhLabel(e),value:e}),e+=1},loadAnalyzeTimeGrain(){this.ananlyzeTimeGrainOp=b.Z.def.TimeGrain.getAnalyzeGrainOpList()},addTopEventPropCondition(e){b.Z.condx.GroupAdd(e,0,1,{selectedOp:"=",record:{}})},on_change_event(e){var t=this.getCurrAppId();f.Z.api.LoadEventPropParamPromise({app_id:t,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[e.event]}).then((t=>{e.eventProps=t,this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition(),e.loadingOk=!0})),e.labelchanged||(e.label=this.getEventLabel(e.event)+"."+e.metricText)},addGlobalFilter(){b.Z.condx.GroupAdd(this.GlobalFilter,0,1,{selectedOp:"=",record:{}})},deleteDangleGlobalFilterCondition(){for(var e=b.Z.condx.Clone2List(this.GlobalFilter),t=0;t<e.length;t++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==b.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==e[t].record.pickersubject.type_prop_name){i=!0;break}i||b.Z.condx.GroupRemove(this.GlobalFilter,e[t].id)}},deleteDangleGroupbyCondition(){for(var e=b.Z.utils.DeepClone(this.Groupbys.children),t=0;t<e.length;t++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==b.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==e[t].groupbyfield.editing_field.type_prop_name){i=!0;break}i||b.Z.condx.GroupRemove(this.Groupbys,e[t].id)}},refreshCommEventProp(){var e=[],t=new Map;return this.StartEvent.eventProps.forEach((i=>{if(!t.has(i.type_prop_name)){t.set(i.type_prop_name);var a=b.Z.utils.DeepClone(i);a.id=e.length,e.push(a)}})),this.ContinueEvent.eventProps.forEach((i=>{if(!t.has(i.type_prop_name)){t.set(i.type_prop_name);var a=b.Z.utils.DeepClone(i);a.id=e.length,e.push(a)}})),this.MultiEventPropList=e,this.tabGroups=[],setTimeout((()=>{var e={group_name:this.$t("message.起始事件属性"),value:this.$t("message.起始事件属性"),type:"list",icon:"",children:this.StartEvent.eventProps};this.tabGroups=f.Z.filtersub.MakeTabGroup(e,this.UserPropList,this.UserGroupList,this.UserTagList)}),10),e},on_input_formular(e){if(e&&e.formular){e.formular=e.formular.toUpperCase();for(var t="",i=0;i<e.formular.length;i++)b.Z.def.MathExpressChars.getList().indexOf(e.formular[i])>=0&&(t+=e.formular[i]);e.formular=t}},addGroupby(){b.Z.condx.GroupAdd(this.Groupbys,0,1,{})},deleteGroupby(e){b.Z.condx.GroupRemove(this.Groupbys,e)},afterGroupbyDrag(){for(var e=b.Z.utils.DeepClone(this.Groupbys),t=0;t<e.children.length;t++)e.children[t].id=t+1;this.Groupbys.children=[],setTimeout((()=>{this.Groupbys=e}),10)},CalcRealKeyTimes(){var e=f.Z.quicktimerange.Duration(this.analyzeTimeRange1,b.Z.def.TimeGrain.getMomentDurationUnit(this.RetentSet.radioRetentGrain));if(e>b.Z.def.Limit.MAX_RETENTION_RECORDS)return this.$t("message.时间范围过大")},on_timerange_change(e){var t=this.CalcRealKeyTimes();t&&b.Z.utils.Err(this,t),b.Z.utils.Ignore(e)},on_click_save(e){var t={},i=this.prepare_postdata(t);if(i)b.Z.utils.Err(this,i);else{var a={paneSize:this.paneSize,zone:this.zone,extraMetricCheck:this.extraMetricCheck,RetentSet:this.RetentSet,EntityId:this.EntityId,MultiEventPropList:this.MultiEventPropList,tabGroups:this.tabGroups,GlobalFilte:this.GlobalFilte,Groupbys:this.Groupbys,StartEvent:this.StartEvent,ContinueEvent:this.ContinueEvent,extraMetric:this.extraMetric,switchLinkProp:this.switchLinkProp,analyzeTimeRange1:this.analyzeTimeRange1,currentChart:this.currentChart};this.tempLastPost!=JSON.stringify(t)?this.QueryApi().then((()=>{this.$refs.saveAnalysis.showDialog(e,this.name,a,t,this.respData,b.Z.def.AnalysisType.AnalysisTypeRetention,0,this.report_id),this.tableDataLoading=!1})).catch(function(e){b.Z.utils.Err(this,e),this.tableDataLoading=!1}.bind(this)):(this.$refs.saveAnalysis.showDialog(e,this.name,a,t,this.respData,b.Z.def.AnalysisType.AnalysisTypeRetention,0,this.report_id),this.tableDataLoading=!1)}},on_save_success(e){this.name=e.name,this.id=e.id},prepare_postdata(e){var t=this.CalcRealKeyTimes();return t||(e.app=this.getCurrAppId(),e.enity_id=this.EntityId,e.time_zone=this.zone,e.retents=[{id:"A",filter:f.Z.metric.VueEventFilterGroup2ApiEventFilter(this.StartEvent.event,this.StartEvent.combo),link_type_prop_name:this.switchLinkProp?this.StartEvent.link_prop_obj.type_prop_name:""},{id:"B",filter:f.Z.metric.VueEventFilterGroup2ApiEventFilter(this.ContinueEvent.event,this.ContinueEvent.combo),link_type_prop_name:this.switchLinkProp?this.ContinueEvent.link_prop_obj.type_prop_name:""}],e.comm_filter=f.Z.metric.VuePropFilterGroup2ApiGlobalFilter(this.GlobalFilter),e.breaks=f.Z.breaks.VueGroupbys2ApiBreakList(this.StartEvent.event,this.Groupbys),e.analysis_time_range={time_zone:this.zone,range1:this.analyzeTimeRange1},e.retent_times={grain:this.RetentSet.radioRetentGrain,window:999===this.RetentSet.currentRetent?this.RetentSet.customRetentNum:this.RetentSet.currentRetent,key_enable:9999===this.RetentSet.currentRetent,key_times:this.RetentSet.keyRetentTime,retent_lost:this.RetentSet.retentLost},this.switchLinkProp&&this.StartEvent.link_prop_obj.type!=this.ContinueEvent.link_prop_obj.type?this.$t("message.错误：关联属性类型不一致错误，要求所有关联属性数据类型一致"):void 0)},QueryApi(){var e={};console.log("---------------3");var t=this.prepare_postdata(e);return t?(console.log("---------------4"),Promise.reject(t)):(console.log("---------------4"),this.tableDataLoading=!0,this.tableData={},this.tempLastPost=JSON.stringify(e),g.Z["new"]().analyzeRetention(e).then(function(e){b.Z.utils.Ignore(e),this.respData=e.data,this.tableData=f.Z.analysisRetent.ToTabledata(this.respData);var t=f.Z.analysisRetent.datasetToChartDataset(this.respData);return this.chartDataSet=T.Z.TableDataToChartSetList(t),this.chartOption=f.Z.BuidChart(this.currentChart,b.Z.utils.DeepClone(this.chartDataSet)),this.tableDataLoading=!1,this.loadTableDataOnce=!0,console.log("---------------6"),!0}.bind(this)))},on_click_analyze(){console.log("---------------1"),this.QueryApi().catch(function(e){b.Z.utils.Err(this,e),console.log("---------------2",e),this.tableDataLoading=!1}.bind(this))},switchChartType(e,t){e==this.currentChart&&(this.hideChart=!this.hideChart),this.currentChart=e,t&&(this.hideChart=!1),this.hideChart||(this.tableDataLoading=!0,this.$nextTick((()=>{this.tableData=f.Z.analysisRetent.ToTabledata(this.respData);var e=f.Z.analysisRetent.datasetToChartDataset(this.respData);this.chartDataSet=T.Z.TableDataToChartSetList(e),this.chartOption=f.Z.BuidChart(this.currentChart,b.Z.utils.DeepClone(this.chartDataSet)),this.tableDataLoading=!1,this.loadTableDataOnce=!0})))}},computed:{...(0,v.Se)({getCurrAppId:"system/getCurrAppId"}),dragOptions(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}},RetentValueText:function(){var e="";return 9999==this.RetentSet.currentRetent?e+=this.$t("message.关键日期"):e=999==this.RetentSet.currentRetent?e+this.RetentSet.customRetentNum+b.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain):e+this.RetentSet.currentRetent+b.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain),this.RetentSet.retentLost?e+" "+this.$t("message.留存"):e+" "+this.$t("message.流失")},RetentWindowList:function(){return this.RetentSet.retentWindow[this.RetentSet.radioRetentGrain]},RetentTimeLabel:function(){return b.Z.def.TimeGrain.getZhLabel(this.RetentSet.radioRetentGrain)},pickableStartEventProps(){var e=[],t={group_name:this.$t("message.事件属性"),value:this.$t("message.事件属性"),type:"list",icon:"",children:this.StartEvent.eventProps};t.children=this.StartEvent.eventProps.filter((e=>!b.Z.def.PropDelimiter.isRelateObjectField(e.type_prop_name)&&b.Z.def.DataType.isPrimaryType(e.type)));for(var i=0;i<t.children.length;i++)t.children[i].label2=b.Z.def.PropertyType.getZhLabel(t.children[i].label2),t.children[i].label3=b.Z.def.DataType.getZhLabel(t.children[i].type);return t.children&&t.children.length>0&&e.push(t),e},pickableContinueEventProps(){var e=[],t={group_name:this.$t("message.事件属性"),value:this.$t("message.事件属性"),type:"list",icon:"",children:[]};t.children=this.ContinueEvent.eventProps.filter((e=>!b.Z.def.PropDelimiter.isRelateObjectField(e.type_prop_name)&&b.Z.def.DataType.isPrimaryType(e.type)));for(var i=0;i<t.children.length;i++)t.children[i].label2=b.Z.def.PropertyType.getZhLabel(t.children[i].label2),t.children[i].label3=b.Z.def.DataType.getZhLabel(t.children[i].type);return t.children&&t.children.length>0&&e.push(t),e}}},C=S,L=i(1001),Z=(0,L.Z)(C,a,s,!1,null,"83e2893e",null),R=Z.exports},17818:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meClass"},[e.topgroup.children&&e.topgroup.children.length>0?t("div",{staticClass:"grouproot"},[t("div",{staticClass:"group-header"},[e.topgroup.children.length>1?t("div",{staticClass:"logic-buttons"},[t("div",{class:{spanAnd:!0,logicOn:e.topgroup.logicop===e.pub.def.LogicOp.LogicOpAnd},on:{click:function(t){e.topgroup.logicop=e.pub.def.LogicOp.LogicOpAnd}}},[e._v(e._s(e.$t("message.且"))),t("span")]),t("div",{class:{spanOr:!0,logicOn:e.topgroup.logicop===e.pub.def.LogicOp.LogicOpOr},on:{click:function(t){e.topgroup.logicop=e.pub.def.LogicOp.LogicOpOr}}},[e._v(e._s(e.$t("message.或"))),t("span")])]):e._e()]),t("div",{staticClass:"condContainer"},e._l(e.topgroup.children,(function(i,a){return t("div",{key:i.id},[i.children&&i.children.length>0?t("div",{staticClass:"grouproot"},[t("div",{staticClass:"group-header"},[i.children.length>1?t("div",{staticClass:"logic-buttons"},[t("div",{class:{spanAnd:!0,logicOn:i.logicop===e.pub.def.LogicOp.LogicOpAnd},on:{click:function(t){i.logicop=e.pub.def.LogicOp.LogicOpAnd}}},[e._v(e._s(e.$t("message.且"))),t("span")]),t("div",{class:{spanOr:!0,logicOn:i.logicop===e.pub.def.LogicOp.LogicOpOr},on:{click:function(t){i.logicop=e.pub.def.LogicOp.LogicOpOr}}},[e._v(e._s(e.$t("message.或"))),t("span")])]):e._e()]),t("div",{staticClass:"condContainer"},e._l(e.topgroup.children[a].children,(function(s,n){return t("div",{key:s.id},[e._t("default",(function(){return[e._v(e._s(i)+" "+e._s(n))]}),{item:s,parent:e.topgroup.children[a]})],2)})),0)]):t("div",[e._t("default",(function(){return[e._v(e._s(i))]}),{item:i,parent:e.topgroup})],2)])})),0)]):e._e()])},s=[],n=i(794),r={components:{},props:{keepLast:{type:Boolean,default:!0},group:{type:Object,default:function(){return{logicop:n.Z.def.LogicOp.LogicOpAnd,children:[{id:1,label:"label1",name:"namelabel1"},{id:2,label:"label2",name:"namelabel2"},{id:3,label:"label3",name:"namelabel3",logicop:n.Z.def.LogicOp.LogicOpAnd,children:[{id:3,label:"label1",name:"namelabel1"},{id:2,label:"label2",name:"namelabel2"}]}]}}},subjects:{type:Array,default:()=>[]}},data(){return{topgroup:{}}},created(){this.topgroup=this.group},mounted(){},methods:{},computed:{}},o=r,l=i(1001),c=(0,l.Z)(o,a,s,!1,null,"c6cbd6c8",null),p=c.exports},43782:function(e,t,i){"use strict";i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_groupbycondition"}},[t("div",{staticClass:"flexrowAcenter"},[t("SelectPicker",{attrs:{defaulted:e.defaulted,tabGroups:e.tabGroups},on:{pickviewshow:e.on_picker_show,change:e.on_select_change},model:{value:e.editing_field,callback:function(t){e.editing_field=t},expression:"editing_field"}}),e.showSettingIcon(e.editing_field)?t("div",{on:{click:function(t){e.viewshow=!0}}},[t("b-icon",{staticClass:"setIcon ml5",attrs:{icon:"cog-outline",size:"is-small"}})],1):e._e()],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.viewshow,expression:"viewshow"}],staticClass:"groupbypickview"},[t("div",{staticClass:"groupbypicktitle"},[e._v(e._s(e.$t("message.分组方式-列表")))]),e.isBasicListType(e.editing_field)?t("div",[t("el-radio-group",{on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListWhole}},[e._v(e._s(e.$t("message.按值")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListElement}},[e._v(e._s(e.$t("message.按元素")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionListSet}},[e._v(e._s(e.$t("message.按元素集合")))])],1)],1):e._e(),e.isDateTimeType(e.editing_field)?t("div",{staticClass:"h40 flexrowAcenter"},[t("el-radio-group",{on:{input:e.on_radio_change_time},model:{value:e.timeSummary,callback:function(t){e.timeSummary=t},expression:"timeSummary"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.PERIOD_SUMMARY_NO}},[e._v(e._s(e.$t("message.不汇总")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.PERIOD_SUMMARY_YES}},[e._v(e._s(e.$t("message.按时段汇总")))])],1),e.timeSummary==e.PERIOD_SUMMARY_YES?t("div",{staticClass:"flexrowAcenter ml5"},[t("b-select",{staticClass:"w100",attrs:{size:"is-small"},on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},e._l(e.timePeriodOp,(function(i){return t("option",{key:i.value,domProps:{value:i.value}},[e._v(" "+e._s(i.label)+" ")])})),0)],1):e._e()],1):e._e(),e.isNumberType(e.editing_field)?t("div",[t("el-radio-group",{on:{input:e.on_breakOption_change},model:{value:e.breakOption,callback:function(t){e.breakOption=t},expression:"breakOption"}},[t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberDefault}},[e._v(e._s(e.$t("message.默认区间")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberValue}},[e._v(e._s(e.$t("message.离散值(无区间)")))]),t("el-radio",{attrs:{size:e.fontSize,label:e.pub.def.BreakOption.BreakOptionNumberCustom}},[e._v(e._s(e.$t("message.自定义区间")))])],1),e.breakOption==e.pub.def.BreakOption.BreakOptionNumberCustom?t("div",{staticClass:"pickViewContent onSliderScroll"},e._l(e.numberList,(function(i,a){return t("div",{key:i.id,staticClass:"flexcolumnAleft"},[1===i.id?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+1))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("span",{staticClass:"w100"},[e._v(e._s(e.pub.def.Infinite.InfiniteMin))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:function(t){return e.on_change_num(i)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e(),1!=i.id?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+1))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("el-input",{staticClass:"w100",attrs:{value:e.get_previous_max(i),size:"mini",disabled:!0}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),t("el-input-number",{attrs:{size:"mini","controls-position":"right"},on:{change:function(t){return e.on_change_num(i)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e(),i.id===e.numberList.length?t("div",{staticClass:"flexrowJleftAcenter"},[t("div",{staticClass:"w50"},[e._v(e._s(e.$t("message.区间"))+e._s(a+2))]),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("(")]),t("el-input",{staticClass:"w100",attrs:{value:i.value,size:"mini",disabled:!0}}),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v("-")]),e._v(" "+e._s(e.pub.def.Infinite.InfiniteMax)+" "),t("div",{staticClass:"w15 flexcolumnAcenter"},[e._v(")")])],1):e._e()])})),0):e._e(),e.breakOption==e.pub.def.BreakOption.BreakOptionNumberCustom?t("div",{staticClass:"span_button",on:{click:e.addToList}},[t("b-icon",{attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}}),e._v(e._s(e.$t("message.添加区间")))],1):e._e()],1):e._e()])])},s=[],n=(i(57658),i(794)),r=i(43436);const o="no",l="yes";var c={name:"DateTimePicker",components:{SelectPicker:r.Z},model:{prop:"modelvalue",event:"modelvaluechange"},props:{inputPlaceHolder:{type:String,default:"请选择日期"},modelvalue:{type:Object,default:function(){return{editing_field:{},breakOption:n.Z.def.BreakOption.BreakOptionListWhole,numberList:[{id:1,value:1}]}}},defaulted:{type:Boolean,default:!0},fontSize:{type:String,default:"mini"},setting:{type:Boolean,default:!0},tabGroups:{type:Array,default:()=>[]}},data(){return{PERIOD_SUMMARY_NO:"no",PERIOD_SUMMARY_YES:"yes",timeSummary:"no",eventListLoadOk:!1,timePeriodOp:[],editing_field:{},viewshow:!1,breakOption:n.Z.def.BreakOption.BreakOptionListWhole,numberList:[{id:1,value:1}]}},created(){this.initialize()},mounted(){(this.modelvalue&&this.modelvalue.length>12||this.modelvalue&&10===this.modelvalue.length)&&this.confirm(),document.addEventListener("click",this.dc,!0)},beforeDestroy(){document.removeEventListener("click",this.dc,!0)},methods:{initialize(){this.timePeriodOp=this.getTimePeriodList(),this.modelvalue&&(this.breakOption=this.modelvalue.breakOption,this.numberList=this.modelvalue.numberList,this.editing_field=this.modelvalue.editing_field)},confirm(){var e={};e.breakOption=this.breakOption,e.numberList=this.numberList,e.editing_field=this.editing_field,this.$emit("modelvaluechange",e)},dc(e){var t=this.$el.contains(e.target);t||(this.viewshow=!1)},on_breakOption_change(){console.log("====on_breakOption_change=========",this.breakOption),this.confirm()},getTimePeriodList(){var e=[];return e.push({value:n.Z.def.BreakOption.BreakOptionTimeMinute,label:this.$t("message.分钟")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeHour,label:this.$t("message.小时")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeDay,label:this.$t("message.天")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeWeek,label:this.$t("message.周")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeMonth,label:this.$t("message.月")}),e.push({value:n.Z.def.BreakOption.BreakOptionTimeYear,label:this.$t("message.年")}),e},addToList(){var e=this.numberList[this.numberList.length-1].value+1;this.numberList[this.numberList.length-1].max=e,this.numberList.push({id:this.numberList.length+1,value:e,min:e-1})},on_picker_show(e){e&&(this.viewshow=!1)},get_previous_max(e){if(e.id>1)return this.numberList[e.id-2].value},on_radio_change_time(e){console.log("====on_radio_change_time 1==========",e,this.breakOption),e==o?this.breakOption=n.Z.def.BreakOption.BreakOptionTimeSecond:e==l&&(this.breakOption=n.Z.def.BreakOption.BreakOptionTimeMinute),console.log("====on_radio_change_time 2==========",e,this.breakOption),this.confirm()},on_change_num(e){1==this.numberList.length||(e.id==this.numberList.length?e.value<=this.numberList[e.id-2].value&&setTimeout((()=>{e.value=this.numberList[e.id-2].value+1}),10):1==e.id?e.value>=this.numberList[e.id].value&&setTimeout((()=>{e.value=this.numberList[e.id].value-1}),10):(e.value>=this.numberList[e.id].value&&setTimeout((()=>{e.value=this.numberList[e.id].value-1}),10),e.value<=this.numberList[e.id-2].value&&setTimeout((()=>{e.value=this.numberList[e.id-2].value+1}),10))),this.confirm()},isDateTimeType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||e.type!=n.Z.def.DataType.DataTypeDatetime)},isNumberType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||e.type!=n.Z.def.DataType.DataTypeNumber)},isBasicListType(e){return!(!e||e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeEventProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserProp&&e.data_source_type!=n.Z.def.DataSourceType.DataSourceTypeUserTag||!n.Z.def.DataType.isBasicListType(e.type))},showSettingIcon(e){if(e)if(e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeEventProp||e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeUserProp||e.data_source_type==n.Z.def.DataSourceType.DataSourceTypeUserTag){if(e.type==n.Z.def.DataType.DataTypeNumber||e.type==n.Z.def.DataType.DataTypeDatetime)return!0;if(n.Z.def.DataType.isBasicListType(e.type))return!0}else e.data_source_type,n.Z.def.DataSourceType.DataSourceTypeUserCluster},on_select_change(e){this.breakOption=n.Z.def.BreakOption.BreakOptionNormal,this.isNumberType(e)?this.breakOption=n.Z.def.BreakOption.BreakOptionNumberDefault:this.isDateTimeType(e)?(this.timeSummary=this.PERIOD_SUMMARY_NO,this.breakOption=n.Z.def.BreakOption.BreakOptionTimeSecond):this.isBasicListType(e)&&(this.breakOption=n.Z.def.BreakOption.BreakOptionListWhole),this.editing_field=e,this.confirm()}},watch:{},computed:{}},p=c,u=i(1001),d=(0,u.Z)(p,a,s,!1,null,"202cb59e",null),h=d.exports},90309:function(e,t,i){"use strict";i.d(t,{Z:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"meClass"},[t("div",[t("ConditionGroup",{attrs:{group:e.filterable},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"condItem"},[t("PropCondition",{staticClass:"pading2",attrs:{favorites:e.favorites,eventProps:e.eventProps,userProps:e.userProps,userGroups:e.userGroups,userTags:e.userTags},on:{change:e.on_change_condition},model:{value:i.item.record,callback:function(t){e.$set(i.item,"record",t)},expression:"slotProps.item.record"}}),t("span",{on:{click:function(t){return e.on_click_add(e.filterable,i.item.id,i.item.level)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.添加条件")}},[t("b-icon",{staticClass:"condIcon",attrs:{icon:"filter-variant-plus",size:"is-small"}})],1)],1),!e.keepLast||e.groupItemCount(e.filterable)>1?t("span",{on:{click:function(t){return e.on_click_trash(e.filterable,i.item.id)}}},[t("el-tooltip",{attrs:{effect:"light",placement:"top",content:e.$t("message.删除条件")}},[t("b-icon",{staticClass:"condIcon",attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1):e._e()],1)]}}])})],1)])},s=[],n=i(97461),r=i(17818),o=i(794),l={components:{PropCondition:n.Z,ConditionGroup:r.Z},model:{prop:"filters",event:"filterschange"},props:{keepLast:{type:Boolean,default:!0},favorites:{type:String,default:"aa"},filters:{type:Object,default:function(){return{logicop:o.Z.def.LogicOp.LogicOpAnd,children:[{id:1,label:"label1",record:{pickersubject:{}}}]}}},eventProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber}]},userProps:{type:Array,default:()=>[{value:"FAIL",label:"累计购买次数",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"rank",label:"排名",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"guild_name",label:"用户名字",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeString},{value:"guild_member",label:"年龄",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber},{value:"guild_leader",label:"性别",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeString},{value:"win",label:"胜利次数",label2:o.Z.def.PropertyType.getZhLabel(o.Z.def.PropertyType.PropertyTypeCustom),type:o.Z.def.DataType.DataTypeNumber}]},userGroups:{type:Array,default:()=>[]},userTags:{type:Array,default:()=>[]}},data(){return{selectedEvent:"",filterable:{}}},created(){this.filterable=this.filters},mounted(){},watch:{filters(e,t){o.Z.utils.Ignore(t),this.filterable.children=e.children,this.filterable.logicop=e.logicop},eventProps(e,t){o.Z.utils.Ignore(e,t)}},methods:{on_click_add(e,t,i){o.Z.condx.GroupAdd(e,t,i,{record:{pickersubject:{}}})},on_click_trash(e,t){o.Z.condx.GroupRemove(e,t)},onMetricChange(e,t,i,a){o.Z.utils.Ignore(e,t,i,a)},on_event_change(e){this.selectedEvent=e},on_change_condition(e){o.Z.utils.Ignore(e)},groupItemCount(e){return o.Z.condx.GroupItemCount(e)}}},c=l,p=i(1001),u=(0,p.Z)(c,a,s,!1,null,"b60fea14",null),d=u.exports},97773:function(e,t,i){var a={"./boxplot.svg":78676,"./boxplot2.svg":39006,"./chart-bar.svg":46980,"./chart-cumulative.svg":45413,"./chart-donut-variant.svg":64822,"./chart-line.svg":53481,"./chart-pie.svg":66097,"./chart-sankey.svg":7085,"./chart-scatter-plot.svg":46090,"./distribute-horizontal-center.svg":3543,"./flask-empty-outline.svg":34426,"./hexagon-slice-4.svg":19742,"./map.svg":76038,"./speedometer.svg":37751,"./table-large.svg":69793,"./vs.svg":21068,"./waves.svg":84530};function s(e){var t=n(e);return i(t)}function n(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}s.keys=function(){return Object.keys(a)},s.resolve=n,e.exports=s,s.id=97773},78676:function(e,t,i){"use strict";e.exports=i.p+"img/boxplot.830d642c.svg"},39006:function(e,t,i){"use strict";e.exports=i.p+"img/boxplot2.d70af34e.svg"},46980:function(e,t,i){"use strict";e.exports=i.p+"img/chart-bar.a27b4433.svg"},45413:function(e,t,i){"use strict";e.exports=i.p+"img/chart-cumulative.73aa0874.svg"},64822:function(e,t,i){"use strict";e.exports=i.p+"img/chart-donut-variant.7fc12b7c.svg"},53481:function(e,t,i){"use strict";e.exports=i.p+"img/chart-line.c84b9ae5.svg"},66097:function(e,t,i){"use strict";e.exports=i.p+"img/chart-pie.20b9dd18.svg"},7085:function(e,t,i){"use strict";e.exports=i.p+"img/chart-sankey.6afe618b.svg"},46090:function(e,t,i){"use strict";e.exports=i.p+"img/chart-scatter-plot.92c693bc.svg"},3543:function(e,t,i){"use strict";e.exports=i.p+"img/distribute-horizontal-center.f7df265f.svg"},34426:function(e,t,i){"use strict";e.exports=i.p+"img/flask-empty-outline.77e3be99.svg"},19742:function(e,t,i){"use strict";e.exports=i.p+"img/hexagon-slice-4.eec52121.svg"},76038:function(e,t,i){"use strict";e.exports=i.p+"img/map.07088126.svg"},37751:function(e,t,i){"use strict";e.exports=i.p+"img/speedometer.9e43f341.svg"},69793:function(e,t,i){"use strict";e.exports=i.p+"img/table-large.07f1ecc3.svg"},21068:function(e,t,i){"use strict";e.exports=i.p+"img/vs.cae95fd8.svg"},84530:function(e,t,i){"use strict";e.exports=i.p+"img/waves.25ac4130.svg"},99877:function(e,t,i){"use strict";i.d(t,{ZP:function(){return n}});const a={};function s(e){return Object.keys(e).reduce(((t,i)=>(!1!==e[i]&&null!==e[i]&&void 0!==e[i]&&(t[i]=e[i]),t)),{})}const n={name:"InlineSvg",inheritAttrs:!1,render(e){return this.svgElSource?e("svg",{on:this.$listeners,attrs:Object.assign(this.getSvgAttrs(this.svgElSource),s(this.$attrs)),domProps:{innerHTML:this.getSvgContent(this.svgElSource)}}):null},props:{src:{type:String,required:!0},title:{type:String},transformSource:{type:Function,default:e=>e},keepDuringLoading:{type:Boolean,default:!0}},data(){return{svgElSource:null}},watch:{src(e){this.getSource(e)}},mounted(){this.getSource(this.src)},methods:{getSvgAttrs(e){let t={};const i=e.attributes;if(!i)return t;for(let a=i.length-1;a>=0;a--)t[i[a].name]=i[a].value;return t},getSvgContent(e){return e=e.cloneNode(!0),e=this.transformSource(e),this.title&&r(e,this.title),e.innerHTML},getSource(e){a[e]||(a[e]=this.download(e)),this.svgElSource&&a[e].getIsPending()&&!this.keepDuringLoading&&(this.svgElSource=null,this.$emit("unloaded")),a[e].then((e=>{this.svgElSource=e,this.$nextTick((()=>{this.$emit("loaded",this.$el)}))})).catch((t=>{this.svgElSource&&(this.svgElSource=null,this.$emit("unloaded")),delete a[e],this.$emit("error",t)}))},download(e){return o(new Promise(((t,i)=>{const a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=()=>{if(a.status>=200&&a.status<400)try{const e=new DOMParser,s=e.parseFromString(a.responseText,"text/xml");let n=s.getElementsByTagName("svg")[0];n?t(n):i(new Error('Loaded file is not valid SVG"'))}catch(e){i(e)}else i(new Error("Error loading SVG"))},a.onerror=i,a.send()})))}}};function r(e,t){const i=e.getElementsByTagName("title");if(i.length)i[0].textContent=t;else{const i=document.createElementNS("http://www.w3.org/2000/svg","title");i.textContent=t,e.insertBefore(i,e.firstChild)}}function o(e){if(e.getIsPending)return e;let t=!0,i=e.then((e=>(t=!1,e)),(e=>{throw t=!1,e}));return i.getIsPending=function(){return t},i}}}]);