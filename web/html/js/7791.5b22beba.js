"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[7791],{85102:function(t,e,i){i.r(e),i.d(e,{default:function(){return b}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"root"},[e("div",{staticClass:"title"},[t._v(t._s(t.$t("message.分析主体列表")))]),e("div",{staticClass:"toolbar"},[e("el-button",{staticClass:"toolbaritem",attrs:{size:"small"},on:{click:t.addNewEntity}},[t._v(t._s(t.$t("message.添加分析主体")))])],1),e("b-table",{ref:"table",attrs:{data:t.tableData,hoverable:""}},[e("b-table-column",{attrs:{field:"name",label:t.$t("message.分析主体名字"),width:"300",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[[i.row.id==t.editingRow?e("el-input",{attrs:{size:t.cellFontSize,placeholder:t.$t("message.请输入内容")},model:{value:t.editingName,callback:function(e){t.editingName=e},expression:"editingName"}}):e("span",{attrs:{size:t.cellFontSize}},[t._v(t._s(i.row.name))])]]}}])}),e("b-table-column",{attrs:{field:"original_label",label:t.$t("message.来源属性"),width:"300",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[[i.row.id==t.editingRow?e("div",[e("SelectPicker",{attrs:{tabGroups:t.tabGroups},model:{value:t.editing_field,callback:function(e){t.editing_field=e},expression:"editing_field"}})],1):e("div",{staticClass:"flexrowcenter"},[e("div",{staticClass:"ht25",attrs:{size:t.cellFontSize}},[e("b-icon",{attrs:{icon:t.getPropTypeIcon(i.row.table_type)}})],1),e("div",{staticClass:"ht25",attrs:{size:t.cellFontSize}},[t._v(t._s(t.getFieldLabel(i.row)))])])]]}}])}),e("b-table-column",{attrs:{field:"is_system",label:t.$t("message.系统保留主体"),width:"300",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[[i.row.is_system?e("span",{attrs:{size:t.cellFontSize,type:"text"}},[t._v(t._s(t.$t("message.是")))]):e("span",{attrs:{size:t.cellFontSize,type:"text"}},[t._v(t._s(t.$t("message.否")))])]]}}])}),e("b-table-column",{attrs:{field:"update_time",label:t.$t("message.更新日期"),width:"300",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[[e("span",{attrs:{size:t.cellFontSize,type:"text"}},[t._v(t._s(t.unixToYYYYMMDD(1e3*i.row.update_time)))])]]}}])}),e("b-table-column",{attrs:{label:t.$t("message.操作"),width:"300"},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.is_system?t._e():[i.row.id==t.editingRow?e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.saveRecord(i.row)}}},[t._v(t._s(t.$t("message.保存")))]):t._e(),i.row.id==t.editingRow?e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.cancelRecord(i.row)}}},[t._v(t._s(t.$t("message.取消")))]):t._e(),e("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(e){return e.preventDefault(),t.deleteRecord(i.row)}}},[t._v(t._s(t.$t("message.删除")))])]]}}])})],1)],1)},a=[],l=(i(57658),i(794)),n=i(6309),r=i(43436),o=i(62147),p=i(63822);const d=i(36797);var u={components:{SelectPicker:r.Z},data(){return{editingName:{},editing_field:{},tableData:[],zones:[],eventPropList:[],userPropList:[],tabGroups:[],editingRow:-1,cellFontSize:"mini"}},mounted(){this.initialize()},methods:{initialize(){this.tableData=[];var t=this.getCurrAppId(),e=o.Z.api.LoadAnalysisEnityList(t),i=o.Z.api.LoadAnalysisEntityPropList(t),s=Promise.all([e,i]);s.then((t=>{if(this.tableData=t[0],t[1]){for(var e=0;e<t[1].length;e++)t[1][e].table_type==l.Z.def.TableType.TableTypeEvent?this.eventPropList.push(t[1][e]):this.userPropList.push(t[1][e]);this.tabGroups.push({group_name:this.$t("message.事件属性"),value:this.$t("message.事件属性"),type:"list",icon:"chart-timeline",children:this.eventPropList}),this.tabGroups.push({group_name:this.$t("message.用户属性"),value:this.$t("message.用户属性"),type:"list",icon:"chart-timeline",children:this.userPropList})}})).catch((t=>{l.Z.utils.Err(this,t)}))},unixToYYYYMMDD(t){return d(t).format("YYYY-MM-DD")},getPropTypeIcon(t){return l.Z.def.TableType.getIcon(t)},deleteRecord(t){this.$confirm(this.$t("message.此操作将永久删除该项目x是否继续?",{name:t.name}),this.$t("message.信息"),{confirmButtonText:this.$t("message.确定"),cancelButtonText:this.$t("message.取消"),type:"warning"}).then((()=>{n.Z["new"]().delete({id:t.id}).then(function(t){l.Z.utils.Ignore(t),l.Z.utils.Success(this,this.$t("message.删除成功")),this.refreshEnity()}.bind(this)).catch((function(t){l.Z.utils.Err(this,t)}))})).catch((()=>{}))},handleClose(){this.dialogVisible=!1},refreshEnity(){var t=o.Z.api.LoadAnalysisEnityList(this.getCurrAppId());t.then((t=>{this.tableData=t})).catch((t=>{l.Z.utils.Err(this,t)}))},getMaxEntityId(){for(var t=0,e=0;e<this.tableData.length;e++)this.tableData[e].id>t&&(t=this.tableData[e].id);return t},addNewEntity(){var t=this.userPropList[0],e={data_type:t.data_type,id:this.getMaxEntityId()+1,is_system:!1,name:t.label,table_type:t.table_type,type_prop_name:t.type_prop_name,update_time:d().unix()};this.tableData.push(e),this.editRecord(e)},getFieldLabel(t){if(t.table_type==l.Z.def.TableType.TableTypeEvent){for(var e=0;e<this.eventPropList.length;e++)if(this.eventPropList[e].type_prop_name==t.type_prop_name)return t.original_label=l.Z.def.TableType.TableTypeEvent+this.eventPropList[e].label,this.eventPropList[e].label}else for(var i=0;i<this.userPropList.length;i++)if(this.userPropList[i].type_prop_name==t.type_prop_name)return t.original_label=l.Z.def.TableType.TableTypeUser+this.userPropList[i].label,this.userPropList[i].label;return t.type_prop_name},saveRecord(t){l.Z.utils.Ignore(t),n.Z["new"]().add({app_id:this.getCurrAppId(),type_prop_name:this.editing_field.value,table_type:this.editing_field.table_type,name:this.editingName}).then((e=>{l.Z.utils.Ignore(e),t.name=this.editingName,t.type_prop_name=this.editing_field.value,t.table_type=this.editing_field.table_type,t.data_type=this.editing_field.data_type,this.editingRow=-1,this.refreshEnity()})).catch((t=>{l.Z.utils.Err(this,t)}))},cancelRecord(t){for(var e=0;e<this.tableData.length;e++)this.tableData[e].id==t.id&&this.tableData.splice(e,1)},editRecord(t){this.editingRow=t.id,this.editingName=t.name,this.editing_field={value:t.type_prop_name}}},computed:{...(0,p.Se)({getCurrAppId:"system/getCurrAppId"})}},c=u,h=i(1001),_=(0,h.Z)(c,s,a,!1,null,"67c2b8b5",null),b=_.exports}}]);