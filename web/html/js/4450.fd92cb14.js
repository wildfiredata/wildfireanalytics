"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[4450],{61597:function(t,e,i){i.r(e),i.d(e,{default:function(){return E}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"root"},[e("div",{staticClass:"containerClass"},[e("div",{staticClass:"top_toolbar h40"},[e("div",[t.name?e("div",[e("EditLabel",{staticClass:"h40 ml10",attrs:{fontSize:"title"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),e("i",{staticClass:"el-icon-edit"})],1):e("span",{staticClass:"title h40 ml10 nonuserselect"},[t._v(t._s(t.$t("message.事件分析")))])]),e("div",{staticClass:"top_toolbar_erea"},[e("el-select",{staticClass:"mr10 w100",attrs:{size:"mini",placeholder:t.$t("message.请选择默认分析时区")},model:{value:t.zone,callback:function(e){t.zone=e},expression:"zone"}},t._l(t.zones,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("div",{staticClass:"ml10 w100 h30"},[e("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(e){return t.on_click_save(t.id)}}},[t._v(t._s(t.$t("message.保存")))]),e("SaveAnalysis",{ref:"saveAnalysis",on:{sucess:t.on_save_success}})],1),t.id>0?e("div",{staticClass:"ml10 w100 h30"},[e("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:function(e){return t.on_click_save(0)}}},[t._v(t._s(t.$t("message.另存为")))])],1):t._e(),e("div",{staticClass:"ml10 w100 h30"},[e("b-button",{attrs:{type:"is-primary",size:"is-small",expanded:""},on:{click:t.on_click_analyze}},[t._v(t._s(t.$t("message.计算")))])],1)],1)]),e("splitpanes",{staticClass:"default-theme"},[e("pane",{attrs:{size:t.paneSize,"max-size":"60"}},[e("div",{staticClass:"left-root"},[e("div",{staticClass:"left-work-area onSliderScroll"},[e("div",{staticClass:"title_area nonuserselect"},[t._v(t._s(t.$t("message.指标"))),e("div",{staticClass:"title_area_button"},[e("div",{on:{click:t.reset}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.重置")}},[e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"refresh"}})],1)],1),e("div",{on:{click:function(e){return t.addNewMetric(!1)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.添加指标")}},[e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),e("div",{on:{click:function(e){return t.addNewMetric(!0)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.添加指标公式")}},[e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"calculator-variant-outline"}})],1)],1)])]),e("div",[e("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul"},on:{start:t.startDrag,end:t.afterDrag},model:{value:t.metrics,callback:function(e){t.metrics=e},expression:"metrics"}},"draggable",t.dragOptions,!1),[e("transition-group",{attrs:{type:"transition"}},t._l(t.metrics,(function(i){return e("li",{key:i.id,staticClass:"list-group-item"},[e("div",{staticClass:"matricLabelClass"},[e("b-icon",{staticClass:"dragicon",attrs:{icon:"drag"}}),e("div",{staticClass:"avataricon"},[e("el-avatar",{staticClass:"elavatarclass",attrs:{size:18,shape:"square"}},[t._v(t._s(i.id))])],1),e("EditLabel",{staticClass:"EditLabelClass",on:{input:function(e){return t.on_input_label(i)}},model:{value:i.label,callback:function(e){t.$set(i,"label",e)},expression:"element.label"}})],1),i.isFormular?e("div",[e("el-input",{class:{inputFormularClass:!0,inputFormularWarnClass:i.formularError.length>0},attrs:{size:"mini"},on:{change:function(e){return t.on_change_formular(i)},input:function(e){return t.on_input_formular(i)}},model:{value:i.formular,callback:function(e){t.$set(i,"formular",e)},expression:"element.formular"}},[e("el-select",{staticClass:"formularModiferClass",attrs:{slot:"append",size:"mini"},slot:"append",model:{value:i.modifier,callback:function(e){t.$set(i,"modifier",e)},expression:"element.modifier"}},t._l(t.ModiferList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),i.formularError.length>0?e("span",[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:i.formularError}},[e("b-icon",{staticClass:"danger",attrs:{icon:"alert-circle",size:"is-small"}})],1)],1):t._e(),e("span",{on:{click:function(e){return t.deleteMetric(i.id)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.删除")}},[e("b-icon",{staticClass:"iconClass",attrs:{icon:"close-circle",size:"is-small"}})],1)],1)],1):e("div",[e("el-select",{staticClass:"mr10",attrs:{size:"mini",filterable:"","default-first-option":!0,placeholder:t.$t("message.请选择")},on:{change:function(e){return t.on_change_event(i)}},model:{value:i.event,callback:function(e){t.$set(i,"event",e)},expression:"element.event"}},t._l(t.EventList,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),t._v(t._s(t.$t("message.的"))+" "),i.loadingOk?e("EventMetric",{attrs:{extra:i,eventProps:i.eventProps,entities:t.EntityList},on:{change:t.on_change_metric},model:{value:i.metric,callback:function(e){t.$set(i,"metric",e)},expression:"element.metric"}}):t._e(),e("span",{on:{click:function(e){return t.addTopEventPropCondition(i.combo)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.添加筛选")}},[e("b-icon",{staticClass:"iconClass",attrs:{icon:"filter-plus-outline",size:"is-small"}})],1)],1),t.getBasicMetricCount()>1?e("span",{on:{click:function(e){return t.deleteMetric(i.id)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.删除")}},[e("b-icon",{staticClass:"iconClass",attrs:{icon:"close-circle",size:"is-small"}})],1)],1):t._e(),i.loadingOk?e("PropConditionGroup",{attrs:{eventProps:i.eventProps,keepLast:!1,userProps:t.UserPropList,userGroups:t.UserGroupList,userTags:t.UserTagList},model:{value:i.combo,callback:function(e){t.$set(i,"combo",e)},expression:"element.combo"}}):t._e()],1)])})),0)],1)],1),e("div",{staticClass:"title_area nonuserselect",on:{click:t.addGlobalFilter}},[t._v(t._s(t.$t("message.全局筛选"))+" "),e("div",{staticClass:"title_area_button"},[e("div",[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.添加全局筛选")}},[e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),e("div",[e("PropConditionGroup",{attrs:{eventProps:t.MultiEventPropList,keepLast:!1,userProps:t.UserPropList,userGroups:t.UserGroupList,userTags:t.UserTagList},model:{value:t.GlobalFilter,callback:function(e){t.GlobalFilter=e},expression:"GlobalFilter"}})],1),e("div",{staticClass:"title_area nonuserselect",on:{click:t.addGroupby}},[t._v(t._s(t.$t("message.分组"))),e("div",{staticClass:"title_area_button"},[e("div",[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.添加分组")}},[e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:"plus"}})],1)],1),e("b-icon",{staticClass:"span_button",attrs:{"custom-size":"mdi-18px",size:"default",icon:""}})],1)]),e("div",[e("draggable",t._b({staticClass:"list-group",attrs:{tag:"ul"},on:{end:t.afterGroupbyDrag},model:{value:t.Groupbys.children,callback:function(e){t.$set(t.Groupbys,"children",e)},expression:"Groupbys.children"}},"draggable",t.dragOptions,!1),[e("transition-group",{attrs:{type:"transition"}},t._l(t.Groupbys.children,(function(i){return e("li",{key:i.id,staticClass:"list-group-item"},[e("div",{staticClass:"matricLabelClass"},[e("b-icon",{staticClass:"dragicon",attrs:{icon:"drag"}}),e("div",{staticClass:"groupyicon"},[e("el-avatar",{staticClass:"elavatarclass",attrs:{size:18,shape:"square"}},[t._v(t._s(i.id))])],1),e("GroupbyCondition",{attrs:{tabGroups:t.tabGroups},model:{value:i.groupbyfield,callback:function(e){t.$set(i,"groupbyfield",e)},expression:"element.groupbyfield"}}),e("span",{on:{click:function(e){return t.deleteGroupby(i.id)}}},[e("el-tooltip",{attrs:{effect:"light",placement:"top",content:t.$t("message.删除")}},[e("b-icon",{staticClass:"iconClass",attrs:{icon:"close-circle",size:"is-small"}})],1)],1)],1)])})),0)],1)],1)])])]),e("pane",{attrs:{size:100-t.paneSize}},[e("div",{staticClass:"chart_root"},[e("div",{staticClass:"chart_toolbar"},[e("div",{staticClass:"chart_toolbar_left"},[e("el-select",{staticClass:"w85",attrs:{size:"mini"},on:{change:t.on_timegrain_change},model:{value:t.ananlyzeTimeGrain,callback:function(e){t.ananlyzeTimeGrain=e},expression:"ananlyzeTimeGrain"}},t._l(t.ananlyzeTimeGrainOp,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("QuickDateTimeRangePicker",{ref:"quicktimepicker1",staticClass:"ml10",attrs:{fontSize:"mini"},on:{change:t.on_timerange_change},model:{value:t.analyzeTimeRange1,callback:function(e){t.analyzeTimeRange1=e},expression:"analyzeTimeRange1"}}),e("div",{staticClass:"svgicon_button ml5",on:{click:t.on_vs_change}},[e("inline-svg",{attrs:{width:"16",height:"16",src:i(21068)}})],1),t.vs?e("QuickDateTimeRangePicker",{ref:"quicktimepicker2",staticClass:"ml5",attrs:{fontSize:"mini"},on:{change:t.on_timerange_change},model:{value:t.analyzeTimeRange2,callback:function(e){t.analyzeTimeRange2=e},expression:"analyzeTimeRange2"}}):t._e()],1),e("div",{staticClass:"chart_toolbar_right"},[e("div",{class:{svgicon_button:!0,activeIcon:!t.hideTable},on:{click:function(e){t.hideTable=!t.hideTable}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:t.$t("message.表格"),placement:"bottom-end"}},[e("div",[e("inline-svg",{attrs:{width:"16",height:"16",src:i(69793)}})],1)])],1),t._l(t.availableChartList,(function(a){return e("div",{key:a.value,class:{svgicon_button:!0,activeIcon:!t.hideChart&&t.currentChart==a.value},on:{click:function(e){return t.switchChartType(a.value)}}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:a.label,placement:"bottom-end"}},[e("div",[e("inline-svg",{attrs:{width:"16",height:"16",src:i(97773)("./"+a.icon+".svg")}})],1)])],1)}))],2)]),t.tableDataLoading?e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tableDataLoading,expression:"tableDataLoading"}],staticClass:"mh100"}):[t.hideChart?t._e():e("div",{staticClass:"chartDiv",attrs:{id:t.chartViewContainer}},[t.loadTableDataOnce?e("ChartView",{attrs:{option:t.chartOption,containerId:t.chartViewContainer}}):t._e()],1),t.loadTableDataOnce&&!t.hideTable?e("TablePlusSummaryCellEdit",{attrs:{loading:t.tableDataLoading,enableSummary:!0,enableTranspose:!0},model:{value:t.tableData,callback:function(e){t.tableData=e},expression:"tableData"}}):t._e()]],2)])],1)],1)])},s=[],r=(i(57658),i(83581)),n=i(97634),l=i(74855),o=i(90309),c=i(43782),h=i(9808),u=i(36144),p=i(95705),d=i(76983),m=i.n(d),v=i(63822),b=i(47056),g=i(794),f=i(62147),_=i(23029),y=i(19976),C=i(9989),T=i(99877);const L=i(89405)._b;var G={components:{Splitpanes:r.F,Pane:r.X,SaveAnalysis:y.Z,ChartView:p.Z,EventMetric:n.Z,InlineSvg:T.ZP,draggable:m(),EditLabel:l.Z,PropConditionGroup:o.Z,GroupbyCondition:c.Z,QuickDateTimeRangePicker:h.Z,TablePlusSummaryCellEdit:u.Z},created(){this.initialize()},mounted(){},data:()=>({EntityList:[],EventList:[],UserPropList:[],UserGroupList:[],UserTagList:[],ModiferList:[],zones:[],EventPropList:[],paneSize:45,ananlyzeTimeGrainOp:[],availableChartList:[],report_id:0,id:0,name:"",vs:!1,zone:g.Z.def.TimeZone.Utcp8,ananlyzeTimeGrain:g.Z.def.TimeGrain.GrainDay,MultiEventPropList:[],tabGroups:[],GlobalFilter:{logicop:g.Z.def.LogicOp.LogicOpAnd,children:[]},Groupbys:{children:[]},metrics:[],analyzeTimeRange1:{time_pick:!1,quick_range:"this_7day",start_unit:"day",end_unit:"day",start_offset:1,end_offset:0,start_dynamic:!0,end_dynamic:!0,start_time:"2023-06-28 00:00:00",end_time:"2023-06-29 23:59:59"},analyzeTimeRange2:{time_pick:!1,quick_range:"last_7day"},tableData:{},tableDataLoading:!1,loadTableDataOnce:!1,hideTable:!1,hideChart:!0,chartOption:{},tempLastPost:"",respData:{},currentChart:g.Z.def.ChartType.Line,chartDataSet:{},chartViewContainer:""}),methods:{initialize(){this.chartViewContainer=(0,_.Z)(),this.currentChart=g.Z.def.ChartType.Line,this.loadZones(),this.loadAnalyzeTimeGrain(),this.ModiferList=g.Z.def.ModifierType.getLabelValueList();var t=this.getCurrAppId(),e=f.Z.api.LoadPlainEventList(t,!0),i=f.Z.api.LoadUserProp(t),a=f.Z.api.LoadUserClusterList(t),s=f.Z.api.LoadUserTagList(t,!0),r=f.Z.api.LoadAnalysisEnityList(t),n=Promise.all([i,e,a,s,r]);n.then((t=>{this.UserPropList=t[0],this.EventList=t[1],this.UserGroupList=t[2],this.UserTagList=t[3],this.EntityList=t[4],this.UserGroupList.forEach((t=>{t.client_data=null,t.table_type=g.Z.def.TableType.TableTypeEvent})),this.UserTagList.forEach((t=>{t.client_data=null,t.table_type=g.Z.def.TableType.TableTypeEvent})),this.tabGroups=f.Z.filtersub.MakeTabGroup(null,this.UserPropList,this.UserGroupList,this.UserTagList);var e=this.$route.params;e&&(this.report_id=e.report_id),e&&!g.Z.utils.IsEmptyObj(e.client_data)?this.restoreClientData(e.client_data):(this.hideChart=!1,this.addNewMetric(!1))})).catch((t=>{g.Z.utils.Err(this,t)}))},restoreClientData(t){this.id=t.id,this.name=t.name,this.vs=t.vs,this.zone=t.zone,this.ananlyzeTimeGrain=t.ananlyzeTimeGrain,this.MultiEventPropList=t.MultiEventPropList,this.tabGroups=t.tabGroups,this.GlobalFilter=t.GlobalFilter,this.Groupbys=t.Groupbys,this.metrics=t.metrics,this.currentChart=t.currentChart,this.analyzeTimeRange1=t.analyzeTimeRange1,this.$refs.quicktimepicker1.setValue(t.analyzeTimeRange1),this.analyzeTimeRange2=t.analyzeTimeRange2,this.vs&&this.$refs.quicktimepicker2&&this.$refs.quicktimepicker2.setValue(t.analyzeTimeRange2);for(var e=0;e<this.metrics.length;e++)this.metrics[e].loadingOk=!1;for(e=0;e<this.metrics.length;e++)this.loadEventProp(this.metrics[e]);this.tableDataLoading=!0,this.respData=t.respData,this.hideTable=!1,this.hideChart=!1,setTimeout((()=>{this.switchChartType(this.currentChart,!0)}),100)},getEventLabel(t){for(var e=0;e<this.EventList.length;e++)if(this.EventList[e].value==t)return this.EventList[e].label;return""},startDrag(){},afterDrag(){this.rebindData().then((()=>{this.validateAllFormular()}))},loadZones(){this.zones.push({label:g.Z.def.TimeZone.getZhLabel(g.Z.def.TimeZone.Utcp8),value:g.Z.def.TimeZone.Utcp8});var t=-12;while(t<13)8!==t&&this.zones.push({label:g.Z.def.TimeZone.getZhLabel(t),value:t}),t+=1},loadAnalyzeTimeGrain(){this.ananlyzeTimeGrainOp=g.Z.def.TimeGrain.getAnalyzeGrainOpList()},rebindData(){return new Promise(function(t){this.refreshMetricId();var e=g.Z.utils.DeepClone(this.metrics);setTimeout((()=>{this.metrics=e,t("ok")}),10)}.bind(this))},refreshMetricId(){for(var t=0;t<this.metrics.length;t++)this.metrics[t].id=t<26?String.fromCharCode(65+t):"A"+String.fromCharCode(65+t-26)},addTopEventPropCondition(t){g.Z.condx.GroupAdd(t,0,1,{selectedOp:"=",record:{}})},deleteMetric(t){for(var e=0;e<this.metrics.length;e++)if(this.metrics[e].id==t)return this.metrics.splice(e,1),void this.rebindData().then((()=>{this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition()}))},getBasicMetricIdList(){for(var t=[],e=0;e<this.metrics.length;e++)this.metrics[e].isFormular||t.push(this.metrics[e].id);return t},getBasicMetricCount(){for(var t=0,e=0;e<this.metrics.length;e++)this.metrics[e].isFormular||t++;return t},getNewFormularName(){for(var t=1,e=0;e<this.metrics.length;e++)this.metrics[e].isFormular&&t++;return this.$t("message.自定义公式")+String(t)},setFormularError(t){t.formularError=this.$t("message.公式有误, 请仔细检查表达式")},reset(){this.metrics.length>0&&(this.metrics=[this.metrics[0]]),this.GlobalFilter={logicop:g.Z.def.LogicOp.LogicOpAnd,children:[]},this.Groupbys={children:[]},this.rebindData().then()},addNewMetric(t){if(!(this.metrics.length>=g.Z.def.Limit.LimitAnalysisEventMaxMetrics)){var e={label:"",id:"A",event:"",metric:"",formular:"",formularError:"",isFormular:t,modifier:g.Z.def.ModifierType.ModifierTypeNone,loadingOk:!1,labelchanged:!1,eventProps:[],combo:{logicop:g.Z.def.LogicOp.LogicOpAnd,children:[]}};t&&(e.label=this.getNewFormularName(),e.modifier=g.Z.def.ModifierType.ModifierTypeRound,this.validateFormular(e)),this.EventList.length>0&&(e.event=this.EventList[0].value,this.loadEventProp(e)),this.metrics.push(e),this.refreshMetricId()}},on_input_label(t){t.labelchanged=!0},on_change_event(t){this.loadEventProp(t),t.labelchanged||(t.label=this.getEventLabel(t.event)+"."+t.metricText)},on_change_metric(t,e){g.Z.utils.Ignore(t,e),e.extra.metricText=e.text,e.extra.labelchanged||(e.extra.label=this.getEventLabel(e.extra.event)+"."+e.text)},addGlobalFilter(){g.Z.condx.GroupAdd(this.GlobalFilter,0,1,{selectedOp:"=",record:{}})},deleteDangleGlobalFilterCondition(){for(var t=g.Z.condx.Clone2List(this.GlobalFilter),e=0;e<t.length;e++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==g.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==t[e].record.pickersubject.type_prop_name){i=!0;break}i||g.Z.condx.GroupRemove(this.GlobalFilter,t[e].id)}},deleteDangleGroupbyCondition(){for(var t=g.Z.utils.DeepClone(this.Groupbys.children),e=0;e<t.length;e++){for(var i=!1,a=0;a<this.MultiEventPropList.length;a++)if(this.MultiEventPropList[a].table_type==g.Z.def.TableType.TableTypeEvent&&this.MultiEventPropList[a].type_prop_name==t[e].groupbyfield.editing_field.type_prop_name){i=!0;break}i||g.Z.condx.GroupRemove(this.Groupbys,t[e].id)}},refreshCommEventProp(){for(var t=[],e=new Map,i=0;i<this.metrics.length;i++)if(this.metrics[i].eventProps)for(var a=0;a<this.metrics[i].eventProps.length;a++)if(!e.has(this.metrics[i].eventProps[a].type_prop_name)){e.set(this.metrics[i].eventProps[a].type_prop_name);var s=g.Z.utils.DeepClone(this.metrics[i].eventProps[a]);s.id=t.length,t.push(s)}return this.MultiEventPropList=t,this.tabGroups=[],setTimeout((()=>{this.tabGroups=f.Z.filtersub.MakeTabGroup(this.MultiEventPropList,this.UserPropList,this.UserGroupList,this.UserTagList)}),10),t},loadEventProp(t){for(var e=this.getCurrAppId(),i=0;i<this.metrics.length;i++)if(this.metrics[i]!==t&&this.metrics[i].event==t.event&&this.metrics[i].loadingOk)return t.eventProps=g.Z.utils.DeepClone(this.metrics[i].eventProps),void(t.loadingOk=!0);f.Z.api.LoadEventPropParamPromise({app_id:e,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0,limit_event_name:[t.event]}).then((e=>{t.eventProps=e,this.refreshCommEventProp(),this.deleteDangleGlobalFilterCondition(),this.deleteDangleGroupbyCondition(),t.loadingOk=!0}))},on_input_formular(t){if(t&&t.formular){t.formular=t.formular.toUpperCase();for(var e="",i=0;i<t.formular.length;i++)g.Z.def.MathExpressChars.getList().indexOf(t.formular[i])>=0&&(e+=t.formular[i]);t.formular=e}},on_change_formular(t){this.validateFormular(t)},validateAllFormular(){for(var t=0;t<this.metrics.length;t++)this.metrics[t].isFormular&&this.validateFormular(this.metrics[t])},validateFormular(t){var e=new L;t.formularError="";try{var i=e.parse(t.formular);if(0==i.tokens.length)return void this.setFormularError(t,this.$t("message.公式不能为空"));for(var a=this.getBasicMetricIdList(),s=0;s<i.tokens.length;s++){if("IVAR"!=i.tokens[s].type&&"INUMBER"!=i.tokens[s].type&&"IOP2"!=i.tokens[s].type)return void this.setFormularError(t);if("IVAR"==i.tokens[s].type&&a.indexOf(i.tokens[s].value)<0)return void this.setFormularError(t,i.tokens[s].value)}}catch{this.setFormularError(t)}},addGroupby(){g.Z.condx.GroupAdd(this.Groupbys,0,1,{})},deleteGroupby(t){g.Z.condx.GroupRemove(this.Groupbys,t)},afterGroupbyDrag(){for(var t=g.Z.utils.DeepClone(this.Groupbys),e=0;e<t.children.length;e++)t.children[e].id=e+1;this.Groupbys.children=[],setTimeout((()=>{this.Groupbys=t}),10)},on_timerange_change(t){g.Z.utils.Ignore(t),this.setAvailableChart()},on_vs_change(){this.vs=!this.vs,this.setAvailableChart()},haveDuplicatedMetricName(){var t=!1,e=new Map;return this.metrics.forEach((i=>{var a=e.get(i.label);void 0===a?e.set(i.label,1):t=!0})),t},on_click_save(t){var e={},i=this.prepare_postdata(e);if(i)g.Z.utils.Err(this,i);else{var a={vs:this.vs,zone:this.zone,ananlyzeTimeGrain:this.ananlyzeTimeGrain,MultiEventPropList:this.MultiEventPropList,tabGroups:this.tabGroups,GlobalFilter:this.GlobalFilter,Groupbys:this.Groupbys,metrics:this.metrics,analyzeTimeRange1:this.analyzeTimeRange1,analyzeTimeRange2:this.analyzeTimeRange2,currentChart:this.currentChart};this.tempLastPost!=JSON.stringify(e)?this.QueryApi().then((()=>{this.$refs.saveAnalysis.showDialog(t,this.name,a,e,this.respData,g.Z.def.AnalysisType.AnalysisTypeEvent,0,this.report_id),this.tableDataLoading=!1})).catch(function(t){g.Z.utils.Err(this,t),this.tableDataLoading=!1}.bind(this)):(this.$refs.saveAnalysis.showDialog(t,this.name,a,e,this.respData,g.Z.def.AnalysisType.AnalysisTypeEvent,0,this.report_id),this.tableDataLoading=!1)}},on_save_success(t){this.name=t.name,this.id=t.id},prepare_postdata(t){if(this.haveDuplicatedMetricName())return this.$t("message.指标名字不能有重复");t.app=this.getCurrAppId(),t.time_zone=this.zone,t.metrics=f.Z.metric.VueEventMetrics2ApiEventMetrics(this.metrics),t.comm_filter=f.Z.metric.VuePropFilterGroup2ApiGlobalFilter(this.GlobalFilter),t.breaks=f.Z.breaks.VueGroupbys2ApiBreakList(this.metrics[0].event,this.Groupbys),t.analysis_time_range={grain:this.ananlyzeTimeGrain,time_zone:this.zone,vs:this.vs,range1:this.analyzeTimeRange1},this.vs&&(t.analysis_time_range.range2=this.analyzeTimeRange2)},QueryApi(){var t={},e=this.prepare_postdata(t);return e?Promise.reject(e):(this.tableDataLoading=!0,this.tableData={},this.tempLastPost=JSON.stringify(t),b.Z["new"]().analyzeEvent(t).then(function(t){return g.Z.utils.Ignore(t),this.respData=t.data,this.tableData=f.Z.analysisEvent.ToTabledata(this.respData),this.setAvailableChart(),this.chartDataSet=C.Z.TableDataToChartSetList(this.tableData),this.chartOption=f.Z.BuidChart(this.currentChart,g.Z.utils.DeepClone(this.chartDataSet)),this.tableDataLoading=!1,this.loadTableDataOnce=!0,!0}.bind(this)))},on_click_analyze(){this.QueryApi().catch(function(t){g.Z.utils.Err(this,t),this.tableDataLoading=!1}.bind(this))},on_timegrain_change(){this.setAvailableChart()},setAvailableChart(){var t=this.ananlyzeTimeGrain!=g.Z.def.TimeGrain.GrainMill,e=this.Groupbys.children.length>0,i=this.vs;this.availableChartList=f.Z.analysisEvent.GetChartTypeList(t,e,i,!0),this.availableChartList.length>0&&""==this.currentChart&&(this.currentChart=this.availableChartList[0].value)},switchChartType(t,e){t==this.currentChart&&(this.hideChart=!this.hideChart),this.currentChart=t,e&&(this.hideChart=!1),this.hideChart||(this.tableDataLoading=!0,this.$nextTick((()=>{this.tableData=f.Z.analysisEvent.ToTabledata(this.respData),this.chartDataSet=C.Z.TableDataToChartSetList(this.tableData),this.chartOption=f.Z.BuidChart(this.currentChart,g.Z.utils.DeepClone(this.chartDataSet)),this.tableDataLoading=!1,this.loadTableDataOnce=!0})))}},computed:{...(0,v.Se)({getCurrAppId:"system/getCurrAppId"}),dragOptions(){return{animation:0,group:"description",disabled:!1,ghostClass:"ghost"}}}},k=G,z=i(1001),Z=(0,z.Z)(k,a,s,!1,null,"295a5756",null),E=Z.exports},23029:function(t,e,i){i.d(e,{Z:function(){return u}});const a="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var s={randomUUID:a};i(23767),i(8585),i(68696);let r;const n=new Uint8Array(16);function l(){if(!r&&(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}i(57658);const o=[];for(let p=0;p<256;++p)o.push((p+256).toString(16).slice(1));function c(t,e=0){return o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]}function h(t,e,i){if(s.randomUUID&&!e&&!t)return s.randomUUID();t=t||{};const a=t.random||(t.rng||l)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=a[t];return e}return c(a)}var u=h}}]);