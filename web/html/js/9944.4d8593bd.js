"use strict";(self["webpackChunkwildfire"]=self["webpackChunkwildfire"]||[]).push([[9944],{79944:function(e,t,i){i.r(t),i.d(t,{default:function(){return v}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("message.用户属性")))]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-key":"id","min-height":"250",border:"","default-expand-all":"","tree-props":{children:"children"}}},[t("el-table-column",{attrs:{sortable:"",prop:"name",label:e.propColsVisible["name"].title}}),t("el-table-column",{attrs:{sortable:"",prop:"label",label:e.propColsVisible["label"].title}}),t("el-table-column",{attrs:{sortable:"",prop:"data_type_label",label:e.propColsVisible["data_type"].title}}),t("el-table-column",{attrs:{sortable:"",prop:"prop_type_label",label:e.propColsVisible["prop_type"].title}}),t("el-table-column",{attrs:{sortable:"",prop:"id",label:e.propColsVisible["id"].title}}),t("el-table-column",{attrs:{sortable:"",prop:"hide",label:e.propColsVisible["hide"].title}}),t("el-table-column",{attrs:{prop:"id",label:e.$t("message.操作")},scopedSlots:e._u([{key:"default",fn:function({row:i}){return[e.isNotDimField(i)?t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.displayDetail(i)}}},[e._v(e._s(e.$t("message.详情")))]):e._e(),e.ableToSetDimTable(i)?t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.setDimTable(i)}}},[e._v(e._s(e.$t("message.设置维度表")))]):e._e(),e.isTopLayerCustomProp(i)?t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteProp(i)}}},[e._v(e._s(e.$t("message.删除")))]):e._e()]}}])})],1),t("el-drawer",{attrs:{title:e.$t("message.属性详情"),"close-on-press-escape":"",visible:e.drawer,direction:e.direction,size:800},on:{"update:visible":function(t){e.drawer=t}}},[t("el-descriptions",{staticClass:"padding20",attrs:{column:1}},[t("el-descriptions-item",{attrs:{label:e.propColsVisible["name"].title}},[e._v(e._s(e.rowDetail.name))]),t("el-descriptions-item",{attrs:{label:e.propColsVisible["label"].title}},[e.editingRow?e._e():t("span",[e._v(e._s(e.rowDetail.label))]),e.editingRow?t("el-input",{attrs:{size:"mini"},model:{value:e.editingLabel,callback:function(t){e.editingLabel=t},expression:"editingLabel"}}):e._e(),e.editingRow?e._e():t("i",{staticClass:"el-icon-edit marginleft20",on:{click:function(t){return e.editPropLabel(e.rowDetail)}}}),e.editingRow?t("el-button",{staticClass:"marginleft20",attrs:{type:"text",size:"mini"},nativeOn:{click:function(t){return t.preventDefault(),e.updatePropLabel(e.row)}}},[e._v(e._s(e.$t("message.确定")))]):e._e()],1),t("el-descriptions-item",{attrs:{label:e.propColsVisible["data_type"].title}},[e._v(e._s(e.rowDetail.data_type))]),t("el-descriptions-item",{attrs:{label:e.propColsVisible["prop_type"].title}},[e._v(e._s(e.rowDetail.prop_type))]),t("el-descriptions-item",{attrs:{label:e.propColsVisible["id"].title}},[e._v(e._s(e.rowDetail.id))]),t("el-descriptions-item",{attrs:{label:e.propColsVisible["hide"].title}},[e._v(e._s(e.rowDetail.hide))])],1)],1),t("el-dialog",{attrs:{title:e.$t("message.设置维度表"),"append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogVisible,width:"700px",top:"7vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("b-message",{staticStyle:{"font-size":"12px"}},[e._v(" 1. "+e._s(e.$t("message.只能选择主键数据类型与用户属性数据类型相同的维度表"))+" ")]),t("el-form",{ref:"formName",staticClass:"ruleFormClass",attrs:{model:e.rowDetail,"label-width":"120px"}},[t("el-form-item",{attrs:{label:e.$t("message.维度表名称"),prop:"name"}},[t("el-select",{attrs:{filterable:"",placeholder:e.$t("message.请选择")},model:{value:e.dimensionOptionSelected,callback:function(t){e.dimensionOptionSelected=t},expression:"dimensionOptionSelected"}},e._l(e.dimenions[e.getElementPrimaryDataType(e.rowDetail.data_type)],(function(i){return t("el-option",{key:i.dim_name,attrs:{label:i.label,value:i.dim_name}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(i.label))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(i.dim_name))])])})),1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.getDimTableSchema(e.dimensionOptionSelected,e.getElementPrimaryDataType(e.rowDetail.data_type))}},[t("el-table-column",{attrs:{prop:"name",label:e.$t("message.字段名字")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("b-icon",{attrs:{icon:i.row.keyicon,size:"is-small"}}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(i.row.name))])]}}])}),t("el-table-column",{attrs:{prop:"label",label:e.$t("message.显示名字")}}),t("el-table-column",{attrs:{prop:"primary_type_label",label:"数据类型"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.unsetDimTable}},[e._v(e._s(e.$t("message.解除维度表关联")))]),t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmDimTable}},[e._v(e._s(e.$t("message.确 定")))])],1)],1),t("DialogDeleteUserProp",{ref:"dialogdelete",on:{confirm:e.on_delete_prop}})],1)},l=[],s=(i(57658),i(47056)),r=function(){var e=this,t=e._self._c;return t("div",{ref:"me",attrs:{id:"crf_deleteuserprop"}},[t("div",{attrs:{readonly:""},on:{click:function(t){e.newDialog.show=!0}}},[e._t("default")],2),t("el-dialog",{attrs:{visible:e.newDialog.show,width:"450px","show-close":!1,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.newDialog,"show",t)}}},[t("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.$t("message.删除用户属性")))]),t("div",{staticClass:"dialogBody"},[t("el-form",{ref:"formData",attrs:{"label-width":"140px",model:e.formData,rules:e.rules}},[t("el-form-item",{attrs:{label:e.$t("message.属性名字"),prop:"name"}},[t("span",[e._v(e._s(e.formData.name))])]),t("el-form-item",{attrs:{label:e.$t("message.显示名字"),prop:"label"}},[t("span",[e._v(e._s(e.formData.label))])])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){e.newDialog.show=!1}}},[e._v(e._s(e.$t("message.取 消")))]),t("el-button",{staticClass:"dialogfooterButton",attrs:{size:"mini"},on:{click:function(t){return e.confirm("formData")}}},[e._v(e._s(e.$t("message.确 定")))])],1)])],1)},o=[],n=i(794),p=i(8993),d=i(63822),m={props:{},data(){return{row:null,newDialog:{show:!1},formData:{name:"",label:""},rules:{}}},created(){},mounted(){},beforeDestroy(){},methods:{showDialog(e){this.row=n.Z.utils.DeepClone(e),this.formData.name=e.name,this.formData.label=e.label,this.newDialog.show=!0},confirm(){p.Z["new"]().deleteUserProp({type_prop_name:this.row.type_prop_name,app_id:this.getCurrAppId()}).then(function(e){n.Z.utils.Ignore(e),this.$emit("confirm"),this.newDialog.show=!1}.bind(this)).catch(function(e){n.Z.utils.Err(this,e)}.bind(this))}},computed:{...(0,d.Se)({getCurrAppId:"system/getCurrAppId"})}},b=m,c=i(1001),u=(0,c.Z)(b,r,o,!1,null,"698447be",null),_=u.exports;const h=i(36797),y="key";var f={components:{DialogDeleteUserProp:_},data(){return{dialogVisible:!1,drawer:!1,direction:"rtl",tableData:[],dimenions:{},dimensionOptionSelected:"",propColsVisible:{name:{title:this.$t("message.属性埋点名字"),display:!0},label:{title:this.$t("message.属性别名"),display:!0},data_type:{title:this.$t("message.数据类型"),display:!0},prop_type:{title:this.$t("message.属性类型"),display:!0},id:{title:this.$t("message.ID"),display:!0},hide:{title:this.$t("message.隐藏"),display:!0}},eventColsVisible:{event_group:{title:this.$t("message.事件分组"),display:!0},name:{title:this.$t("message.事件埋点名字"),display:!0},label:{title:this.$t("message.事件别名"),display:!0},event_hide:{title:this.$t("message.事件隐藏"),display:!0}},rowDetail:{},editingRow:!1,editingLabel:""}},mounted(){this.initialize()},methods:{initialize(){this.loadUserProp(),this.listDimTable()},deleteProp(e){this.$refs.dialogdelete.showDialog(e)},on_delete_prop(){n.Z.utils.Success(this,this.$t("message.删除成功")),this.initialize()},isTopLayerCustomProp(e){return!(!n.Z.def.PropDelimiter.isTopLayerProp(e.name)||e.prop_type!=n.Z.def.PropertyType.PropertyTypeCustom)},getElementPrimaryDataType(e){var t=n.Z.def.DataType.getElementPrimaryType(e);return t},isNotDimField(e){return e.prop_type!==n.Z.def.PropertyType.PropertyTypeDimension},unsetDimTable(){this.dialogVisible=!1;var e=this.getCurrAppId();s.Z["new"]().unsetPropLinkDimTable({app_id:e,type_prop_name:this.rowDetail.type_prop_name,table_type:n.Z.def.TableType.TableTypeUser}).then(function(e){n.Z.utils.Ignore(e),this.loadUserProp()}.bind(this)).catch((function(e){console.log(e)}))},confirmDimTable(){this.dialogVisible=!1;var e=this.getCurrAppId();s.Z["new"]().setPropLinkDimTable({app_id:e,dim_name:this.dimensionOptionSelected,event_name:"",type_prop_name:this.rowDetail.type_prop_name,table_type:n.Z.def.TableType.TableTypeUser}).then(function(e){n.Z.utils.Ignore(e),this.loadUserProp()}.bind(this)).catch((function(e){console.log(e)}))},ableToSetDimTable(e){return e.prop_type!==n.Z.def.PropertyType.PropertyTypeDimension&&(e.data_type!==n.Z.def.DataType.DataTypeObject&&e.data_type!==n.Z.def.DataType.DataTypeListObject)},getDimTableSchema(e,t){var i=this.dimenions[t];if(i)for(var a=0;a<i.length;a++)if(i[a].dim_name===e)return i[a].schema;return[]},setDimTable(e){this.dialogVisible=!0,this.rowDetail=e,this.dimensionOptionSelected=e.dim_name},listDimTable(){var e=this.getCurrAppId();s.Z["new"]().listDimTable({app_id:e}).then(function(e){var t=e.data;if(t)for(var i=0;i<t.length;i++){var a={dim_name:t[i].dim_name,label:t[i].label,memo:t[i].memo,update_time:t[i].update_time,schema:t[i].schema};a.schema[0].keyicon=y;for(var l=0;l<a.schema.length;l++)a.schema[l].primary_type_label=n.Z.def.PrimaryDataType.getZhLabel(a.schema[l].primary_type);a.update_time=h(1e3*a.update_time).format("YYYY-MM-DD"),this.dimenions[a.schema[0].primary_type]&&this.dimenions[a.schema[0].primary_type].length>0?this.dimenions[a.schema[0].primary_type].push(a):this.dimenions[a.schema[0].primary_type]=[a]}}.bind(this)).catch((function(e){console.log(e)}))},editPropLabel(e){this.editingRow=!0,this.editingLabel=e.label},updatePropLabel(){this.editingRow=!1;var e=this.getCurrAppId();s.Z["new"]().setPropLabel({app_id:e,label:this.editingLabel,type_prop_name:this.rowDetail.type_prop_name,table_type:n.Z.def.TableType.TableTypeUser}).then(function(){this.rowDetail.label=this.editingLabel,this.loadUserProp()}.bind(this)).catch(function(e){n.Z.utils.Err(this,e)}.bind(this))},moveDimToSubordinate(){for(var e=[],t=[],i=0;i<this.tableData.length;i++)-1===this.tableData[i].type_prop_name.indexOf(n.Z.def.PropDelimiter.DimDelimiter)?e.push(this.tableData[i]):t.push(this.tableData[i]);for(i=0;i<t.length;i++)for(var a=t[i].type_prop_name.split(n.Z.def.PropDelimiter.DimDelimiter),l=0;l<e.length;l++)a[0]===e[l].type_prop_name&&(e[l].children||(e[l].children=[]),e[l].children.push(t[i]));e.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),this.tableData=e},isObjProp(e){return e.indexOf(n.Z.def.PropDelimiter.ObjDelimiter)>-1&&-1===e.indexOf(n.Z.def.PropDelimiter.DimDelimiter)},isDimProp(e){return e.indexOf(n.Z.def.PropDelimiter.DimDelimiter)>-1},loadUserProp(){this.tableData=[];var e=this.getCurrAppId();s.Z["new"]().propListOfUser({app_id:e,include_obj_schema:!0,include_dim_schema:!0,include_obj_dim_schema:!0}).then(function(e){var t=e.data.Props;if(t){for(var i=0;i<t.length;i++){var a={id:i,name:t[i].name,type_prop_name:t[i].type_prop_name,label:t[i].prop_label,hide:t[i].hide,data_type:t[i].data_type,data_type_label:n.Z.def.DataType.getZhLabel(t[i].data_type),prop_type:t[i].prop_type,prop_type_label:n.Z.def.PropertyType.getZhLabel(t[i].prop_type),dim_label:t[i].dim_label,dim_name:t[i].dim_name};this.isObjProp(a.name)&&(a.label=a.obj_label),this.isDimProp(a.name)&&(a.label=a.dim_label),a.hide?a.hide=this.$t("message.是"):a.hide=this.$t("message.否"),this.tableData.push(a)}this.moveDimToSubordinate()}}.bind(this)).catch(function(e){n.Z.utils.Err(this,e)}.bind(this))},displayDetail(e){this.drawer=!0,this.rowDetail=e}},computed:{...(0,d.Se)({getCurrAppId:"system/getCurrAppId"})}},g=f,D=(0,c.Z)(g,a,l,!1,null,"0cd71f7b",null),v=D.exports},8993:function(e,t,i){i.d(t,{Z:function(){return s}});var a=i(90948),l=i(91803);class s{static new(){if(!(0,a.y7)())return new s}deleteEvent(e){return(0,l.Z)({url:"/api/saver/app/delete_event",method:"post",data:e})}deleteEventProp(e){return(0,l.Z)({url:"/api/saver/app/delete_event_prop",method:"post",data:e})}deleteUserProp(e){return(0,l.Z)({url:"/api/saver/app/delete_user_prop",method:"post",data:e})}uploadCustomProps(e){return(0,l.Z)({url:"/api/saver/app/upload_custom_props",method:"post",data:e})}GetDownloadCode(e){return(0,l.Z)({url:"/api/saver/app/get_download_code",method:"post",data:e})}}}}]);